/*

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013,2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2009, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2013, 2015 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
(function(G,B){"function"===typeof define&&define.amd?define([],B):(G.orion=G.orion||{},G.orion.editor=G.orion.editor||{},G.orion.editor.edit=B())})(this,function(){var G,B;(function(t){function w(a,b){var f,c,e,h,g,x,C,D,m,v=b&&b.split("/"),k=n.map,p=k&&k["*"]||{};if(a&&"."===a.charAt(0))if(b){v=v.slice(0,v.length-1);a=v.concat(a.split("/"));for(D=0;D<a.length;D+=1)if(f=a[D],"."===f)a.splice(D,1),D-=1;else if(".."===f)if(1===D&&(".."===a[2]||".."===a[0]))break;else 0<D&&(a.splice(D-1,2),D-=2);a=
a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((v||p)&&k){f=a.split("/");for(D=f.length;0<D;D-=1){c=f.slice(0,D).join("/");if(v)for(m=v.length;0<m;m-=1)if(e=k[v.slice(0,m).join("/")])if(e=e[c]){h=e;g=D;break}if(h)break;!x&&(p&&p[c])&&(x=p[c],C=D)}!h&&x&&(h=x,g=C);h&&(f.splice(0,g,h),a=f.join("/"))}return a}function u(a,f){return function(){return b.apply(t,v.call(arguments,0).concat([a,f]))}}function d(a){return function(f){return w(f,a)}}function q(a){return function(f){c[a]=f}}function l(a){if(f.call(e,
a)){var b=e[a];delete e[a];m[a]=!0;p.apply(t,b)}if(!f.call(c,a)&&!f.call(m,a))throw Error("No "+a);return c[a]}function k(a){var f,b=a?a.indexOf("!"):-1;-1<b&&(f=a.substring(0,b),a=a.substring(b+1,a.length));return[f,a]}function s(a){return function(){return n&&n.config&&n.config[a]||{}}}var p,b,a,h,c={},e={},n={},m={},f=Object.prototype.hasOwnProperty,v=[].slice;a=function(a,f){var b,c=k(a),e=c[0];a=c[1];e&&(e=w(e,f),b=l(e));e?a=b&&b.normalize?b.normalize(a,d(f)):w(a,f):(a=w(a,f),c=k(a),e=c[0],a=
c[1],e&&(b=l(e)));return{f:e?e+"!"+a:a,n:a,pr:e,p:b}};h={require:function(a){return u(a)},exports:function(a){var b=c[a];return"undefined"!==typeof b?b:c[a]={}},module:function(a){return{id:a,uri:"",exports:c[a],config:s(a)}}};p=function(b,n,v,k){var p,d,g,x,C=[],D;k=k||b;if("function"===typeof v){n=!n.length&&v.length?["require","exports","module"]:n;for(x=0;x<n.length;x+=1)if(g=a(n[x],k),d=g.f,"require"===d)C[x]=h.require(b);else if("exports"===d)C[x]=h.exports(b),D=!0;else if("module"===d)p=C[x]=
h.module(b);else if(f.call(c,d)||f.call(e,d)||f.call(m,d))C[x]=l(d);else if(g.p)g.p.load(g.n,u(k,!0),q(d),{}),C[x]=c[d];else throw Error(b+" missing "+d);n=v.apply(c[b],C);if(b)if(p&&p.exports!==t&&p.exports!==c[b])c[b]=p.exports;else if(n!==t||!D)c[b]=n}else b&&(c[b]=v)};G=b=function(f,c,e,m,v){if("string"===typeof f)return h[f]?h[f](c):l(a(f,c).f);f.splice||(n=f,c.splice?(f=c,c=e,e=null):f=t);c=c||function(){};"function"===typeof e&&(e=m,m=v);m?p(t,f,c,e):setTimeout(function(){p(t,f,c,e)},4);return b};
b.config=function(a){n=a;return b};B=function(a,b,h){b.splice||(h=b,b=[]);!f.call(c,a)&&!f.call(e,a)&&(e[a]=[a,b,h])};B.amd={jQuery:!0}})();B("almond",function(){});(function(){function t(q,l,k,d,p,b){l[q]&&(k.push(q),(!0===l[q]||1===l[q])&&d.push(p+q+"/"+b))}function w(q,l,k,d,p){l=d+l+"/"+p;G._fileExists(q.toUrl(l+".js"))&&k.push(l)}function u(q,l,k){for(var d in l)l.hasOwnProperty(d)&&(!q.hasOwnProperty(d)||k)?q[d]=l[d]:"object"===typeof l[d]&&(!q[d]&&l[d]&&(q[d]={}),u(q[d],l[d],k))}var d=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;
B("i18n",["module"],function(q){var l=q.config?q.config():{};return{version:"2.0.4",load:function(k,q,p,b){b=b||{};b.locale&&(l.locale=b.locale);var a=d.exec(k),h=a[1],c=a[4],e=a[5],n=c.split("-"),m=[],f={},v,r="";a[5]?(h=a[1],k=h+e):(e=a[4],c=l.locale,c||(c=l.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),n=c.split("-"));if(b.isBuild){m.push(k);w(q,"root",m,h,e);for(v=0;v<n.length;v++)c=n[v],r+=(r?"-":"")+c,w(q,r,m,h,e);if(b.locales)for(a=
0;a<b.locales.length;a++){c=b.locales[a];n=c.split("-");r="";for(k=0;k<n.length;k++)c=n[k],r+=(r?"-":"")+c,w(q,r,m,h,e)}q(m,function(){p()})}else q([k],function(a){var b=[],c;t("root",a,b,m,h,e);for(v=0;v<n.length;v++)c=n[v],r+=(r?"-":"")+c,t(r,a,b,m,h,e);q(m,function(){var c,n,g;for(c=b.length-1;-1<c&&b[c];c--){g=b[c];n=a[g];if(!0===n||1===n)n=q(h+g+"/"+e);u(f,n)}p(f)})})}}})})();B("orion/editor/nls/messages",{root:!0});B("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",
line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",diffAdded:"Diff Added Lines",diffDeleted:"Diff Deleted Lines",diffModified:"Diff Modified Lines",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",
scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",selectLineStart:"Select Line Start",
selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",deleteLineStart:"Delete Line Start",
deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",escape:"Escape",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",setMarkCommand:"Set Mark",
clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",
incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",
trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode: Enter or ESC to exit",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Column ${1}",multiSelections:"${0} selection regions",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",
nothingReplaced:"Nothing replaced",notFound:"Not found"});B("orion/editor/eventTarget",[],function(){function t(){}t.addMixin=function(w){var u=t.prototype,d;for(d in u)u.hasOwnProperty(d)&&(w[d]=u[d])};t.prototype={addEventListener:function(t,u,d){this._eventTypes||(this._eventTypes={});var q=this._eventTypes[t];q||(q=this._eventTypes[t]={level:0,listeners:[]});q.listeners.push({listener:u,useCapture:d})},dispatchEvent:function(t){var u=t.type;this._dispatchEvent("pre"+u,t);this._dispatchEvent(u,
t);this._dispatchEvent("post"+u,t)},_dispatchEvent:function(t,u){var d=this._eventTypes?this._eventTypes[t]:null;if(d){var q=d.listeners;try{if(d.level++,q)for(var l=0,k=q.length;l<k;l++)if(q[l]){var s=q[l].listener;"function"===typeof s?s.call(this,u):s.handleEvent&&"function"===typeof s.handleEvent&&s.handleEvent(u)}}finally{if(d.level--,d.compact&&0===d.level){for(l=q.length-1;0<=l;l--)q[l]||q.splice(l,1);0===q.length&&delete this._eventTypes[t];d.compact=!1}}}},isListening:function(t){return!this._eventTypes?
!1:void 0!==this._eventTypes[t]},removeEventListener:function(t,u,d){if(this._eventTypes){var q=this._eventTypes[t];if(q){for(var l=q.listeners,k=0,s=l.length;k<s;k++){var p=l[k];if(p&&p.listener===u&&p.useCapture===d){0!==q.level?(l[k]=null,q.compact=!0):l.splice(k,1);break}}0===l.length&&delete this._eventTypes[t]}}}};return{EventTarget:t}});B("orion/regex",[],function(){return{escape:function(t){return t.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(t){return(t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(t))?
{pattern:t[1],flags:t[2]}:null}}});B("orion/util",[],function(){var t=navigator.userAgent,w=-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")?document.documentMode:void 0,u=parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0,d=-1!==t.indexOf("Opera")?parseFloat(t.split("Version/")[1]):void 0,q=parseFloat(t.split("Chrome/")[1])||void 0,l=-1!==t.indexOf("Safari")&&!q,k=parseFloat(t.split("WebKit/")[1])||void 0,s=-1!==t.indexOf("Android"),p=-1!==t.indexOf("iPad"),t=-1!==t.indexOf("iPhone"),
b=p||t,a=-1!==navigator.platform.indexOf("Mac"),h=-1!==navigator.platform.indexOf("Win"),c=-1!==navigator.platform.indexOf("Linux"),e="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(a){var b=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,c){return b[(c<<0)+1]})},createElement:function(a,b){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",b):a.createElement(b)},isIE:w,isFirefox:u,isOpera:d,isChrome:q,isSafari:l,
isWebkit:k,isAndroid:s,isIPad:p,isIPhone:t,isIOS:b,isMac:a,isWindows:h,isLinux:c,isTouch:e,platformDelimiter:h?"\r\n":"\n"}});B("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(t,w,u){function d(q,l){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(q);this.setLineDelimiter(l)}d.prototype={destroy:function(){},find:function(q){1<this._text.length&&(this._text=[this._text.join("")]);var l=q.string,k=q.regex,d=l,p="",b=q.caseInsensitive;
if(d)if(k){if(l=w.parse(d))d=l.pattern,p=l.flags}else d=l.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),b&&(d=d.replace(/[iI\u0130\u0131]/g,"[Ii\u0130\u0131]"));var a=null,h;if(d){var l=q.reverse,c=q.wrap,k=q.wholeWord,e=q.start||0;q=q.end;var n=null!==q&&void 0!==q;-1===p.indexOf("g")&&(p+="g");-1===p.indexOf("m")&&(p+="m");b&&-1===p.indexOf("i")&&(p+="i");k&&(d="\\b"+d+"\\b");var m=this._text[0],f,v,r=0;n&&(b=e<q?e:q,m=m.substring(b,e<q?q:e),r=b);var y=RegExp(d,p);l?h=function(){var a=null;
for(y.lastIndex=0;;){v=y.lastIndex;f=y.exec(m);if(v===y.lastIndex)return null;if(f){if(!(f.index+r<e)){if(!c||a)break;e=m.length+r}a={start:f.index+r,end:y.lastIndex+r}}else break}a&&(e=a.start);return a}:(n||(y.lastIndex=e),h=function(){for(;;){v=y.lastIndex;f=y.exec(m);if(v===y.lastIndex)break;if(f)return{start:f.index+r,end:y.lastIndex+r};if(!(0!==v&&c))break}return null});a=h()}return{next:function(){var b=a;b&&(a=h());return b},hasNext:function(){return null!==a}}},getCharCount:function(){for(var q=
0,d=0;d<this._text.length;d++)q+=this._text[d].length;return q},getLine:function(q,d){var k=this.getLineCount();if(!(0<=q&&q<k))return null;var s=this._lineOffsets[q];if(q+1<k){k=this.getText(s,this._lineOffsets[q+1]);if(d)return k;for(var s=k.length,p;10===(p=k.charCodeAt(s-1))||13===p;)s--;return k.substring(0,s)}return this.getText(s)},getLineAtOffset:function(q){var d=this.getCharCount();if(!(0<=q&&q<=d))return-1;var k=this.getLineCount();if(q===d)return k-1;var s,p,b=this._lastLineIndex;if(0<=
b&&b<k&&(s=this._lineOffsets[b],p=b+1<k?this._lineOffsets[b+1]:d,s<=q&&q<p))return b;for(var a=k,h=-1;1<a-h;)if(b=Math.floor((a+h)/2),s=this._lineOffsets[b],p=b+1<k?this._lineOffsets[b+1]:d,q<=s)a=b;else if(q<p){a=b;break}else h=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(q,d){var k=this.getLineCount();if(!(0<=q&&q<k))return-1;if(q+1<k){k=this._lineOffsets[q+1];if(d)return k;for(var s=
this.getText(Math.max(this._lineOffsets[q],k-2),k),p=s.length,b;10===(b=s.charCodeAt(p-1))||13===b;)p--;return k-(s.length-p)}return this.getCharCount()},getLineStart:function(q){return!(0<=q&&q<this.getLineCount())?-1:this._lineOffsets[q]},getText:function(q,d){void 0===q&&(q=0);void 0===d&&(d=this.getCharCount());if(q===d)return"";for(var k=0,s=0,p;s<this._text.length;){p=this._text[s].length;if(q<=k+p)break;k+=p;s++}for(var b=k,a=s;s<this._text.length;){p=this._text[s].length;if(d<=k+p)break;k+=
p;s++}if(a===s)return this._text[a].substring(q-b,d-k);b=this._text[a].substring(q-b);k=this._text[s].substring(0,d-k);return b+this._text.slice(a+1,s).join("")+k},onChanging:function(d){return this.dispatchEvent(d)},onChanged:function(d){return this.dispatchEvent(d)},setLineDelimiter:function(d,l){"auto"===d&&(d=void 0,1<this.getLineCount()&&(d=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=d?d:u.platformDelimiter;if(l){var k=this.getLineCount();if(1<k){for(var s=Array(k),
p=0;p<k;p++)s[p]=this.getLine(p);this.setText(s.join(this._lineDelimiter))}}},setText:function(d,l,k){void 0===d&&(d="");void 0===l&&(l=0);void 0===k&&(k=this.getCharCount());if(!(l===k&&""===d)){for(var s=this.getLineAtOffset(l),p=this.getLineAtOffset(k),b=l,a=k-l,h=p-s,c=d.length,e=0,n=this.getLineCount(),m=0,f=0,v=0,r=[];;){-1!==m&&m<=v&&(m=d.indexOf("\r",v));-1!==f&&f<=v&&(f=d.indexOf("\n",v));if(-1===f&&-1===m)break;v=-1!==m&&-1!==f?m+1===f?f+1:(m<f?m:f)+1:-1!==m?m+1:f+1;r.push(l+v);e++}this.onChanging({type:"Changing",
text:d,start:b,removedCharCount:a,addedCharCount:c,removedLineCount:h,addedLineCount:e});0===r.length&&(v=this.getLineStart(s),p=p+1<n?this.getLineStart(p+1):this.getCharCount(),l!==v&&(d=this.getText(v,l)+d,l=v),k!==p&&(d+=this.getText(k,p),k=p));v=c-a;for(p=s+h+1;p<n;p++)this._lineOffsets[p]+=v;if(5E4>r.length)s=[s+1,h].concat(r),Array.prototype.splice.apply(this._lineOffsets,s);else{v=s+1;this._lineOffsets.splice(v,h);for(n=0;n<r.length;n+=5E4)s=[v,0].concat(r.slice(n,Math.min(r.length,n+5E4))),
Array.prototype.splice.apply(this._lineOffsets,s),v+=5E4}for(v=n=0;v<this._text.length;){p=this._text[v].length;if(l<=n+p)break;n+=p;v++}s=n;for(r=v;v<this._text.length;){p=this._text[v].length;if(k<=n+p)break;n+=p;v++}p=this._text[v];l=this._text[r].substring(0,l-s);k=p.substring(k-n);r=[r,v-r+1];l&&r.push(l);d&&r.push(d);k&&r.push(k);Array.prototype.splice.apply(this._text,r);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:c,removedLineCount:h,
addedLineCount:e})}}};t.EventTarget.addMixin(d.prototype);return{TextModel:d}});B("orion/keyBinding",["orion/util"],function(t){function w(d,q,l,k,s,p){this.type=p||"keydown";this.keyCode="string"===typeof d&&"keydown"===this.type?d.toUpperCase().charCodeAt(0):d;this.mod1=void 0!==q&&null!==q?q:!1;this.mod2=void 0!==l&&null!==l?l:!1;this.mod3=void 0!==k&&null!==k?k:!1;this.mod4=void 0!==s&&null!==s?s:!1}function u(d){this.keys=d}w.prototype={getKeys:function(){return[this]},match:function(d,q){if(void 0!==
q){if(0!==q)return!1}else if(d instanceof Array){if(1<d.length)return!1;d=d[0]}return d.type!==this.type?!1:this.keyCode===d.keyCode||this.keyCode===String.fromCharCode(t.isOpera?d.which:void 0!==d.charCode?d.charCode:d.keyCode)?this.mod1!==(t.isMac?d.metaKey:d.ctrlKey)||"keydown"===this.type&&this.mod2!==d.shiftKey||this.mod3!==d.altKey||t.isMac&&this.mod4!==d.ctrlKey?!1:!0:!1},equals:function(d){return!d||this.keyCode!==d.keyCode||this.mod1!==d.mod1||this.mod2!==d.mod2||this.mod3!==d.mod3||this.mod4!==
d.mod4||this.type!==d.type?!1:!0}};u.prototype={getKeys:function(){return this.keys.slice(0)},match:function(d,q){var l=this.keys;if(void 0!==q)return q>l.length?!1:l[q].match(d)?q===l.length-1?!0:q+1:!1;d instanceof Array||(d=[d]);if(d.length>l.length)return!1;var k;for(k=0;k<d.length;k++)if(!l[k].match(d[k]))return!1;return k===l.length?!0:k},equals:function(d){if(!d.keys||d.keys.length!==this.keys.length)return!1;for(var q=0;q<d.keys.length;q++)if(!d.keys[q].equals(this.keys[q]))return!1;return!0}};
return{KeyBinding:w,KeyStroke:w,KeySequence:u}});B("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(t,w){function u(d){d&&(this._view=d,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function d(d){u.call(this,d)}u.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(d){for(var l=[],k=this._keyBindings,s=0;s<k.length;s++)k[s].actionID===d&&l.push(k[s].keyBinding);return l},getView:function(){return this._view},isActive:function(){return-1!==
this._view.getKeyModes().indexOf(this)},match:function(d){if("keydown"===d.type)switch(d.keyCode){case 16:case 17:case 18:case 91:return}for(var l=this._keyBindingIndex,k=this._matchingKeyBindings||this._keyBindings,s=[],p=0;p<k.length;p++){var b=k[p],a=b.keyBinding.match(d,l);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&s.push(b)}if(0===s.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=
s,"noop"},setKeyBinding:function(d,l){for(var k=this._keyBindings,s=0;s<k.length;s++){var p=k[s];if(p.keyBinding.equals(d)){l?p.actionID=l:p.predefined?p.actionID="noop":k.splice(s,1);return}}l&&k.push({keyBinding:d,actionID:l})},setView:function(d){this._view=d}};d.prototype=new u;d.prototype.createKeyBindings=function(){var d=t.KeyBinding,l=[];l.push({actionID:"lineUp",keyBinding:new d(38),predefined:!0});l.push({actionID:"lineDown",keyBinding:new d(40),predefined:!0});l.push({actionID:"charPrevious",
keyBinding:new d(37),predefined:!0});l.push({actionID:"charNext",keyBinding:new d(39),predefined:!0});w.isMac?(l.push({actionID:"scrollPageUp",keyBinding:new d(33),predefined:!0}),l.push({actionID:"scrollPageDown",keyBinding:new d(34),predefined:!0}),l.push({actionID:"pageUp",keyBinding:new d(33,null,null,!0),predefined:!0}),l.push({actionID:"pageDown",keyBinding:new d(34,null,null,!0),predefined:!0}),l.push({actionID:"lineStart",keyBinding:new d(37,!0),predefined:!0}),l.push({actionID:"lineEnd",
keyBinding:new d(39,!0),predefined:!0}),l.push({actionID:"wordPrevious",keyBinding:new d(37,null,null,!0),predefined:!0}),l.push({actionID:"wordNext",keyBinding:new d(39,null,null,!0),predefined:!0}),l.push({actionID:"scrollTextStart",keyBinding:new d(36),predefined:!0}),l.push({actionID:"scrollTextEnd",keyBinding:new d(35),predefined:!0}),l.push({actionID:"textStart",keyBinding:new d(38,!0),predefined:!0}),l.push({actionID:"textEnd",keyBinding:new d(40,!0),predefined:!0}),l.push({actionID:"scrollPageUp",
keyBinding:new d(38,null,null,null,!0),predefined:!0}),l.push({actionID:"scrollPageDown",keyBinding:new d(40,null,null,null,!0),predefined:!0}),l.push({actionID:"lineStart",keyBinding:new d(37,null,null,null,!0),predefined:!0}),l.push({actionID:"lineEnd",keyBinding:new d(39,null,null,null,!0),predefined:!0}),l.push({actionID:"lineStart",keyBinding:new d(38,null,null,!0),predefined:!0}),l.push({actionID:"lineEnd",keyBinding:new d(40,null,null,!0),predefined:!0})):(l.push({actionID:"pageUp",keyBinding:new d(33),
predefined:!0}),l.push({actionID:"pageDown",keyBinding:new d(34),predefined:!0}),l.push({actionID:"lineStart",keyBinding:new d(36),predefined:!0}),l.push({actionID:"lineEnd",keyBinding:new d(35),predefined:!0}),l.push({actionID:"wordPrevious",keyBinding:new d(37,!0),predefined:!0}),l.push({actionID:"wordNext",keyBinding:new d(39,!0),predefined:!0}),l.push({actionID:"textStart",keyBinding:new d(36,!0),predefined:!0}),l.push({actionID:"textEnd",keyBinding:new d(35,!0),predefined:!0}));w.isFirefox&&
w.isLinux&&(l.push({actionID:"lineUp",keyBinding:new d(38,!0),predefined:!0}),l.push({actionID:"lineDown",keyBinding:new d(40,!0),predefined:!0}));w.isWindows&&(l.push({actionID:"scrollLineUp",keyBinding:new d(38,!0),predefined:!0}),l.push({actionID:"scrollLineDown",keyBinding:new d(40,!0),predefined:!0}));l.push({actionID:"selectLineUp",keyBinding:new d(38,null,!0),predefined:!0});l.push({actionID:"selectLineDown",keyBinding:new d(40,null,!0),predefined:!0});l.push({actionID:"selectCharPrevious",
keyBinding:new d(37,null,!0),predefined:!0});l.push({actionID:"selectCharNext",keyBinding:new d(39,null,!0),predefined:!0});l.push({actionID:"selectPageUp",keyBinding:new d(33,null,!0),predefined:!0});l.push({actionID:"selectPageDown",keyBinding:new d(34,null,!0),predefined:!0});w.isMac?(l.push({actionID:"selectLineStart",keyBinding:new d(37,!0,!0),predefined:!0}),l.push({actionID:"selectLineEnd",keyBinding:new d(39,!0,!0),predefined:!0}),l.push({actionID:"selectWordPrevious",keyBinding:new d(37,
null,!0,!0),predefined:!0}),l.push({actionID:"selectWordNext",keyBinding:new d(39,null,!0,!0),predefined:!0}),l.push({actionID:"selectTextStart",keyBinding:new d(36,null,!0),predefined:!0}),l.push({actionID:"selectTextEnd",keyBinding:new d(35,null,!0),predefined:!0}),l.push({actionID:"selectTextStart",keyBinding:new d(38,!0,!0),predefined:!0}),l.push({actionID:"selectTextEnd",keyBinding:new d(40,!0,!0),predefined:!0}),l.push({actionID:"selectLineStart",keyBinding:new d(37,null,!0,null,!0),predefined:!0}),
l.push({actionID:"selectLineEnd",keyBinding:new d(39,null,!0,null,!0),predefined:!0}),l.push({actionID:"selectLineStart",keyBinding:new d(38,null,!0,!0),predefined:!0}),l.push({actionID:"selectLineEnd",keyBinding:new d(40,null,!0,!0),predefined:!0})):(w.isLinux&&(l.push({actionID:"selectWholeLineUp",keyBinding:new d(38,!0,!0),predefined:!0}),l.push({actionID:"selectWholeLineDown",keyBinding:new d(40,!0,!0),predefined:!0})),l.push({actionID:"selectLineStart",keyBinding:new d(36,null,!0),predefined:!0}),
l.push({actionID:"selectLineEnd",keyBinding:new d(35,null,!0),predefined:!0}),l.push({actionID:"selectWordPrevious",keyBinding:new d(37,!0,!0),predefined:!0}),l.push({actionID:"selectWordNext",keyBinding:new d(39,!0,!0),predefined:!0}),l.push({actionID:"selectTextStart",keyBinding:new d(36,!0,!0),predefined:!0}),l.push({actionID:"selectTextEnd",keyBinding:new d(35,!0,!0),predefined:!0}));l.push({actionID:"undo",keyBinding:new t.KeyBinding("z",!0),predefined:!0});w.isMac?l.push({actionID:"redo",keyBinding:new t.KeyBinding("z",
!0,!0),predefined:!0}):l.push({actionID:"redo",keyBinding:new t.KeyBinding("y",!0),predefined:!0});l.push({actionID:"deletePrevious",keyBinding:new d(8),predefined:!0});l.push({actionID:"deletePrevious",keyBinding:new d(8,null,!0),predefined:!0});l.push({actionID:"deleteNext",keyBinding:new d(46),predefined:!0});l.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0),predefined:!0});l.push({actionID:"deleteWordPrevious",keyBinding:new d(8,!0,!0),predefined:!0});l.push({actionID:"deleteWordNext",
keyBinding:new d(46,!0),predefined:!0});l.push({actionID:"tab",keyBinding:new d(9),predefined:!0});l.push({actionID:"shiftTab",keyBinding:new d(9,null,!0),predefined:!0});l.push({actionID:"enter",keyBinding:new d(13),predefined:!0});l.push({actionID:"enter",keyBinding:new d(13,null,!0),predefined:!0});l.push({actionID:"escape",keyBinding:new d(27),predefined:!0});l.push({actionID:"selectAll",keyBinding:new d("a",!0),predefined:!0});l.push({actionID:"toggleTabMode",keyBinding:new d("m",!0),predefined:!0});
w.isMac&&(l.push({actionID:"deleteNext",keyBinding:new d(46,null,!0),predefined:!0}),l.push({actionID:"deleteWordPrevious",keyBinding:new d(8,null,null,!0),predefined:!0}),l.push({actionID:"deleteWordNext",keyBinding:new d(46,null,null,!0),predefined:!0}));l.push({actionID:"toggleWrapMode",keyBinding:new t.KeyBinding("w",!0,!1,!0)});l.push({actionID:"toggleOverwriteMode",keyBinding:new t.KeyBinding(45)});if(!w.isFirefox){var k=w.isMac&&w.isChrome;l.push({actionID:"noop",keyBinding:new d("u",!k,!1,
!1,k),predefined:!0});l.push({actionID:"noop",keyBinding:new d("i",!k,!1,!1,k),predefined:!0});l.push({actionID:"noop",keyBinding:new d("b",!k,!1,!1,k),predefined:!0})}w.isFirefox&&(l.push({actionID:"copy",keyBinding:new d(45,!0),predefined:!0}),l.push({actionID:"paste",keyBinding:new d(45,null,!0),predefined:!0}),l.push({actionID:"cut",keyBinding:new d(46,null,!0),predefined:!0}));w.isMac&&(l.push({actionID:"lineStart",keyBinding:new d("a",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"lineEnd",
keyBinding:new d("e",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"lineUp",keyBinding:new d("p",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"lineDown",keyBinding:new d("n",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"charPrevious",keyBinding:new d("b",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"charNext",keyBinding:new d("f",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"deletePrevious",keyBinding:new d("h",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"deleteNext",keyBinding:new d("d",!1,
!1,!1,!0),predefined:!0}),l.push({actionID:"deleteLineEnd",keyBinding:new d("k",!1,!1,!1,!0),predefined:!0}),w.isFirefox?(l.push({actionID:"scrollPageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"deleteLineStart",keyBinding:new d("u",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"deleteWordPrevious",keyBinding:new d("w",!1,!1,!1,!0),predefined:!0})):(l.push({actionID:"pageDown",keyBinding:new d("v",!1,!1,!1,!0),predefined:!0}),l.push({actionID:"centerLine",keyBinding:new d("l",
!1,!1,!1,!0),predefined:!0}),l.push({actionID:"enterNoCursor",keyBinding:new d("o",!1,!1,!1,!0),predefined:!0})));return l};return{KeyMode:u,DefaultKeyMode:d}});B("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(t,w,u){function d(d){d=d||{};this._document=d.document||document}var q={};d.getTheme=function(l){l=l||"default";var k=q[l];k||(k=q[l]=new d);return k};d.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(d,k){var q=this,
p=q._themeClass;q._themeClass=d;this._load(d,k,function(){q.onThemeChanged({type:"ThemeChanged",oldValue:p,newValue:q.getThemeClass()})})},onThemeChanged:function(d){return this.dispatchEvent(d)},buildStyleSheet:function(d,k){var q=function(a){return a.replace(this._capitalRegEx,function(a){return"-"+a}.bind(this)).toLowerCase()}.bind(this),p=function(a,b,c,e,n){var m=[];Object.keys(a).forEach(function(f){var v=a[f];"string"===typeof v?m.push("\t"+q(f)+": "+v+";"):p(v,c===f?b:b+(e?" .":".")+f,c,!1,
n)});m.length&&(n.push(b+(e?".textview":"")+" {"),n.push.apply(n,m),n.push("}"))},b=[""];p(k.styles,"."+d,k.className,!0,b);return b.join("\n")},_createStyle:function(d,k,q,p){var b=this._document;d="orion-theme-"+d;var a=b.getElementById(d);if(a){if(p||a.firstChild.data===k)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(k))}else p?(a=u.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=k,a.addEventListener("load",function(){q()})):(a=u.createElement(b,"style"),
a.appendChild(b.createTextNode(k))),a.id=d,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);p||q()},_load:function(d,k,q){if(d)if("string"===typeof k)this._createStyle(d,k,q);else if(k=k.href,".css"!==k.substring(k.length-4)&&(k+=".css"),/^\//.test(k)||/[a-zA-Z0-9]+:\/\//i.test(k)||!t.toUrl)this._createStyle(d,k,q,!0);else{var p=this;t(["text!"+k],function(b){p._createStyle(d,b,q,!1)})}else q()},_capitalRegEx:/[A-Z]/g};w.EventTarget.addMixin(d.prototype);return{TextTheme:d}});
B("orion/editor/util",[],function(){return{contains:function(t,w){if(!w)return!1;if(!t.compareDocumentPosition){for(var u=w;u;){if(t===u)return!0;u=u.parentNode}return!1}return t===w||0!==(t.compareDocumentPosition(w)&16)},getNodeStyle:function(t,w,u){var d;if(t&&(d=t.style[w],!d))if(t.currentStyle){for(d=0;-1!==(d=w.indexOf("-",d));)w=w.substring(0,d)+w.substring(d+1,d+2).toUpperCase()+w.substring(d+2);d=t.currentStyle[w]}else d=(t=t.ownerDocument.defaultView.getComputedStyle(t,null))?t.getPropertyValue(w):
null;return d||u},addEventListener:function(t,w,u,d){"function"===typeof t.addEventListener?t.addEventListener(w,u,!0===d):t.attachEvent("on"+w,u)},removeEventListener:function(t,w,u,d){"function"===typeof t.removeEventListener?t.removeEventListener(w,u,!0===d):t.detachEvent("on"+w,u)},Animation:function(){function t(t){this.options=t}t.prototype.play=function(){var t="number"===typeof this.options.duration?this.options.duration:350,u=this.options.easing||this.defaultEasing,d=this.options.onAnimate||
function(){},q=this.options.curve[0],l=this.options.curve[1],k=l-q,s=-1,p,b=this;this.interval=this.options.window.setInterval(function(){s=-1===s?(new Date).getTime():s;var a=((new Date).getTime()-s)/t;1>a?(a=u(a),p=q+a*k,d(p)):(d(l),b.stop())},"number"===typeof this.options.rate?this.options.rate:20)};t.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};t.prototype.defaultEasing=function(t){return Math.sin(t*(Math.PI/2))};return t}()}});
B("orion/metrics",[],function(){function t(d,q){var l=window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search,k=window.location.pathname+window.location.search,s=document.title;u=d;u.forEach(function(d){d.pageLoad(l,k,s,q)})}function w(d,q,l,k){u.forEach(function(s){s.logTiming(d,q,l,k)})}var u=[];return{init:t,initFromRegistry:function(d,q){var l=[];d.getServiceReferences("orion.metrics").forEach(function(k){l.push(d.getService(k))});t(l,q)},logEvent:function(d,
q,l,k){u.forEach(function(s){s.logEvent(d,q,l,k)})},logPageLoadTiming:function(d,q){window.performance&&(window.performance.getEntriesByName&&window.performance.mark&&!window.performance.getEntriesByName(d).length)&&(window.performance.mark(d),w("page",d,window.performance.now(),q))},logTiming:w}});B("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util orion/metrics".split(" "),
function(t,w,u,d,q,l,k,s){function p(g,x,a){if(a){x.className="";a=x.attributes;for(var b=a.length;0<b--;)(!k.isIE||9<=k.isIE||9>k.isIE&&a[b].specified)&&x.removeAttribute(a[b].name)}if(g){g.styleClass&&(x.className=g.styleClass);if(a=g.style)for(var f in a)a.hasOwnProperty(f)&&(x.style[f]=a[f]);if(g=g.attributes)for(var c in g)g.hasOwnProperty(c)&&x.setAttribute(c,g[c])}}function b(g){return g instanceof Array?g.slice(0):g}function a(g,x){if(!g)return x;if(!x)return g;for(var a in x)x.hasOwnProperty(a)&&
(g.hasOwnProperty(a)||(g[a]=x[a]));return g}function h(g,x){if(g===x)return!0;if(g&&!x||!g&&x||g&&g.constructor===String||x&&x.constructor===String)return!1;if(g instanceof Array||x instanceof Array){if(!(g instanceof Array&&x instanceof Array)||g.length!==x.length)return!1;for(var a=0;a<g.length;a++)if(!h(g[a],x[a]))return!1;return!0}if(!(g instanceof Object)||!(x instanceof Object))return!1;for(a in g)if(g.hasOwnProperty(a)&&(!x.hasOwnProperty(a)||!h(g[a],x[a])))return!1;for(a in x)if(!g.hasOwnProperty(a))return!1;
return!0}function c(g,x,a){for(var b=0,f=0,c=0,e=g.length;c<e;){-1!==b&&b<=c&&(b=g.indexOf("\r",c));-1!==f&&f<=c&&(f=g.indexOf("\n",c));var h=c,n;if(-1===f&&-1===b){x(g.substring(c));break}-1!==b&&-1!==f?b+1===f?(n=b,c=f+1):(n=b<f?b:f,c=(b<f?b:f)+1):-1!==b?(n=b,c=b+1):(n=f,c=f+1);x(g.substring(h,n));a?a():c===e&&x("")}}function e(g){var x,a,b,f,c=g.ownerDocument.defaultView||g.ownerDocument.parentWindow;c.getComputedStyle?(g=c.getComputedStyle(g,null),x=g.getPropertyValue("padding-left"),a=g.getPropertyValue("padding-top"),
b=g.getPropertyValue("padding-right"),f=g.getPropertyValue("padding-bottom")):g.currentStyle&&(x=g.currentStyle.paddingLeft,a=g.currentStyle.paddingTop,b=g.currentStyle.paddingRight,f=g.currentStyle.paddingBottom);return{left:parseInt(x,10)||0,top:parseInt(a,10)||0,right:parseInt(b,10)||0,bottom:parseInt(f,10)||0}}function n(g){var x,a,b,f,c=g._trim;if(!c){var c=e(g),h=g.ownerDocument.defaultView||g.ownerDocument.parentWindow;h.getComputedStyle?(f=h.getComputedStyle(g,null),x=f.getPropertyValue("border-left-width"),
a=f.getPropertyValue("border-top-width"),b=f.getPropertyValue("border-right-width"),f=f.getPropertyValue("border-bottom-width")):g.currentStyle&&(x=g.currentStyle.borderLeftWidth,a=g.currentStyle.borderTopWidth,b=g.currentStyle.borderRightWidth,f=g.currentStyle.borderBottomWidth);x=parseInt(x,10)||0;a=parseInt(a,10)||0;b=parseInt(b,10)||0;f=parseInt(f,10)||0;c.left+=x;c.top+=a;c.right+=b;c.bottom+=f;g._trim=c}return c}function m(g,x,a,b){function f(x){if(x.animationName===e){var a=x.target;"function"===
typeof a.__DOMReady&&(g.defaultView||g.parentWindow).setTimeout(function(){a.__DOMReady()},0)}}function c(g,x){for(var a=["","-webkit-","-moz-","-ms-","-o-"],C="",b="body ."+g+" {\n",f=0;f<a.length;f++)C+="@"+a[f]+"keyframes "+x+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",b+=a[f]+"animation-duration: 0.001s;\n"+a[f]+"animation-name: "+x+";\n";return C+(b+"}")}a="_"+a+"DOMReady";x.className=x.className?x.className+" "+a:a;x.__DOMReady=b;b=a+"Style";if(!g.getElementById(b)){var e=a+"Animation";
E(g,"animationstart",f,!1);E(g,"MSAnimationStart",f,!1);E(g,"webkitAnimationStart",f,!1);x=g.createElement("style");x.id=b;b=g.getElementsByTagName("head")[0]||g.documentElement;x.appendChild(g.createTextNode(c(a,e)));b.insertBefore(x,b.firstChild)}}function f(g,x,a){this.start=g;this.end=x;this.caret=a;this._columnX=-1}function v(g){this._view=g;this._divs=[];for(var x=g._clipDiv||g._rootDiv,a=0;3>a;a++){var b=g._createSelectionDiv();x.appendChild(b);this._divs.push(b)}}function r(g){this.left=g.left;
this.top=g.top;this.right=g.right;this.bottom=g.bottom}function y(g,x,a){this.view=g;this.lineIndex=x;this._lineDiv=a}function z(g){this._init(g||{})}var E=l.addEventListener,A=l.removeEventListener,F=l.Animation;f.compare=function(g,x){if(g.length!==x.length)return!1;for(var a=0;a<g.length;a++)if(!g[a].equals(x[a]))return!1;return!0};f.editing=function(g,x){var a;if(x){for(a=g.length-1;0<=a;a--)if(g[a]._editing)return g[a];return g[g.length-1]}for(a=0;a<g.length;a++)if(g[a]._editing)return g[a];
return g[0]};f.convert=function(g){return 1===g.length?g[0]:g};f.contains=function(g,x){return g.some(function(g){return g.contains(x)})};f.merge=function(g){if(1>=g.length)return g;g.sort(function(g,x){return g.start-x.start});for(var x=[],a=g[0],b=1;b<g.length;b++)g[b].start>=a.end||a._editing||g[b]._editing?(x.push(a),a=g[b]):a.end=Math.max(a.end,g[b].end);x.push(a);return x};f.prototype={clone:function(){var g=new f(this.start,this.end,this.caret);g._columnX=this._columnX;g._editing=this._editing;
g._docX=this._docX;return g},contains:function(g){return this.start<=g&&g<this.end?!0:!1},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(g){this.caret?this.start=g:this.end=g;this.start>this.end&&(g=this.start,this.start=this.end,this.end=g,this.caret=!this.caret)},setCaret:function(g){this.end=this.start=g;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},getAnchor:function(){return this.caret?this.end:this.start},getOrientedSelection:function(){return{start:this.getAnchor(),
end:this.getCaret()}},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(g){return this.caret===g.caret&&this.start===g.start&&this.end===g.end&&this._editing===g._editing}};v.prototype={destroy:function(){this._divs&&(this._divs.forEach(function(g){g.parentNode.removeChild(g)}),this._divs=null)},setPrimary:function(g){this.primary=g},update:function(){var g=this._view,
x=this.primary,a=g._hasFocus,g=g._cursorVisible,b=!this.primary&&this._selection&&this._selection.isEmpty(),f;f=b?"textviewSelectionCaret":a?"textviewSelection":"textviewSelectionUnfocused";this._divs[0].style.visibility=b&&g&&a||!b?"visible":"hidden";this._divs[0].style.zIndex=g&&b?"2":"0";this._divs.forEach(function(g){g.className=f;k.isWebkit&&x&&(g.style.background=a?"transparent":"")})},setSelection:function(g){this._selection=g;this.update();var x=this._view,a=x._model,b=a.getLineAtOffset(g.start),
f=a.getLineAtOffset(g.end),c=x._getLineNext();if(c){var e=x._getLinePrevious(),h;b<c.lineIndex?(b=c,h=a.getLineStart(c.lineIndex)):b>e.lineIndex?(b=e,h=a.getLineStart(e.lineIndex)):(b=x._getLineNode(b),h=g.start);f<c.lineIndex?(x=c,a=a.getLineStart(c.lineIndex)):f>e.lineIndex?(x=e,a=a.getLineStart(e.lineIndex)):(x=x._getLineNode(f),a=g.end);this._setDOMSelection(b,h,x,a,g.caret)}},_setDOMSelection:function(g,x,a,b,f){this._setDOMFullSelection(g,x,a,b);if(this.primary){var c=this._view;g=g._line.getNodeOffset(x);
a=a._line.getNodeOffset(b);if(g.node&&a.node)if(b=c._getWindow(),x=c._parent.ownerDocument,b.getSelection){var e=b.getSelection();b=x.createRange();b.setStart(g.node,g.offset);b.setEnd(a.node,a.offset);if(c._hasFocus&&(e.anchorNode!==g.node||e.anchorOffset!==g.offset||e.focusNode!==a.node||e.focusOffset!==a.offset||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==g.node||e.focusOffset!==g.offset))c._anchorNode=g.node,c._anchorOffset=g.offset,c._focusNode=a.node,c._focusOffset=a.offset,
c._ignoreSelect=!1,0<e.rangeCount&&e.removeAllRanges(),e.addRange(b),c._ignoreSelect=!0;c._cursorDiv&&(b=x.createRange(),f?(b.setStart(g.node,g.offset),b.setEnd(g.node,g.offset)):(b.setStart(a.node,a.offset),b.setEnd(a.node,a.offset)),f=b.getClientRects()[0],g=c._cursorDiv.parentNode,a=g.getBoundingClientRect(),f&&a&&(c._cursorDiv.style.top=f.top-a.top+g.scrollTop+"px",c._cursorDiv.style.left=f.left-a.left+g.scrollLeft+"px"))}else x.selection&&c._hasFocus&&(f=x.body,b=k.createElement(x,"div"),f.appendChild(b),
f.removeChild(b),b=f.createTextRange(),b.moveToElementText(g.node.parentNode),b.moveStart("character",g.offset),f=f.createTextRange(),f.moveToElementText(a.node.parentNode),f.moveStart("character",a.offset),b.setEndPoint("EndToStart",f),c._ignoreSelect=!1,b.select(),c._ignoreSelect=!0)}},_setDOMFullSelection:function(g,x,a,b){this._divs.forEach(function(g){g.style.width=g.style.height="0px"});var f=this._view;if(f._fullSelection&&!k.isIOS&&!(g===a&&x===b&&this.primary)){var c=f._getViewPadding(),
e=f._clientDiv.getBoundingClientRect(),h=f._viewDiv.getBoundingClientRect(),n=h.left+c.left,m=e.right,c=h.top+c.top,r=e.bottom,h=e=0;f._clipDiv?(h=f._clipDiv.getBoundingClientRect(),e=h.left-f._clipDiv.scrollLeft):(h=f._rootDiv.getBoundingClientRect(),e=h.left);h=h.top;f._ignoreDOMSelection=!0;var v=new y(f,g.lineIndex,g),d=v.getBoundingClientRect(x,!1),p=d.left;g===a&&x===b?(x=v,b=d):(x=new y(f,a.lineIndex,a),b=x.getBoundingClientRect(b,!1));x=b.left;f._ignoreDOMSelection=!1;var v=this._divs[0],
p=Math.min(m,Math.max(n,p)),l=Math.min(r,Math.max(c,d.top)),z=m,f=Math.min(r,Math.max(c,d.bottom));v.style.left=p-e+"px";v.style.top=l-h+"px";v.style.width=Math.max(0,z-p)+"px";v.style.height=Math.max(0,f-l)+"px";g.lineIndex===a.lineIndex?(z=Math.min(x,m),v.style.width=Math.max(this.primary?0:1,z-p)+"px"):(d=Math.min(r,Math.max(c,b.top)),x=Math.min(m,Math.max(n,x)),c=Math.min(r,Math.max(c,b.bottom)),r=this._divs[2],r.style.left=n-e+"px",r.style.top=d-h+"px",r.style.width=Math.max(0,x-n)+"px",r.style.height=
Math.max(0,c-d)+"px",1<Math.abs(g.lineIndex-a.lineIndex)&&(g=this._divs[1],g.style.left=n-e+"px",g.style.top=f-h+"px",g.style.width=Math.max(0,m-n)+"px",g.style.height=Math.max(0,d-f)+"px"))}}};r.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};y.prototype={create:function(g,x){if(!this._lineDiv){var a=this._lineDiv=this._createLine(g,x,this.lineIndex);a._line=this;return a}},_createLine:function(g,a,b){var f=this.view,c=f._model,
e=c.getLine(b),n=c.getLineStart(b),m={type:"LineStyle",textView:f,lineIndex:b,lineText:e,lineStart:n};f.onLineStyle(m);var r=g.ownerDocument,c=a||k.createElement(r,"div");if(!a||!h(a.viewStyle,m.style))p(m.style,c,a),a&&(a._trim=null),c.viewStyle=m.style,c.setAttribute("role","presentation");c.lineIndex=b;if(a&&c.viewLineText===e&&h(m.ranges,c.viewRanges))return c;c.viewRanges=m.ranges;c.viewLineText=e;b=[];this._createRanges(m.ranges,e,0,e.length,n,{tabOffset:0,ranges:b});m=" ";!f._fullSelection&&
9>k.isIE&&(m="\ufeff");f={text:m,style:f._metrics.largestFontStyle,ignoreChars:1};0===b.length||!b[b.length-1].style||"div"!==b[b.length-1].style.tagName?b.push(f):b.splice(b.length-1,0,f);var v,d,y,l=m=0;if(k.isFirefox&&2E3<e.length){a&&(c.innerHTML="",a.lineWidth=void 0);a=r.createDocumentFragment();for(e=0;e<b.length;e++)f=b[e],n=f.text,v=f.style,v=this._createSpan(c,n,v,f.ignoreChars),a.appendChild(v);c.appendChild(a)}else{var z,q;if(a){if(d=a.modelChangedEvent)0===d.removedLineCount&&0===d.addedLineCount?
(q=d.start-n,z=d.addedCharCount-d.removedCharCount):q=-1,a.modelChangedEvent=void 0;d=a.firstChild}for(e=0;e<b.length;e++){f=b[e];n=f.text;m+=n.length;v=f.style;if(d)if(y=d.firstChild.data,r=d.viewStyle,y===n&&h(v,r)){l+=y.length;d._rectsCache=void 0;v=d=d.nextSibling;continue}else for(;d;){if(-1!==q){r=m;r>=q&&(r-=z);y=(y=d.firstChild.data)?y.length:0;if(l+y>r)break;l+=y}r=d.nextSibling;c.removeChild(d);d=r}v=this._createSpan(c,n,v,f.ignoreChars);d?c.insertBefore(v,d):c.appendChild(v);a&&(a.lineWidth=
void 0)}if(a)for(z=v?v.nextSibling:null;z;)r=z.nextSibling,a.removeChild(z),z=r}c.parentNode||g.appendChild(c);return c},_createRanges:function(g,a,b,f,c,e){if(!(b>f)){if(g)for(var n=0;n<g.length;n++){var m=g[n];if(!(m.end<c+b)){var r=Math.max(c+b,m.start)-c;if(r>f)break;var v=Math.min(c+f,m.end)-c;if(r<=v){r=Math.max(b,r);v=Math.min(f,v);b<r&&this._createRange(a,b,r,null,e);if(!m.style||!m.style.unmergeable)for(;n+1<g.length&&g[n+1].start-c===v&&h(m.style,g[n+1].style);)m=g[n+1],v=Math.min(c+f,m.end)-
c,n++;this._createRange(a,r,v,m.style,e);b=v}}}b<f&&this._createRange(a,b,f,null,e)}},_createRange:function(g,a,b,f,c){if(!(a>b)){var e=this.view._customTabSize;if(e&&8!==e)for(var h=g.indexOf("\t",a);-1!==h&&h<b;){a<h&&(a={text:g.substring(a,h),style:f},c.ranges.push(a),c.tabOffset+=a.text.length);a=e-c.tabOffset%e;if(0<a){for(var n="\u00a0",m=1;m<a;m++)n+=" ";a={text:n,style:f,ignoreChars:a-1};c.ranges.push(a);c.tabOffset+=a.text.length}a=h+1;if(a===b)return;h=g.indexOf("\t",a)}a<=b&&(a={text:g.substring(a,
b),style:f},c.ranges.push(a),c.tabOffset+=a.text.length)}},_createSpan:function(g,a,b,c){var f=this.view,e="span";b&&b.tagName&&(e=b.tagName.toLowerCase());var h="a"===e;h&&(this.hasLink=!0);h&&!f._linksVisible&&(e="span");h=g.ownerDocument;g=k.createElement(g.ownerDocument,e);g.appendChild(h.createTextNode(b&&b.text?b.text:a));b&&b.html?(g.innerHTML=b.html,g.ignore=!0):b&&b.node&&(g.appendChild(b.node),g.ignore=!0);p(b,g);if("a"===e){var n=f._getWindow();E(g,"click",function(g){return f._handleLinkClick(g?
g:n.event)},!1)}g.viewStyle=b;c&&(g.ignoreChars=c);return g},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(g,a){var b=this._ensureCreated(),f=this.view;if(void 0===g)return this._getLineBoundingClientRect(b,!0);var c=f._model,e=b.ownerDocument,h=this.lineIndex,n=null;if(g<c.getLineEnd(h)){var m=c.getLineStart(h);this.forEach(function(a){var x=a.firstChild,c=this._nodeLength(a);if(m+c>g){var h=g-
m;if(1===x.length)n=new r(a.getBoundingClientRect());else if(f._isRangeRects)c=e.createRange(),c.setStart(x,h),c.setEnd(x,h+1),n=new r(c.getBoundingClientRect());else if(k.isIE)c=e.body.createTextRange(),c.moveToElementText(a),c.collapse(),(x=0===h&&8===k.isIE)&&(h=1),c.moveEnd("character",h+1),c.moveStart("character",h),n=new r(c.getBoundingClientRect()),x&&(n.left=a.getClientRects()[0].left);else{var v=x.data;a.removeChild(x);a.appendChild(e.createTextNode(v.substring(0,h)));var d=k.createElement(e,
"span");d.appendChild(e.createTextNode(v.substring(h,h+1)));a.appendChild(d);a.appendChild(e.createTextNode(v.substring(h+1)));n=new r(d.getBoundingClientRect());a.innerHTML="";a.appendChild(x);this._createdDiv||(a=f._getSelections()[0],(m<=a.start&&a.start<m+c||m<=a.end&&a.end<m+c)&&f._updateDOMSelection())}11>k.isIE&&(h=b.ownerDocument.defaultView||b.ownerDocument.parentWindow,a=h.screen.logicalXDPI/h.screen.deviceXDPI,h=h.screen.logicalYDPI/h.screen.deviceYDPI,n.left*=a,n.right*=a,n.top*=h,n.bottom*=
h);return!1}m+=c;return!0})}c=this.getBoundingClientRect();n||(f._wrapMode?(h=this.getClientRects(),n=h[h.length-1],n.left=n.right,n.left+=c.left,n.top+=c.top,n.right+=c.left,n.bottom+=c.top):(n=new r(c),n.left=n.right));if(a||void 0===a)n.left-=c.left,n.top-=c.top,n.right-=c.left,n.bottom-=c.top;return n},forEach:function(g){for(var a=this._ensureCreated().firstChild;a;){var b=a.nextSibling;if(!a.ignore&&!g.call(this,a))break;a=b}},_getClientRects:function(g,a){var b,c,f,e;if(!g._rectsCache){b=g.getClientRects();
c=Array(b.length);for(e=0;e<b.length;e++)f=c[e]=new r(b[e]),f.left-=a.left,f.top-=a.top,f.right-=a.left,f.bottom-=a.top;g._rectsCache=c}b=g._rectsCache;c=[b.length];for(e=0;e<b.length;e++)c[e]=new r(b[e]);return c},getClientRects:function(g){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var a=[],b=this._ensureCreated().getBoundingClientRect();this.forEach(function(g){g=this._getClientRects(g,b);for(var c=0;c<g.length;c++){var f=g[c],e,h;if(f.top!==f.bottom){var n=f.top+(f.bottom-f.top)/
2;for(e=0;e<a.length&&!(h=a[e],h.top<=n&&n<h.bottom);e++);e===a.length?a.push(f):(f.left<h.left&&(h.left=f.left),f.top<h.top&&(h.top=f.top),f.right>h.right&&(h.right=f.right),f.bottom>h.bottom&&(h.bottom=f.bottom))}}return!0});return void 0!==g?a[g]:a},_getLineBoundingClientRect:function(g,a){var b=new r(g.getBoundingClientRect());if(!this.view._wrapMode){b.right=b.left;for(var c=g.lastChild;c&&c.ignoreChars===c.firstChild.length;)c=c.previousSibling;c&&(c=c.getBoundingClientRect(),b.right=c.right+
n(g).right)}a&&(c=n(g),b.left+=c.left,b.right-=c.right);return b},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(g){if(!this.view._wrapMode)return 0;var a=this.getClientRects();g=this.getBoundingClientRect(g);g=g.top+(g.bottom-g.top)/2;for(var b=0;b<a.length;b++)if(a[b].top<=g&&g<a[b].bottom)return b;return a.length-1},getLineStart:function(g){if(!this.view._wrapMode||0===g)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();
return this.getOffset(a[g].left+1,a[g].top+1)},_nodeLength:function(g){if(!g||g.ignore)return 0;var a=g.firstChild.length;g.ignoreChars&&(a-=g.ignoreChars);return a},getModelOffset:function(g,a){if(!g)return 0;var b=0;this.forEach(function(c){var f=c.firstChild;if(f===g)return c.ignoreChars&&(b-=c.ignoreChars),b+=a,!1;c.ignoreChars&&(b-=c.ignoreChars);b+=f.data.length;return!0});return Math.max(0,b)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(g){var a=0,b,c,f=this.view._model,
e=f.getLineStart(this.lineIndex),h=g-e,n=f.getLineEnd(this.lineIndex)-e;this.forEach(function(g){var f=g.firstChild,e=this._nodeLength(g);if(e+a>h||a+e>=n)return b=f,c=h-a,g.ignoreChars&&(0<e&&c===e)&&(c+=g.ignoreChars),!1;a+=e;return!0});return{node:b,offset:c}},getText:function(g){var a="",b=0;this.forEach(function(c){var f;if(c.ignoreChars){f=c.lastChild;for(var e=0,h=[],n=-1;f;){var m=f.data;if(m)for(var r=m.length-1;0<=r;r--){var v=m.substring(r,r+1);e<c.ignoreChars&&(" "===v||"\ufeff"===v)?
e++:h.push("\u00a0"===v?"\t":v)}g===f&&(n=h.length);f=f.previousSibling}h=h.reverse().join("");-1!==n&&(b=a.length+h.length-n);a+=h}else for(f=c.firstChild;f;)g===f&&(b=a.length),a+=f.data,f=f.nextSibling;return!0});return{text:a,offset:b}},getOffset:function(g,a){function b(c,C,m){var p=c.firstChild,D=d._nodeLength(c),y=r.ownerDocument,l=y.defaultView||y.parentWindow,z=11>k.isIE?l.screen.logicalXDPI/l.screen.deviceXDPI:1,q=11>k.isIE?l.screen.logicalYDPI/l.screen.deviceYDPI:1,s,E,t,l=m.left+v.left,
A,u;if(k.isIE||f._isRangeRects){for(var y=f._isRangeRects?y.createRange():y.body.createTextRange(),F=D,w=-1;1<F-w;){var I=Math.floor((F+w)/2);m=w+1;s=I===D-1&&c.ignoreChars?p.length:I+1;A=0===m&&8===k.isIE;f._isRangeRects?(y.setStart(p,m),y.setEnd(p,s)):(A&&(m=1),y.moveToElementText(c),y.move("character",m),y.moveEnd("character",s-m));u=y.getClientRects();for(var O=!1,N=0;N<u.length;N++)if(m=u[N],s=(A?l:m.left)*z-v.left,t=m.right*z-v.left,E=m.top*q-v.top,m=m.bottom*q-v.top,s<=g&&g<t&&(!f._wrapMode||
E<=a&&a<=m)){O=!0;break}O?F=I:w=I}C+=F;m=F;s=F===D-1&&c.ignoreChars?p.length:Math.min(F+1,p.length);f._isRangeRects?(y.setStart(p,m),y.setEnd(p,s)):(y.moveToElementText(c),y.move("character",m),y.moveEnd("character",s-m));u=y.getClientRects();D=!1;0<u.length&&(m=u[0],s=(A?l:m.left)*z-v.left,t=m.right*z-v.left,D=g>s+(t-s)/2);c=C-n;p=e.getLine(h);z=p.charCodeAt(c);55296<=z&&56319>=z&&D?c<p.length&&(z=p.charCodeAt(c+1),56320<=z&&57343>=z&&(C+=1)):56320<=z&&(57343>=z&&!D)&&0<c&&(z=p.charCodeAt(c-1),55296<=
z&&56319>=z&&(C-=1));D&&C++}else{z=[];for(A=0;A<D;A++)z.push("\x3cspan\x3e"),A===D-1?z.push(p.data.substring(A)):z.push(p.data.substring(A,A+1)),z.push("\x3c/span\x3e");c.innerHTML=z.join("");for(z=c.firstChild;z;){m=z.getBoundingClientRect();s=m.left-v.left;t=m.right-v.left;if(s<=g&&g<t){g>s+(t-s)/2&&C++;break}C++;z=z.nextSibling}d._createdDiv||(c.innerHTML="",c.appendChild(p),c=f._getSelections()[0],(C<=c.start&&c.start<C+D||C<=c.end&&c.end<C+D)&&f._updateDOMSelection())}return C}function c(b){if(b.ignore)return null;
b=d._getClientRects(b,v);for(var e=0;e<b.length;e++){var C=b[e];if(C.left<=g&&g<C.right&&(!f._wrapMode||C.top<=a&&a<=C.bottom))return C}return null}var f=this.view,e=f._model,h=this.lineIndex,n=e.getLineStart(h),m=e.getLineEnd(h);if(n===m)return n;var r=this._ensureCreated(),v=this.getBoundingClientRect(),d=this,p,y;if(f._wrapMode){p=this.getClientRects();a<p[0].top&&(a=p[0].top);for(var l=0;l<p.length&&!(y=p[l],y.top<=a&&a<y.bottom);l++);g<y.left&&(g=y.left);g>y.right&&(g=y.right-1)}else 0>g&&(g=
0),g>v.right-v.left&&(g=v.right-v.left);var z,q;if(this._lastHitChild&&this._lastHitChild.parentNode){if(z=this._lastHitOffset,q=this._lastHitChild,y=c(q),!y){p=z;for(var l=z+this._nodeLength(q),s=q.previousSibling,E=q.nextSibling;s||E;){if(s){p-=this._nodeLength(s);if(y=c(s)){q=s;z=p;break}s=s.previousSibling}if(E){if(y=c(E)){q=E;z=l;break}l+=this._nodeLength(E);E=E.nextSibling}}}}else z=n,this.forEach(function(g){q=g;if(y=c(q))return!1;z+=this._nodeLength(q);return!0});q&&y&&(this._lastHitChild=
q,this._lastHitOffset=z,z=b(q,z,y));return Math.min(m,Math.max(n,z))},getNextOffset:function(g,a){if("line"===a.unit){var b=this.view._model,c=b.getLineAtOffset(g);if(0<a.count)return a.count--,b.getLineEnd(c);a.count++;return b.getLineStart(c)}return"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(g,a):k.isIE?this._getNextOffset_IE(g,a):this._getNextOffset_W3C(g,a)},_getNextOffset_W3C:function(g,a){function b(g){return 33<=g&&47>=g||58<=g&&64>=g||91<=g&&94>=g||
96===g||123<=g&&126>=g}function c(g){return 32===g||9===g}var f=this.view._model,e=f.getLineAtOffset(g),h=f.getLine(e),n=f.getLineStart(e),f=f.getLineEnd(e),e=h.length,m=g-n,r,v=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var d,p,k;0!==a.count;){if(0<a.count){if(m===e)return f;r=h.charCodeAt(m);d=b(r);p=!d&&!c(r);for(m++;m<e;){r=h.charCodeAt(m);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){k=b(r);if("wordend"===a.unit){if(!k&&d)break}else if(k&&
!d)break;r=!k&&!c(r)}else r=!c(r);if("wordend"===a.unit||"wordendWS"===a.unit){if(!r&&p)break}else if(r&&!p)break;p=r;d=k;m++}}else{if(0===m)return n;m--;r=h.charCodeAt(m);d=b(r);for(p=!d&&!c(r);0<m;){r=h.charCodeAt(m-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){k=b(r);if("wordend"===a.unit){if(k&&!d)break}else if(!k&&d)break;r=!k&&!c(r)}else r=!c(r);if("wordend"===a.unit||"wordendWS"===a.unit){if(r&&!p)break}else if(!r&&p)break;p=r;d=k;m--}}a.count-=v}else for(;0!==a.count&&0<=m+v&&m+v<=e;)m+=
v,r=h.charCodeAt(m),56320<=r&&57343>=r&&0<m&&(r=h.charCodeAt(m-1),55296<=r&&56319>=r&&(m+=v)),a.count-=v;return n+m},_getNextOffset_IE:function(g,a){var b=this._ensureCreated(),c=this.view._model,f=this.lineIndex,e=0,h;h=c.getLineStart(f);var n=c.getLine(f),m=c.getLineStart(f),r=b.ownerDocument,v=0>a.count?-1:1;if(g===c.getLineEnd(f)){for(b=b.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;if(!b)return h;e=r.body.createTextRange();e.moveToElementText(b);h=e.text.length;e.moveEnd(a.unit,
v);e=g+e.text.length-h}else if(g===h&&0>a.count)e=h;else for(b=b.firstChild;b;){c=this._nodeLength(b);if(h+c>g){e=r.body.createTextRange();if(g===h&&0>a.count){for(h=b.previousSibling;h&&(!h.firstChild||!h.firstChild.length);)h=h.previousSibling;e.moveToElementText(h?h:b.previousSibling)}else e.moveToElementText(b),e.collapse(),e.moveEnd("character",g-h);h=e.text.length;e.moveEnd(a.unit,v);e=g+e.text.length-h;break}h=c+h;b=b.nextSibling}h=e-m;e=n.charCodeAt(h);56320<=e&&57343>=e&&0<h&&(e=n.charCodeAt(h-
1),55296<=e&&56319>=e&&(h+=v));a.count-=v;return h+m},updateLinks:function(){var g=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(b){var c=b.viewStyle;c&&(c.tagName&&"a"===c.tagName.toLowerCase())&&g.replaceChild(a._createSpan(g,b.firstChild.data,c),b);return!0})}},destroy:function(){var g=this._createdDiv;g&&(g.parentNode.removeChild(g),this._createdDiv=null)}};z.prototype={addKeyMode:function(g,a){var b=this._keyModes;void 0!==a?b.splice(a,0,g):b.push(g);g._modeAdded&&g._modeAdded()},
addRuler:function(g,a){var b=this._rulers;if(void 0!==a){var c,f;for(f=c=0;c<b.length&&f<a;c++)g.getLocation()===b[c].getLocation()&&f++;b.splice(f,0,g);a=f}else b.push(g);this._createRuler(g,a);g.setView(this);this._update()},computeSize:function(){var g=0,a=0,b=this._model,c=this._clientDiv;if(!c)return{width:g,height:a};var f=c.style.width;k.isWebkit&&(c.style.width="0x7fffffffpx");for(var b=b.getLineCount(),e=0;e<b;e++){var h=this._getLine(e),n=h.getBoundingClientRect(),g=Math.max(g,n.right-n.left),
a=a+(n.bottom-n.top);h.destroy()}k.isWebkit&&(c.style.width=f);c=this._getViewPadding();g+=c.right+c.left+this._metrics.scrollWidth;a+=c.bottom+c.top+this._metrics.scrollWidth;return{width:g,height:a}},convert:function(g,a,b){if(!this._clientDiv)return g;var c=this._getScroll(),f=this._getViewPadding(),e=this._viewDiv.getBoundingClientRect();"document"===a&&(void 0!==g.x&&(g.x+=-c.x+e.left+f.left),void 0!==g.y&&(g.y+=-c.y+e.top+f.top));"document"===b&&(void 0!==g.x&&(g.x+=c.x-e.left-f.left),void 0!==
g.y&&(g.y+=c.y-e.top-f.top));return g},destroy:function(){for(var g=0;g<this._rulers.length;g++)this._rulers[g].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},
getActionDescription:function(g){if(g=this._actions[g])return g.actionDescription},getActions:function(g){var a=[],b=this._actions,c;for(c in b)b.hasOwnProperty(c)&&(g||!b[c].defaultHandler)&&a.push(c);return a},getBottomIndex:function(g){return!this._clientDiv?0:this._getBottomIndex(g)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,
y:0,width:0,height:0};var g=this._getScroll();return{x:g.x,y:g.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(g){for(var a=[],b=this._keyModes,c=0;c<b.length;c++)a=a.concat(b[c].getKeyBindings(g));return a},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(g){return!this._clientDiv?0:this._getLineHeight(g)},getLineIndex:function(g){return!this._clientDiv?
0:this._getLineIndex(g)},isValidTextPosition:function(g,a){if(!this._clientDiv)return!1;var b=this._getLineIndex(a,!0);if(0>b)return!1;var b=this._getLine(b),c=this.getOffsetAtLocation(g,a),c=b.getBoundingClientRect(c);b.destroy();return g>c.right?!1:!0},getLinePixel:function(g){return!this._clientDiv?0:this._getLinePixel(g)},getLocationAtOffset:function(g){if(!this._clientDiv)return{x:0,y:0};var a=this._model;g=Math.min(Math.max(0,g),a.getCharCount());var a=a.getLineAtOffset(g),b=this._getLine(a);
g=b.getBoundingClientRect(g);b.destroy();b=g.left;a=this._getLinePixel(a)+g.top;return{x:b,y:a}},getNextOffset:function(g,a){var b=new f(g,g,!1);this._doMove(a,b);return b.getCaret()},getOptions:function(){var g;if(0===arguments.length)g=this._defaultOptions();else if(1===arguments.length){if(g=arguments[0],"string"===typeof g)return b(this["_"+g])}else{g={};for(var a in arguments)arguments.hasOwnProperty(a)&&(g[arguments[a]]=void 0)}for(var c in g)g.hasOwnProperty(c)&&(g[c]=b(this["_"+c]));return g},
getModel:function(){return this._model},getOffsetAtLocation:function(g,a){if(!this._clientDiv)return 0;var b=this._getLineIndex(a),c=this._getLine(b),b=c.getOffset(g,a-this._getLinePixel(b));c.destroy();return b},getLineAtOffset:function(g){return this.getModel().getLineAtOffset(g)},getLineStart:function(g){return this.getModel().getLineStart(g)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){return this._getSelection()},getSelections:function(){return this._getSelections()},
getSelectionText:function(g){var a=[],b=this;this._getSelections().forEach(function(g){g.isEmpty()||a.push(b._getBaseText(g.start,g.end))});return a.join(void 0!==g?g:this._model.getLineDelimiter())},getText:function(g,a){return this._model.getText(g,a)},getTopIndex:function(g){return!this._clientDiv?0:this._getTopIndex(g)},getTopPixel:function(){return!this._clientDiv?0:this._getScroll().y},invokeAction:function(g,a,b){if(this._clientDiv){if(g=this._actions[g]){g.actionDescription&&g.actionDescription.id&&
s.logEvent("editor","action",g.actionDescription.id);if(!a&&g.handler&&g.handler(b))return!0;if(g.defaultHandler)return"boolean"===typeof g.defaultHandler(b)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(g){return this.dispatchEvent(g)},onDragStart:function(g){return this.dispatchEvent(g)},onDrag:function(g){return this.dispatchEvent(g)},onDragEnd:function(g){return this.dispatchEvent(g)},onDragEnter:function(g){return this.dispatchEvent(g)},onDragOver:function(g){return this.dispatchEvent(g)},
onDragLeave:function(g){return this.dispatchEvent(g)},onDrop:function(g){return this.dispatchEvent(g)},onDestroy:function(g){return this.dispatchEvent(g)},onSaving:function(g){return this.dispatchEvent(g)},onInputChanged:function(g){return this.dispatchEvent(g)},onLineStyle:function(g){return this.dispatchEvent(g)},onKeyDown:function(g){return this.dispatchEvent(g)},onKeyPress:function(g){return this.dispatchEvent(g)},onKeyUp:function(g){return this.dispatchEvent(g)},onModelChanged:function(g){return this.dispatchEvent(g)},
onModelChanging:function(g){return this.dispatchEvent(g)},onModify:function(g){return this.dispatchEvent(g)},onMouseDown:function(g){return this.dispatchEvent(g)},onMouseUp:function(g){return this.dispatchEvent(g)},onMouseMove:function(g){return this.dispatchEvent(g)},onMouseOver:function(g){return this.dispatchEvent(g)},onMouseOut:function(g){return this.dispatchEvent(g)},onTouchStart:function(g){return this.dispatchEvent(g)},onTouchMove:function(g){return this.dispatchEvent(g)},onTouchEnd:function(g){return this.dispatchEvent(g)},
onOptions:function(g){return this.dispatchEvent(g)},onSelection:function(g){return this.dispatchEvent(g)},onScroll:function(g){return this.dispatchEvent(g)},onVerify:function(g){return this.dispatchEvent(g)},onFocus:function(g){return this.dispatchEvent(g)},onBlur:function(g){return this.dispatchEvent(g)},redraw:function(){if(!(0<this._redrawCount)){var g=this._model.getLineCount();this.redrawRulers(0,g);this.redrawLines(0,g)}},redrawRulers:function(g,a){if(!(0<this._redrawCount))for(var b=this.getRulers(),
c=0;c<b.length;c++)this.redrawLines(g,a,b[c])},redrawLines:function(g,a,b){if(!(0<this._redrawCount)&&(void 0===g&&(g=0),void 0===a&&(a=this._model.getLineCount()),g!==a)){var c=this._clientDiv;if(c){if(b)for(c=this._getRulerParent(b).firstChild;c&&c._ruler!==b;)c=c.nextSibling;b?c.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(g,a);var f=-1;!b&&-1!==this._imeOffset&&(f=this._model.getLineAtOffset(this._imeOffset));if(!b||"page"===b.getOverview())for(c=c.firstChild;c;){var e=c.lineIndex;
g<=e&&(e<a&&e!==f)&&(c.lineChanged=!0);c=c.nextSibling}!b&&(!this._wrapMode&&g<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this.dispatchEvent({type:"Redraw",startLine:g,endLine:a,ruler:b});this._queueUpdate()}}},redrawRange:function(g,a){if(!(0<this._redrawCount)){var b=this._model;void 0===g&&(g=0);void 0===a&&(a=b.getCharCount());var c=b.getLineAtOffset(g),b=b.getLineAtOffset(Math.max(g,a-1))+1;this.redrawLines(c,
b)}},removeKeyMode:function(g){for(var a=this._keyModes,b=0;b<a.length;b++)if(a[b]===g){a.splice(b,1);break}g._modeRemoved&&g._modeRemoved()},removeRuler:function(g){for(var a=this._rulers,b=0;b<a.length;b++)if(a[b]===g){a.splice(b,1);g.setView(null);this._destroyRuler(g);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(g,a,b){if(g){var c=this._actions,f=c[g];f||(f=c[g]={});f.handler=a;void 0!==b&&(f.actionDescription=b)}},setKeyBinding:function(g,
a){this._keyModes[0].setKeyBinding(g,a)},setCaretOffset:function(g,a,b){var c=this._model.getCharCount();g=Math.max(0,Math.min(g,c));g=new f(g,g,!1);this._setSelection(g,void 0===a||a,!0,b)},setHorizontalPixel:function(g){this._clientDiv&&(g=Math.max(0,g),this._scrollView(g-this._getScroll().x,0))},setRedraw:function(g){g?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(g){if(g!==this._model){g=g||new w.TextModel;this._model.removeEventListener("preChanging",this._modelListener.onChanging);
this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),b=this._model.getCharCount(),c=g.getLineCount(),f=g.getCharCount(),e={type:"ModelChanging",text:g.getText(),start:0,removedCharCount:b,addedCharCount:f,removedLineCount:a,addedLineCount:c};this.onModelChanging(e);this._model=g;e={type:"ModelChanged",start:0,removedCharCount:b,addedCharCount:f,removedLineCount:a,addedLineCount:c};this.onModelChanged(e);this._model.addEventListener("preChanging",
this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},setOptions:function(g){var a=this._defaultOptions(),c;for(c in g)if(g.hasOwnProperty(c)){var f=g[c];if(!h(this["_"+c],f)){var e=a[c]?a[c].update:null;e?e.call(this,f):this["_"+c]=b(f)}}this.onOptions({type:"Options",options:g})},setSelection:function(g,a,b,c){var e=g>a;if(e){var h=g;g=a;a=h}h=this._model.getCharCount();g=Math.max(0,Math.min(g,h));a=Math.max(0,Math.min(a,
h));g=new f(g,a,e);this._setSelection(g,void 0===b||b,!0,c)},setSelections:function(g,a,b){g=this._rangesToSelections(g);this._setSelection(g,void 0===a||a,!0,b)},setText:function(g,a,b,c,e){var h="string"===typeof g,n=void 0===a&&void 0===b&&h;h?(void 0===a&&(a=0),void 0===b&&(b=this._model.getCharCount()),g={text:g,selection:[new f(a,b,!1)]}):g.selection=this._rangesToSelections(g.selection);g._code=!0;n&&(this._variableLineHeight=!1);this._modifyContent(g,!n,void 0===c||c,e);n&&13>k.isFirefox&&
this._fixCaret()},setTopIndex:function(g,a){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,g))-this._getScroll().y,a)},setTopPixel:function(g,a){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,g)-this._getScroll().y,a)},showSelection:function(g,a){return this._showCaret(g?!1:!0,a,g)},update:function(g,a){this._clientDiv&&((g||this._metrics.invalid)&&this._updateStyle(),void 0===a||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(g){this._cancelCheckSelection();
if(!this._ignoreEvent(g)){13>k.isFirefox&&1===g.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var a=this._overlayDiv||this._clientDiv;9>k.isIE&&(a=this._viewDiv);for(var b=g.target?g.target:g.srcElement;b;){if(a===b||b.className&&-1!==b.className.indexOf("textViewFind"))return;b=b.parentNode}g.preventDefault&&g.preventDefault();g.stopPropagation&&g.stopPropagation();if(!this._isW3CEvents){var c=this;this._getWindow().setTimeout(function(){c._clientDiv.focus()},
0)}}},_handleRootMouseUp:function(g){this._ignoreEvent(g)||(13>k.isFirefox&&1===g.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),k.isFirefox&&1===g.which&&(this._fixCaret(),this._ignoreBlur=!1))},_handleBlur:function(){this._cancelCheckSelection();if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>k.isIE&&!this._getSelections()[0].isEmpty()){var g=this._rootDiv,a=k.createElement(g.ownerDocument,"div");g.appendChild(a);g.removeChild(a)}this._cursorDiv&&
(this._cursorDiv.style.display="none");if(this._domSelection)if(this._domSelection.forEach(function(g){g.update()}),g=this._getWindow(),a=this._parent.ownerDocument,g.getSelection){a=g.getSelection();for(g=a.anchorNode;g;){if(g===this._clientDiv){0<a.rangeCount&&a.removeAllRanges();break}g=g.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(g=a.selection.createRange().parentElement();g;){if(g===this._clientDiv){a.selection.empty();break}g=g.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},
_handleCompositionStart:function(g){this._ignoreEvent(g)||(this._imeTimeout&&(this._getWindow().clearTimeout(this._imeTimeout),this._imeTimeout=null),this._imeText&&(this._commitIME(this._imeText),this._imeText=null),this._startIME(),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionUpdate:function(g){this._ignoreEvent(g)||(this._imeText=g.data)},_handleCompositionEnd:function(g){this._ignoreEvent(g)||(this._imeText=g.data,this._imeTimeout=
this._getWindow().setTimeout(function(){this._commitIME(this._imeText);this._imeText=this._imeTimeout=null}.bind(this),0))},_handleContextMenu:function(g){if(!this._ignoreEvent(g)){k.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",g),a.screenX=g.screenX,a.screenY=g.screenY,this.onContextMenu(a),a=a.defaultPrevented):k.isMac&&(k.isFirefox&&0===g.button)&&(a=!0);if(a)return g.preventDefault&&g.preventDefault(),
!1;this._contextMenuOpen=!0;k.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},_handleCopy:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)&&!this._ignoreCopy&&this._doCopy(g))return g.preventDefault&&g.preventDefault(),!1},_handleCut:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)&&this._doCut(g))return g.preventDefault&&g.preventDefault(),!1},_handleDataModified:function(g){this._ignoreEvent(g)||this._startIME()},_handleDblclick:function(g){this._ignoreEvent(g)||
(this._lastMouseTime=g.timeStamp?g.timeStamp:(new Date).getTime(),2!==this._clickCount&&(this._clickCount=2,this._handleMouse(g)))},_handleDragStart:function(g){if(!this._ignoreEvent(g)){if(13>k.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",g)),this._dragOffset=-1;else return g.preventDefault&&
g.preventDefault(),!1}},_handleDrag:function(g){if(!this._ignoreEvent(g)&&this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",g))},_handleDragEnd:function(g){if(!this._ignoreEvent(g)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",g));13>k.isFirefox&&(this._fixCaret(),"none"===g.dataTransfer.dropEffect&&!g.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(g){if(!this._ignoreEvent(g)){var a=
!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",g)));if(k.isWebkit||a)return g.preventDefault&&g.preventDefault(),!1}},_handleDragOver:function(g){if(!this._ignoreEvent(g)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",g)));if(k.isWebkit||a)return a&&(g.dataTransfer.dropEffect="none"),g.preventDefault&&g.preventDefault(),!1}},_handleDragLeave:function(g){if(!this._ignoreEvent(g)&&(this._dropTarget=
!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",g))},_handleDrop:function(g){if(!this._ignoreEvent(g)){this._dropTarget=!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",g));g.preventDefault&&g.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;k.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display=
"block");this._domSelection&&this._domSelection.forEach(function(g){g.update()});if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(g){this._cancelCheckSelection();if(!this._ignoreEvent(g)){if(this.isListening("KeyDown")){var a=this._createKeyEvent("KeyDown",g);this.onKeyDown(a);if(a.defaultPrevented){k.isFirefox&&(this._keyDownPrevented=!0);g.preventDefault();return}}a=!1;switch(g.keyCode){case 16:case 17:case 18:case 91:a=!0;break;default:this._setLinksVisible(!1)}if(229===
g.keyCode){if(this._readonly)return g.preventDefault&&g.preventDefault(),!1;a=!0;k.isSafari&&k.isMac&&g.ctrlKey&&(a=!1,g.keyCode=129);a&&this._startIME()}else a||this._commitIME();if((k.isMac||k.isLinux)&&4>k.isFirefox||12.16>k.isOpera)return this._keyDownEvent=g,!0;if(this._doAction(g))return g.preventDefault?(g.preventDefault(),g.stopPropagation()):(g.cancelBubble=!0,g.returnValue=!1,g.keyCode=0),!1}},_handleKeyPress:function(g){if(!this._ignoreEvent(g))if(this._keyDownPrevented)g.preventDefault&&
(g.preventDefault(),g.stopPropagation()),this._keyDownPrevented=void 0;else{if(k.isMac&&k.isWebkit&&(63232<=g.keyCode&&63487>=g.keyCode||13===g.keyCode||8===g.keyCode)||((k.isMac||k.isLinux)&&4>k.isFirefox||12.16>k.isOpera)&&this._doAction(this._keyDownEvent))return g.preventDefault&&g.preventDefault(),!1;var a=k.isMac?g.metaKey:g.ctrlKey;if(void 0!==g.charCode&&a)switch(g.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(a=this._createKeyEvent("KeyPress",g),this.onKeyPress(a),
a.defaultPrevented)){g.preventDefault();return}if(this._doAction(g))return g.preventDefault?(g.preventDefault(),g.stopPropagation()):(g.cancelBubble=!0,g.returnValue=!1,g.keyCode=0),!1;a=!1;if(k.isMac){if(g.ctrlKey||g.metaKey)a=!0}else if(k.isFirefox){if(g.ctrlKey||g.altKey)a=!0}else g.ctrlKey^g.altKey&&(a=!0);if(!a&&(a=k.isOpera?g.which:void 0!==g.charCode?g.charCode:g.keyCode,31<a))return this._doContent(String.fromCharCode(a)),g.preventDefault&&g.preventDefault(),!1}},_handleDocKeyUp:function(g){(k.isMac?
g.metaKey:g.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(g){if(!this._ignoreEvent(g)){if(this.isListening("KeyUp")){var a=this._createKeyEvent("KeyUp",g);this.onKeyUp(a);if(a.defaultPrevented){g.preventDefault();return}}this._handleDocKeyUp(g);13===g.keyCode&&this._commitIME()}},_handleLinkClick:function(g){if(!(k.isMac?g.metaKey:g.ctrlKey))return g.preventDefault&&g.preventDefault(),!1},_handleMouse:function(g){var a=this._getWindow(),b=!0,c=a;if(k.isIE||k.isFirefox&&!this._overlayDiv)c=
this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var e=this;a.setTimeout(function(){e.focus();e._ignoreFocus=!1},0)}var a=g.shiftKey,h=g.altKey,n=k.isMac?g.metaKey:g.ctrlKey;this._blockSelection=this._doubleClickSelection=null;1===this._clickCount?(b=(!k.isOpera||12.16<=k.isOpera)&&this._hasFocus&&this.isListening("DragStart"),(b=this._setSelectionTo(g.clientX,g.clientY,!0,a,n,b))&&this._setGrab(c)):(this._isW3CEvents&&this._setGrab(c),this._setSelectionTo(g.clientX,g.clientY,
!0,a,n,!1),this._doubleClickSelection=f.editing(this._getSelections()));h&&(this._blockSelection=f.editing(this._getSelections()));return b},_handleMouseDown:function(g){if(!this._ignoreEvent(g)){if(this._linksVisible)if("A"!==(g.target||g.srcElement).tagName)this._setLinksVisible(!1);else return;this._commitIME();var a=g.which;a||(4===g.button&&(a=2),2===g.button&&(a=3),1===g.button&&(a=1));var b=2!==a&&g.timeStamp?g.timeStamp:(new Date).getTime(),c=b-this._lastMouseTime,f=Math.abs(this._lastMouseX-
g.clientX),e=Math.abs(this._lastMouseY-g.clientY),h=this._lastMouseButton===a;this._lastMouseX=g.clientX;this._lastMouseY=g.clientY;this._lastMouseTime=b;this._lastMouseButton=a;1===a&&(this._isMouseDown=!0,h&&c<=this._clickTime&&f<=this._clickDist&&e<=this._clickDist?this._clickCount++:this._clickCount=1);if(this.isListening("MouseDown")&&(b=this._createMouseEvent("MouseDown",g),this.onMouseDown(b),b.defaultPrevented)){g.preventDefault();return}if(1===a&&this._handleMouse(g)&&(9<=k.isIE||k.isOpera||
k.isChrome||k.isSafari||k.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),g.preventDefault();k.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(g){if(!this._ignoreEvent(g)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",g))},_handleMouseOut:function(g){if(!this._ignoreEvent(g)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",g))},_handleMouseMove:function(g){if(!this._animation){var a=
this._isClientDiv(g);if(this.isListening("MouseMove")&&(a||this._isMouseDown)){var b=this._createMouseEvent("MouseMove",g);this.onMouseMove(b);if(b.defaultPrevented){g.preventDefault();return}}if(!this._dropTarget){b=this._linksVisible||this._lastMouseMoveX!==g.clientX||this._lastMouseMoveY!==g.clientY;this._lastMouseMoveX=g.clientX;this._lastMouseMoveY=g.clientY;this._setLinksVisible(b&&!this._isMouseDown&&g.altKey&&(k.isMac?g.metaKey:g.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===
g.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===g.button&&0!==(this._clickCount&1)&&a)return this._clickCount=2,this._handleMouse(g,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){a=g.clientX;g=g.clientY;var c=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect(),e=this._getClientWidth(),h=this._getClientHeight(),b=f.left+c.left,n=f.top+c.top,e=f.left+c.left+e,c=f.top+c.top+h;g<n?this._doAutoScroll("up",a,g-n):g>c?this._doAutoScroll("down",a,g-c):a<b&&!this._wrapMode?
this._doAutoScroll("left",a-b,g):a>e&&!this._wrapMode?this._doAutoScroll("right",a-e,g):(this._endAutoScroll(),this._setSelectionTo(a,g,!1,!0))}}}},_isClientDiv:function(g){var a=this._overlayDiv||this._clientDiv;for(g=g.target?g.target:g.srcElement;g;){if(a===g)return!0;g=g.parentNode}return!1},_createKeyEvent:function(g,a){return{type:g,event:a,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(g,a){var b=this.convert({x:a.clientX,y:a.clientY},"page","document");return{type:g,
event:a,clickCount:this._clickCount,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(g,a){var b=a.touches.length?this.convert({x:a.touches[0].clientX,y:a.touches[0].clientY},"page","document"):{};return{type:g,event:a,touchCount:a.touches.length,x:b.x,y:b.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(g){var a=g.which?0===g.button:1===g.button;if(this.isListening("MouseUp")&&(this._isClientDiv(g)||a&&this._isMouseDown)){var b=
this._createMouseEvent("MouseUp",g);this.onMouseUp(b);if(b.defaultPrevented){g.preventDefault();this._isMouseDown=!1;return}}if(!this._linksVisible){if(a&&this._isMouseDown){var b=this._getSelections(),c=f.editing(b);b.forEach(function(g){g._editing=!1});-1!==this._dragOffset&&(c.extend(this._dragOffset),c.collapse(),b=c,this._dragOffset=-1);this._setSelection(b,!1);this._isMouseDown=!1;this._endAutoScroll();this._isW3CEvents&&this._setGrab(null)}a&&k.isFirefox&&(this._updateDOMSelection(),g.preventDefault())}},
_handleMouseWheel:function(g){if(!this._noScroll){var a=this._getLineHeight(),b=0,c=0;k.isIE||k.isOpera?c=-g.wheelDelta/40*a:k.isFirefox?"wheel"===g.type?g.deltaMode?(b=Math.max(-256,Math.min(256,g.deltaX))*a,c=Math.max(-256,Math.min(256,g.deltaY))*a):(b=g.deltaX,c=g.deltaY):(a=k.isMac?3*g.detail:Math.max(-256,Math.min(256,g.detail))*a,g.axis===g.HORIZONTAL_AXIS?b=a:c=a):k.isMac?(c=g.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=g.timeStamp,b=0!==g.wheelDeltaX%120?1:40>c?40/(40-c):40,c=0!==
g.wheelDeltaY%120?1:40>c?40/(40-c):40,b=Math.ceil(-g.wheelDeltaX/b),-1<b&&0>b&&(b=-1),0<b&&1>b&&(b=1),c=Math.ceil(-g.wheelDeltaY/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1)):(b=-g.wheelDeltaX,c=8*(-g.wheelDeltaY/120)*a);if(k.isSafari||k.isChrome&&k.isMac){for(a=g.target;a&&void 0===a.lineIndex;)a=a.parentNode;this._mouseWheelLine=a}a=this._getScroll();this._scrollView(b,c);b=this._getScroll();if(a.x!==b.x||a.y!==b.y)return g.preventDefault&&g.preventDefault(),!1}},_handlePaste:function(g){this._cancelCheckSelection();
if(!this._ignoreEvent(g)&&!this._ignorePaste&&this._doPaste(g)){if(k.isIE){var a=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){a._updateDOMSelection();a._ignoreFocus=!1},0)}g.preventDefault&&g.preventDefault();return!1}},_handleResize:function(){var g=this._rootDiv.clientWidth,a=this._rootDiv.clientHeight;if(this._rootWidth!==g||this._rootHeight!==a)this._rootWidth!==g&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=g,this._rootHeight=a,g=9>k.isIE,a=this._calculateMetrics(),
h(a,this._metrics)||(this._metrics.invalid&&!a.invalid?this._updateStyle(!1,a):(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=a),g=!0),g?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})},_handleRulerEvent:function(g){for(var a=g.target?g.target:g.srcElement,b=a.lineIndex;a&&!a._ruler;)void 0===b&&void 0!==a.lineIndex&&(b=a.lineIndex),a=a.parentNode;var c=a?a._ruler:null;if(void 0===b&&c&&"document"===c.getOverview()){var f=this._getClientHeight(),
e=this._model.getLineCount(),h=this._getViewPadding(),b=this._viewDiv.getBoundingClientRect(),n=this._getLineHeight(),f=f+h.top+h.bottom-2*this._metrics.scrollWidth;n*e<f?h=h.top:(n=f/e,h=this._metrics.scrollWidth);b=Math.floor((g.clientY-b.top-h)/n);0<=b&&b<e||(b=void 0)}if(c)switch(g.type){case "click":if(c.onClick)c.onClick(b,g);break;case "dblclick":if(c.onDblClick)c.onDblClick(b,g);break;case "mousemove":if(c.onMouseMove)c.onMouseMove(b,g);break;case "mouseover":if(c.onMouseOver)c.onMouseOver(b,
g);break;case "mouseout":if(c.onMouseOut){for(e=g.relatedTarget;e&&e!==this._rootDiv;){if(e===a)return;e=e.parentNode}c.onMouseOut(b,g)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var a=this._getScroll(!1),b=this._hScroll,c=this._vScroll;if(b!==a.x||c!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(c===a.y),this.onScroll({type:"Scroll",oldValue:{x:b,y:c},newValue:a})},_handleSelectStart:function(a){var b=this._contextMenuOpen;this._contextMenuOpen=
!1;if(b)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,b){if(a){var c;c="DIV"===a.tagName?a:a.parentNode.parentNode;return!c._line?0:c._line.getModelOffset(a,b)}},_updateSelectionFromDOM:function(){if(!k.isIOS&&!k.isAndroid&&!this._checkSelectionChange)return!1;var a=this._getWindow().getSelection(),b=this._getModelOffset(a.anchorNode,a.anchorOffset),c=this._getModelOffset(a.focusNode,a.focusOffset),e=this._getSelections()[0];
if(void 0===b||void 0===c||e.start===b&&e.end===c)return!1;if(this._checkSelectionChange){var e=this._getLineNext(),h=this._getLinePrevious();if(a.anchorNode===e.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===h.firstChild.firstChild&&0===a.focusOffset)return!1;if(a.anchorNode===e.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===h.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)b=0,c=this.getModel().getCharCount()}this._setSelection(new f(b,c),
!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(a){var b=this,c=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=c.setTimeout(function(){b._selPollTimer=null;b._clientDiv&&!b._updateSelectionFromDOM()&&
a&&b._pollSelectionChange(a)},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(k.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)&&-1===this._imeOffset){var b=this._getWindow().getSelection();if(b.anchorNode!==this._anchorNode||b.focusNode!==this._focusNode||b.anchorOffset!==this._anchorOffset||b.focusOffset!==this._focusOffset){for(var c=b.anchorNode;c&&void 0===c.lineIndex;)c=c.parentNode;if(c){var f=this._model,
e=c.lineIndex,h=f.getLine(e),n=h,m=0,f=f.getLineStart(e);0<b.rangeCount&&(b.getRangeAt(0).deleteContents(),e=c.ownerDocument.createTextNode(a.data),b.getRangeAt(0).insertNode(e),m=this._getDOMText(c,e),n=m.text,m=m.offset,e.parentNode.removeChild(e));c.lineRemoved=!0;for(c=0;h.charCodeAt(c)===n.charCodeAt(c)&&c<m;)c++;b=h.length-1;for(e=n.length-h.length;h.charCodeAt(b)===n.charCodeAt(b+e)&&b+e>=m+a.data.length;)b--;b++;h=n.substring(c,b+e);c+=f;b+=f;n=this._getSelections();m=n[0].start-c;f=n[0].end-
b;n[0].start=c;n[0].end=b;for(c=1;c<n.length;c++)n[c].start-=m,n[c].end-=f;this._modifyContent({text:h,selection:n,_ignoreDOMSelection:!0},!0)}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){if(this.isListening("TouchStart")){var b=this._createTouchEvent("TouchStart",a);this.onTouchStart(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}this._commitIME();b=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display=
"none",b.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var c=a.touches;if(1===c.length){var c=c[0],f=c.clientX,e=c.clientY;this._touchStartX=f;this._touchStartY=e;if(k.isAndroid&&(e<c.pageY-b.pageYOffset||f<c.pageX-b.pageXOffset))f=c.pageX-b.pageXOffset,e=c.pageY-b.pageYOffset;b=this.convert({x:f,y:e},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(b.x,b.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){if(this.isListening("TouchMove")){var b=
this._createTouchEvent("TouchMove",a);this.onTouchMove(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}b=a.touches;if(1===b.length){b=b[0];this._touchCurrentX=b.clientX;this._touchCurrentY=b.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var c=this,f=this._getWindow();this._touchScrollTimer=f.setInterval(function(){var a=0,g=0;if(c._touching)a=c._touchStartX-
c._touchCurrentX,g=c._touchStartY-c._touchCurrentY,c._touchSpeedX=a/10,c._touchSpeedY=g/10,c._touchStartX=c._touchCurrentX,c._touchStartY=c._touchCurrentY;else{if(0.1>Math.abs(c._touchSpeedX)&&0.1>Math.abs(c._touchSpeedY)){c._vScrollDiv.style.display="none";c._hScrollDiv.style.display="none";f.clearInterval(c._touchScrollTimer);c._touchScrollTimer=null;return}a=10*c._touchSpeedX;g=10*c._touchSpeedY;c._touchSpeedX*=0.95;c._touchSpeedY*=0.95}c._scrollView(a,g)},10)}this._touchScrollTimer&&a.preventDefault()}},
_handleTouchEnd:function(a){if(this.isListening("TouchEnd")){var b=this._createTouchEvent("TouchEnd",a);this.onTouchEnd(b);if(b.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var b,c,f=this._keyModes;for(c=f.length-1;0<=c;c--)if(b=f[c],"function"===typeof b.match&&(b=b.match(a),void 0!==b))return this.invokeAction(b);return!1},_doMove:function(a,b){var c=this._model,f=b.getCaret(),e=c.getLineAtOffset(f);a.count||
(a.count=1);for(;0!==a.count;){var h=c.getLineStart(e);if(0>a.count&&f===h)if(0<e)"character"===a.unit&&a.count++,e--,b.extend(c.getLineEnd(e));else break;else if(0<a.count&&f===c.getLineEnd(e))if(e+1<c.getLineCount())"character"===a.unit&&a.count--,e++,b.extend(c.getLineStart(e));else break;else{var n=!1;a.expandTab&&("character"===a.unit&&0===(f-h)%this._tabSize)&&(h=c.getText(h,f),n=!/[^ ]/.test(h));n?(b.extend(f-this._tabSize),a.count+=0>a.count?1:-1):(h=this._getLine(e),b.extend(h.getNextOffset(f,
a)),h.destroy())}f=b.getCaret()}return b},_doBackspace:function(a){var b=this,c=this._getSelections();c.forEach(function(c){c.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=b._expandTab,b._doMove(a,c))});this._modifyContent({text:"",selection:c},!0);return!0},_doCase:function(a){var b=this,c=this._getSelections(),f=[];c.forEach(function(c){b._doMove(a,c);c=b.getText(c.start,c.end);switch(a.type){case "lower":c=c.toLowerCase();break;case "capitalize":c=c.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});
break;case "reverse":for(var e="",h=0;h<c.length;h++)var n=c[h],m=n.toLowerCase(),n=m!==n?m:n.toUpperCase(),e=e+n;c=e;break;default:c=c.toUpperCase()}f.push(c)});return this._modifyContent({text:f,selection:c,_ignoreDOMSelection:!0},!0)},_doContent:function(a){var b=this,c=this._getSelections();c.forEach(function(a){if(b._overwriteMode&&a.isEmpty()){var g=b._model,c=g.getLineAtOffset(a.end);a.end<g.getLineEnd(c)&&(g=b._getLine(c),a.extend(g.getNextOffset(a.getCaret(),{unit:"character",count:1})),
g.destroy())}});return this._modifyContent({text:a,selection:c,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var b=this.getSelectionText();return b?this._setClipboardText(b,a):!0},_doCursorNext:function(a){var b=this,c=this._getSelections();c.forEach(function(c){!c.isEmpty()&&!a.select?c.start=c.end:b._doMove(a,c);a.select||c.collapse()});this._setSelection(c,!0);return!0},_doCursorPrevious:function(a){var b=this,c=this._getSelections();c.forEach(function(c){!c.isEmpty()&&!a.select?c.end=c.start:
(a.count||(a.count=1),a.count*=-1,b._doMove(a,c));a.select||c.collapse()});this._setSelection(c,!0);return!0},_doCut:function(a){var b=this.getSelectionText();return b?(this._doContent(""),this._setClipboardText(b,a)):!0},_doDelete:function(a){var b=this,c=this._getSelections();c.forEach(function(c){c.isEmpty()&&b._doMove(a,c)});this._modifyContent({text:"",selection:c},!0);return!0},_doEnd:function(a){var b=this._model,c=this,f=this._getSelections();f.forEach(function(f){if(a.ctrl)f.extend(b.getCharCount());
else{var e=f.getCaret(),h=b.getLineAtOffset(e);if(c._wrapMode){var n=c._getLine(h),e=n.getLineIndex(e),e=e===n.getLineCount()-1?b.getLineEnd(h):n.getLineStart(e+1)-1;n.destroy()}else a.count&&0<a.count&&(h=Math.min(h+a.count-1,b.getLineCount()-1)),e=b.getLineEnd(h);f.extend(e)}a.select||f.collapse()});this._setSelection(f,!0,!0,a.ctrl?function(){}:null);return!0},_doEnter:function(a){if(this._singleMode)return!0;var b=this._model,c=this._getSelections();this._doContent(b.getLineDelimiter());a&&a.noCursor&&
(c.forEach(function(a){a.end=a.start}),this._setSelection(c,!0));return!0},_doEscape:function(){var a=this._getSelections();1<a.length&&this._setSelection(a[0],!0);return!0},_doHome:function(a){var b=this._model,c=this,f=this._getSelections();f.forEach(function(f){if(a.ctrl)f.extend(0);else{var e=f.getCaret(),h=b.getLineAtOffset(e);c._wrapMode?(h=c._getLine(h),e=h.getLineIndex(e),e=h.getLineStart(e),h.destroy()):e=b.getLineStart(h);f.extend(e)}a.select||f.collapse()});this._setSelection(f,!0,!0,a.ctrl?
function(){}:null);return!0},_doLineDown:function(a){var b=this._model,c=this,f=this._getSelections();f.forEach(function(f){var e=f.getCaret(),h=b.getLineAtOffset(e),n=c._getLine(h),m=f._columnX,r=1,v=!1;if(-1===m||a.wholeLine||a.select&&k.isIE)m=a.wholeLine?b.getLineEnd(h+1):e,m=f._columnX=n.getBoundingClientRect(m).left;(e=n.getLineIndex(e))<n.getLineCount()-1?r=n.getClientRects(e+1).top+1:(e=b.getLineCount()-1,v=h===e,a.count&&0<a.count?h=Math.min(h+a.count,e):h++);e=!1;if(v){if(a.select||k.isMac||
k.isLinux)f.extend(b.getCharCount()),e=!0}else n.lineIndex!==h&&(n.destroy(),n=c._getLine(h)),f.extend(n.getOffset(m,r)),e=!0;e&&(a.select||f.collapse());n.destroy()});c._setSelection(f,!0,!0,null,0,!1,!0);return!0},_doLineUp:function(a){var b=this._model,c=this,f=this._getSelections();f.forEach(function(f){var e=f.getCaret(),h=b.getLineAtOffset(e),n=c._getLine(h),m=f._columnX,r=!1,v;if(-1===m||a.wholeLine||a.select&&k.isIE)m=a.wholeLine?b.getLineStart(h-1):e,m=f._columnX=n.getBoundingClientRect(m).left;
0<(e=n.getLineIndex(e))?v=n.getClientRects(e-1).top+1:(r=0===h,r||(a.count&&0<a.count?h=Math.max(h-a.count,0):h--,v=c._getLineHeight(h)-1));e=!1;if(r){if(a.select||k.isMac||k.isLinux)f.extend(0),e=!0}else n.lineIndex!==h&&(n.destroy(),n=c._getLine(h)),f.extend(n.getOffset(m,v)),e=!0;e&&(a.select||f.collapse());n.destroy()});c._setSelection(f,!0,!0,null,0,!1,!0);return!0},_doNoop:function(){return!0},_doPageDown:function(a){var b=this,c=this._model,f=this._getSelections(),e=c.getLineCount(),h=this._getScroll(),
n=this._getClientHeight(),m=this._getLineHeight(),r=Math.floor(n/m),v,d,p;f.forEach(function(f){var y=f.getCaret(),l=c.getLineAtOffset(y);if(b._lineHeight){v=f._columnX;var z=b._getBoundsAtOffset(y);if(-1===v||a.select&&k.isIE)v=f._columnX=z.left;y=b._getLineIndex(z.top+n);d=b._getLine(y);var l=b._getLinePixel(y),y=d.getOffset(v,z.top+n-l),q=d.getBoundingClientRect(y);d.destroy();f.extend(y);a.select||f.collapse();p=void 0!==p?Math.min(p,q.top+l-z.top):q.top+l-z.top}else if(l<e-1){z=Math.min(e-l-
1,r);z=Math.max(1,z);v=f._columnX;if(-1===v||a.select&&k.isIE)d=b._getLine(l),v=f._columnX=d.getBoundingClientRect(y).left,d.destroy();d=b._getLine(l+z);f.extend(d.getOffset(v,0));d.destroy();a.select||f.collapse();f=e*m;y=h.y+z*m;y+n>f&&(y=f-n);p=void 0!==p?Math.min(p,y-h.y):y-h.y}});this._setSelection(f,!0,!0,function(){},p,!1,!0);return!0},_doPageUp:function(a){var b=this,c=this._model,f=this._getSelections(),e=this._getScroll(),h=this._getClientHeight(),n=this._getLineHeight(),m=Math.floor(h/
n),r,v,d;f.forEach(function(f){var p=f.getCaret(),y=c.getLineAtOffset(p);if(b._lineHeight){r=f._columnX;y=b._getBoundsAtOffset(p);if(-1===r||a.select&&k.isIE)r=f._columnX=y.left;p=b._getLineIndex(y.bottom-h);v=b._getLine(p);var l=b._getLinePixel(p),p=v.getOffset(r,y.bottom-h-l),z=v.getBoundingClientRect(p);v.destroy();f.extend(p);a.select||f.collapse();d=void 0!==d?Math.max(d,z.top+l-y.top):z.top+l-y.top}else if(0<y){l=Math.max(1,Math.min(y,m));r=f._columnX;if(-1===r||a.select&&k.isIE)v=b._getLine(y),
r=f._columnX=v.getBoundingClientRect(p).left,v.destroy();v=b._getLine(y-l);f.extend(v.getOffset(r,b._getLineHeight(y-l)-1));v.destroy();a.select||f.collapse();f=Math.max(0,e.y-l*n);d=void 0!==d?Math.max(d,f-e.y):f-e.y}});this._setSelection(f,!0,!0,function(){},d,!1,!0);return!0},_doPaste:function(a){var b=this;return null!==this._getClipboardText(a,function(a){if(a.length){k.isLinux&&2===b._lastMouseButton&&(new Date).getTime()-b._lastMouseTime<=b._clickTime&&b._setSelectionTo(b._lastMouseX,b._lastMouseY,
!0);var g=b._getSelections(),c=b._singleMode?"":b._model.getLineDelimiter();b._doContent(1<g.length&&g.length===a.length?a:a.join(c))}})},_doScroll:function(a){var b=a.type,c=this._model,f=c.getLineCount();a=this._getClientHeight();var e=this._getLineHeight(),f=this._lineHeight?this._scrollHeight:f*e,h=this._getScroll().y,n;switch(b){case "textStart":n=0;break;case "textEnd":n=f-a;break;case "pageDown":n=h+a;break;case "pageUp":n=h-a;break;case "lineDown":n=h+e;break;case "lineUp":n=h-e;break;case "centerLine":b=
this._getSelections()[0],n=c.getLineAtOffset(b.start),c=(c.getLineAtOffset(b.end)-n+1)*e,n=n*e-a/2+c/2}void 0!==n&&(n=Math.min(Math.max(0,n),f-a),this._scrollViewAnimated(0,n-h,function(){}));return!0},_doSelectAll:function(){this._setSelection(new f(0,this._model.getCharCount()),!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t",b=this._getSelections();if(this._expandTab){var a=[],c=this._model,f=this._tabSize;b.forEach(function(b){b=b.getCaret();var e=c.getLineAtOffset(b),
e=c.getLineStart(e);a.push(Array(f-(b-e)%f+1).join(" "))})}return this._modifyContent({text:a,selection:b,_ignoreDOMSelection:!0},!0)}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=
this._model,b=this._getSelections(),c=f.editing(b,"down"===this._autoScrollDir),e=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),h=c.getCaret(),n=a.getLineCount(),m=a.getLineAtOffset(h),r;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)h=this._autoScrollY/this._getLineHeight(),h=0>h?Math.floor(h):Math.ceil(h),r=Math.max(0,Math.min(n-1,m+h));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)r=this._getLineIndex(e.y),m=this._getLine(m),e.x+=m.getBoundingClientRect(h,
!1).left,m.destroy();this._blockSelection?b=this._getBlockSelections(b,r,e):0===r&&(k.isMac||k.isLinux)?c.extend(0):r===n-1&&(k.isMac||k.isLinux)?c.extend(a.getCharCount()):(m=this._getLine(r),c.extend(m.getOffset(e.x,e.y-this._getLinePixel(r))),m.destroy());this._setSelection(b,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&
!this._calculateLHTimer){var b=this._model.getLineCount(),c=0;if(a){a=0;for(var f=(new Date).getTime(),e=0;c<b&&!(this._lineHeight[c]||(a++,e||(e=c),this._lineHeight[c]=this._calculateLineHeight(c)),c++,100<(new Date).getTime()-f););this.redrawRulers(0,b);this._queueUpdate()}a=this._getWindow();if(c!==b){var h=this;this._calculateLHTimer=a.setTimeout(function(){h._calculateLHTimer=null;h._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=
void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var b=a.getBoundingClientRect();a.destroy();return Math.max(1,b.bottom-b.top)},_calculateMetrics:function(){var a=this._clientDiv,b=a.ownerDocument,c=k.createElement(b,"div");c.style.lineHeight="normal";var f={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(f);p(f.style,c);c.style.position="fixed";c.style.left="-1000px";var h=k.createElement(b,"span");h.appendChild(b.createTextNode(" "));
c.appendChild(h);var m=k.createElement(b,"span");m.style.fontStyle="italic";m.appendChild(b.createTextNode(" "));c.appendChild(m);var r=k.createElement(b,"span");r.style.fontWeight="bold";r.appendChild(b.createTextNode(" "));c.appendChild(r);f=k.createElement(b,"span");f.style.fontWeight="bold";f.style.fontStyle="italic";f.appendChild(b.createTextNode(" "));c.appendChild(f);a.appendChild(c);var v=c.getBoundingClientRect(),h=h.getBoundingClientRect(),m=m.getBoundingClientRect(),r=r.getBoundingClientRect(),
f=f.getBoundingClientRect(),h=h.bottom-h.top,m=m.bottom-m.top,r=r.bottom-r.top,d=f.bottom-f.top,y=0,f=0>=v.bottom-v.top,v=Math.max(1,v.bottom-v.top);m>h&&(y=1);r>m&&(y=2);d>r&&(y=3);var l;0!==y&&(l={style:{}},0!==(y&1)&&(l.style.fontStyle="italic"),0!==(y&2)&&(l.style.fontWeight="bold"));h=n(c);a.removeChild(c);y=e(this._viewDiv);c=k.createElement(b,"div");c.style.position="fixed";c.style.left="-1000px";c.style.paddingLeft=y.left+"px";c.style.paddingTop=y.top+"px";c.style.paddingRight=y.right+"px";
c.style.paddingBottom=y.bottom+"px";c.style.width="100px";c.style.height="100px";y=k.createElement(b,"div");y.style.width="100%";y.style.height="100%";c.appendChild(y);a.appendChild(c);m=c.getBoundingClientRect();r=y.getBoundingClientRect();d=0;!this._singleMode&&!this._noScroll&&(c.style.overflow="hidden",y.style.height="200px",d=c.clientWidth,c.style.overflow="scroll",d-=c.clientWidth);a.removeChild(c);var y={left:r.left-m.left,top:r.top-m.top,right:m.right-r.right,bottom:m.bottom-r.bottom},z=0,
q=r=0;if(!f){c=k.createElement(b,"div");c.style.position="fixed";c.style.left="-1000px";a.appendChild(c);c.innerHTML=Array(2).join("a");m=c.getBoundingClientRect();q=Math.ceil(m.right-m.left);if(this._wrapOffset||this._marginOffset)c.innerHTML=Array(this._wrapOffset+1+(k.isWebkit?0:1)).join(" "),m=c.getBoundingClientRect(),z=Math.ceil(m.right-m.left),c.innerHTML=Array(this._marginOffset+1).join(" "),r=c.getBoundingClientRect(),r=Math.ceil(r.right-r.left);a.removeChild(c)}return{lineHeight:v,largestFontStyle:l,
lineTrim:h,viewPadding:y,scrollWidth:d,wrapWidth:z,marginWidth:r,charWidth:q,invalid:f}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var b=this._getSelections();b.forEach(function(b){"next"===a?b.start=b.end:b.end=b.start});this._setSelection(b,!0);return!0},_commitIME:function(a){if(-1!==this._imeOffset){var b=this._model,c=b.getLineAtOffset(this._imeOffset),f=b.getLineStart(c),e=this._getLineNode(c);if(!a){this._scrollDiv.focus();
this._clientDiv.focus();var h=this._getDOMText(e).text,b=b.getLine(c),f=this._imeOffset-f,b=f+h.length-b.length;f!==b&&(a=h.substring(f,b))}this._imeOffset=-1;a&&(!this._doContent(a)&&!k.isWebkit)&&(e.lineRemoved=!0,this._queueUpdate())}},_createActions:function(){this.addKeyMode(new u.DefaultKeyMode(this));var b=this;this._actions={noop:{defaultHandler:function(){return b._doNoop()}},lineUp:{defaultHandler:function(c){return b._doLineUp(a(c,{select:!1}))},actionDescription:{name:t.lineUp}},lineDown:{defaultHandler:function(c){return b._doLineDown(a(c,
{select:!1}))},actionDescription:{name:t.lineDown}},lineStart:{defaultHandler:function(c){return b._doHome(a(c,{select:!1,ctrl:!1}))},actionDescription:{name:t.lineStart}},lineEnd:{defaultHandler:function(c){return b._doEnd(a(c,{select:!1,ctrl:!1}))},actionDescription:{name:t.lineEnd}},charPrevious:{defaultHandler:function(c){return b._doCursorPrevious(a(c,{select:!1,unit:"character"}))},actionDescription:{name:t.charPrevious}},charNext:{defaultHandler:function(c){return b._doCursorNext(a(c,{select:!1,
unit:"character"}))},actionDescription:{name:t.charNext}},pageUp:{defaultHandler:function(c){return b._doPageUp(a(c,{select:!1}))},actionDescription:{name:t.pageUp}},pageDown:{defaultHandler:function(c){return b._doPageDown(a(c,{select:!1}))},actionDescription:{name:t.pageDown}},scrollPageUp:{defaultHandler:function(c){return b._doScroll(a(c,{type:"pageUp"}))},actionDescription:{name:t.scrollPageUp}},scrollPageDown:{defaultHandler:function(c){return b._doScroll(a(c,{type:"pageDown"}))},actionDescription:{name:t.scrollPageDown}},
scrollLineUp:{defaultHandler:function(c){return b._doScroll(a(c,{type:"lineUp"}))},actionDescription:{name:t.scrollLineUp}},scrollLineDown:{defaultHandler:function(c){return b._doScroll(a(c,{type:"lineDown"}))},actionDescription:{name:t.scrollLineDown}},wordPrevious:{defaultHandler:function(c){return b._doCursorPrevious(a(c,{select:!1,unit:"word"}))},actionDescription:{name:t.wordPrevious}},wordNext:{defaultHandler:function(c){return b._doCursorNext(a(c,{select:!1,unit:"word"}))},actionDescription:{name:t.wordNext}},
textStart:{defaultHandler:function(c){return b._doHome(a(c,{select:!1,ctrl:!0}))},actionDescription:{name:t.textStart}},textEnd:{defaultHandler:function(c){return b._doEnd(a(c,{select:!1,ctrl:!0}))},actionDescription:{name:t.textEnd}},scrollTextStart:{defaultHandler:function(c){return b._doScroll(a(c,{type:"textStart"}))},actionDescription:{name:t.scrollTextStart}},scrollTextEnd:{defaultHandler:function(c){return b._doScroll(a(c,{type:"textEnd"}))},actionDescription:{name:t.scrollTextEnd}},centerLine:{defaultHandler:function(c){return b._doScroll(a(c,
{type:"centerLine"}))},actionDescription:{name:t.centerLine}},selectLineUp:{defaultHandler:function(c){return b._doLineUp(a(c,{select:!0}))},actionDescription:{name:t.selectLineUp}},selectLineDown:{defaultHandler:function(c){return b._doLineDown(a(c,{select:!0}))},actionDescription:{name:t.selectLineDown}},selectWholeLineUp:{defaultHandler:function(c){return b._doLineUp(a(c,{select:!0,wholeLine:!0}))},actionDescription:{name:t.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(c){return b._doLineDown(a(c,
{select:!0,wholeLine:!0}))},actionDescription:{name:t.selectWholeLineDown}},selectLineStart:{defaultHandler:function(c){return b._doHome(a(c,{select:!0,ctrl:!1}))},actionDescription:{name:t.selectLineStart}},selectLineEnd:{defaultHandler:function(c){return b._doEnd(a(c,{select:!0,ctrl:!1}))},actionDescription:{name:t.selectLineEnd}},selectCharPrevious:{defaultHandler:function(c){return b._doCursorPrevious(a(c,{select:!0,unit:"character"}))},actionDescription:{name:t.selectCharPrevious}},selectCharNext:{defaultHandler:function(c){return b._doCursorNext(a(c,
{select:!0,unit:"character"}))},actionDescription:{name:t.selectCharNext}},selectPageUp:{defaultHandler:function(c){return b._doPageUp(a(c,{select:!0}))},actionDescription:{name:t.selectPageUp}},selectPageDown:{defaultHandler:function(c){return b._doPageDown(a(c,{select:!0}))},actionDescription:{name:t.selectPageDown}},selectWordPrevious:{defaultHandler:function(c){return b._doCursorPrevious(a(c,{select:!0,unit:"word"}))},actionDescription:{name:t.selectWordPrevious}},selectWordNext:{defaultHandler:function(c){return b._doCursorNext(a(c,
{select:!0,unit:"word"}))},actionDescription:{name:t.selectWordNext}},selectTextStart:{defaultHandler:function(c){return b._doHome(a(c,{select:!0,ctrl:!0}))},actionDescription:{name:t.selectTextStart}},selectTextEnd:{defaultHandler:function(c){return b._doEnd(a(c,{select:!0,ctrl:!0}))},actionDescription:{name:t.selectTextEnd}},deletePrevious:{defaultHandler:function(c){return b._doBackspace(a(c,{unit:"character"}))},actionDescription:{name:t.deletePrevious}},deleteNext:{defaultHandler:function(c){return b._doDelete(a(c,
{unit:"character"}))},actionDescription:{name:t.deleteNext}},deleteWordPrevious:{defaultHandler:function(c){return b._doBackspace(a(c,{unit:"word"}))},actionDescription:{name:t.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(c){return b._doDelete(a(c,{unit:"word"}))},actionDescription:{name:t.deleteWordNext}},deleteLineStart:{defaultHandler:function(c){return b._doBackspace(a(c,{unit:"line"}))},actionDescription:{name:t.deleteLineStart}},deleteLineEnd:{defaultHandler:function(c){return b._doDelete(a(c,
{unit:"line"}))},actionDescription:{name:t.deleteLineEnd}},tab:{defaultHandler:function(c){return b._doTab(a(c,{}))},actionDescription:{name:t.tab}},shiftTab:{defaultHandler:function(c){return b._doShiftTab(a(c,{}))},actionDescription:{name:t.shiftTab}},enter:{defaultHandler:function(c){return b._doEnter(a(c,{}))},actionDescription:{name:t.enter}},enterNoCursor:{defaultHandler:function(c){return b._doEnter(a(c,{noCursor:!0}))},actionDescription:{name:t.enterNoCursor}},escape:{defaultHandler:function(c){return b._doEscape(a(c,
{}))},actionDescription:{name:t.escape}},selectAll:{defaultHandler:function(c){return b._doSelectAll(a(c,{}))},actionDescription:{name:t.selectAll}},copy:{defaultHandler:function(c){return b._doCopy(a(c,{}))},actionDescription:{name:t.copy}},cut:{defaultHandler:function(c){return b._doCut(a(c,{}))},actionDescription:{name:t.cut}},paste:{defaultHandler:function(c){return b._doPaste(a(c,{}))},actionDescription:{name:t.paste}},uppercase:{defaultHandler:function(c){return b._doCase(a(c,{type:"upper"}))},
actionDescription:{name:t.uppercase}},lowercase:{defaultHandler:function(c){return b._doCase(a(c,{type:"lower"}))},actionDescription:{name:t.lowercase}},capitalize:{defaultHandler:function(c){return b._doCase(a(c,{unit:"word",type:"capitalize"}))},actionDescription:{name:t.capitalize}},reversecase:{defaultHandler:function(c){return b._doCase(a(c,{type:"reverse"}))},actionDescription:{name:t.reversecase}},toggleOverwriteMode:{defaultHandler:function(c){return b._doOverwriteMode(a(c,{}))},actionDescription:{name:t.toggleOverwriteMode}},
toggleTabMode:{defaultHandler:function(c){return b._doTabMode(a(c,{}))},actionDescription:{name:t.toggleTabMode}},toggleWrapMode:{defaultHandler:function(c){return b._doWrapMode(a(c,{}))},actionDescription:{name:t.toggleWrapMode}}}},_createRulerParent:function(a,c){var b=k.createElement(a,"div");b.className=c;b.tabIndex=-1;b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";
b.style.display="none";b.setAttribute("aria-hidden","true");this._rootDiv.appendChild(b);return b},_createRuler:function(a,c){if(this._clientDiv){var b=this._getRulerParent(a);if(b){if(b!==this._marginDiv||this._marginOffset)b.style.display="block";b.rulerWidth=void 0;var f=k.createElement(b.ownerDocument,"div");f._ruler=a;a.node=f;f.rulerChanged=!0;f.style.position="relative";f.style.cssFloat="left";f.style.styleFloat="left";f.style.outline="none";if(void 0===c||0>c||c>=b.children.length)b.appendChild(f);
else{for(var e=b.firstChild;e&&0<c--;)e=e.nextSibling;b.insertBefore(f,e)}}}},_createSelectionDiv:function(){var a=k.createElement(this._parent.ownerDocument,"div");a.className="textviewSelection";a.style.position="absolute";a.style.borderWidth="0px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.width="0px";a.style.height="0px";a.style.zIndex="0";return a},_createView:function(){function a(){h._rootDiv&&(h.update(!0),h._metrics.invalid&&h._getWindow().setTimeout(function(){a()},
100))}if(!this._clientDiv){for(var c=this._parent;c.hasChildNodes();)c.removeChild(c.lastChild);var b=c.ownerDocument,f=k.createElement(b,"div");this._rootDiv=f;f.tabIndex=-1;f.style.position="relative";f.style.overflow="hidden";f.style.width="100%";f.style.height="100%";f.style.overflow="hidden";f.style.WebkitTextSizeAdjust="100%";f.setAttribute("role","application");c.appendChild(f);this._leftDiv=this._createRulerParent(b,"textviewLeftRuler");c=k.createElement(b,"div");c.className="textviewScroll";
this._viewDiv=c;c.tabIndex=-1;c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.borderWidth="0px";c.style.margin="0px";c.style.outline="none";c.style.background="transparent";f.appendChild(c);var e=this._createRulerParent(b,"textviewRightRuler");this._rightDiv=e;e.style.right="0px";this._innerRightDiv=e=this._createRulerParent(b,"textviewInnerRightRuler");e.style.zIndex="1";this._scrollDiv=e=k.createElement(b,"div");e.style.margin="0px";e.style.borderWidth="0px";e.style.padding=
"0px";c.appendChild(e);(this._marginDiv=this._createRulerParent(b,"textviewMarginRuler")).style.zIndex="4";!k.isIE&&!k.isIOS&&(this._clipDiv=c=k.createElement(b,"div"),c.style.position="absolute",c.style.overflow="hidden",c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",c.style.background="transparent",f.appendChild(c),this._clipScrollDiv=e=k.createElement(b,"div"),e.style.position="absolute",e.style.height="1px",e.style.top="-1000px",e.style.background="transparent",c.appendChild(e));
c=k.createElement(b,"div");c.className="textviewContent";this._clientDiv=c;c.tabIndex=0;c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.zIndex="1";c.style.WebkitUserSelect="text";c.setAttribute("spellcheck","false");if(k.isIOS||k.isAndroid)c.style.WebkitTapHighlightColor="transparent";(this._clipDiv||f).appendChild(c);this._setFullSelection(this._fullSelection,!0);if(k.isIOS||k.isAndroid)this._vScrollDiv=e=k.createElement(b,
"div"),e.style.position="absolute",e.style.borderWidth="1px",e.style.borderColor="white",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.backgroundColor="black",e.style.opacity="0.5",e.style.margin="0px",e.style.padding="0px",e.style.outline="none",e.style.zIndex="3",e.style.width="8px",e.style.display="none",f.appendChild(e),this._hScrollDiv=e=k.createElement(b,"div"),e.style.position="absolute",e.style.borderWidth="1px",e.style.borderColor="white",e.style.borderStyle="solid",e.style.borderRadius=
"4px",e.style.backgroundColor="black",e.style.opacity="0.5",e.style.margin="0px",e.style.padding="0px",e.style.outline="none",e.style.zIndex="3",e.style.height="8px",e.style.display="none",f.appendChild(e);k.isFirefox&&!c.setCapture&&(this._overlayDiv=e=k.createElement(b,"div"),e.style.position=c.style.position,e.style.borderWidth=c.style.borderWidth,e.style.margin=c.style.margin,e.style.padding=c.style.padding,e.style.cursor="text",e.style.zIndex="2",(this._clipDiv||f).appendChild(e));c.contentEditable=
"true";c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();c=this._rulers;for(e=0;e<c.length;e++)this._createRuler(c[e]);this._update();var h=this;m(b,f,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},
scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},
wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},undoStack:{value:null,update:this._setUndoStack},theme:{value:q.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var c=this._getRulerParent(a);if(c)for(var b=c.firstChild;b;){if(b._ruler===a){b._ruler=void 0;c.removeChild(b);if(0===c.children.length&&(c!==this._marginDiv||!this._marginOffset))c.style.display=
"none";c.rulerWidth=void 0;break}b=b.nextSibling}},_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null);this._cursorTimer&&(a.clearInterval(this._cursorTimer),this._cursorTimer=null);
this._imeTimeout&&(a.clearInterval(this._imeTimeout),this._imeTimeout=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._innerRightDiv=this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._domSelection=null}},_doAutoScroll:function(a,c,b){this._autoScrollDir=a;this._autoScrollX=c;this._autoScrollY=b;this._autoScrollTimerID||
this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var c=this._hasFocus;this._ignoreFocus=!0;c&&a.blur();a.contentEditable=!1;a.contentEditable=!0;c&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,c){var b=this._model;b.getBaseModel&&(a=b.mapOffset(a),c=b.mapOffset(c),b=b.getBaseModel());return b.getText(a,c)},
_getBottomIndex:function(a){var c=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=c.getBoundingClientRect();var b=this._clientDiv.getBoundingClientRect();a.bottom>b.bottom&&(c=this._getLinePrevious(c)||c)}return c.lineIndex},_getBlockSelections:function(a,c,b){var e=this._model;a=a.filter(function(a){return!a._editing});var h=e.getLineAtOffset(this._blockSelection.getAnchor()),n;c>h?n=c:(n=h,h=c);for(c=h;c<=n;c++){var m=this._getLine(c),h=m.getOffset(b.x,1),r=m.getOffset(this._blockSelection._docX,
1);m.destroy();h===r&&h===e.getLineEnd(c)||(m=h<r,h=new f(m?h:r,m?r:h,m),h._editing=!0,a.push(h))}return a},_getBoundsAtOffset:function(a){var c=this._getLine(this._model.getLineAtOffset(a));a=c.getBoundingClientRect(a);var b=this._getLinePixel(c.lineIndex);a.top+=b;a.bottom+=b;c.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getInnerRightWidth:function(){var a=this._innerRightDiv.rulerWidth;void 0===a&&(a=
this._innerRightDiv.getBoundingClientRect(),this._innerRightDiv.rulerWidth=a=a.right-a.left);return a},_getClientWidth:function(){var a=this._getViewPadding(),c=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right-c)},_getClipboardText:function(a,b){function f(a){var g=[];c(a,function(a){g.push(a)},null);b&&b(g);return g}var e=this._getWindow(),h=e.clipboardData;!h&&a&&(h=a.clipboardData);if(h)return f(h.getData(k.isIE?"Text":"text/plain"));if(k.isFirefox){this._ignoreFocus=
!0;var n=this._clipboardDiv,h=this._rootDiv.ownerDocument;n||(this._clipboardDiv=n=k.createElement(h,"div"),n.style.position="fixed",n.style.whiteSpace="pre",n.style.left="-1000px",this._rootDiv.appendChild(n));n.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";n.firstChild.focus();var m=this,r=function(){var a=m._getTextFromElement(n);n.innerHTML="";return f(a)},v=!1;this._ignorePaste=!0;if(!k.isLinux||2!==this._lastMouseButton)try{v=h.execCommand("paste",!1,null)}catch(d){v=1<n.childNodes.length||
n.firstChild&&0<n.firstChild.childNodes.length}this._ignorePaste=!1;if(!v){if(a)return e.setTimeout(function(){m.focus();r();m._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;return r()}return""},_getDOMText:function(a,c){return a._line.getText(c)},_getTextFromElement:function(a){var c=a.ownerDocument,b=c.defaultView;if(!b.getSelection)return a.innerText||a.textContent;c=c.createRange();c.selectNode(a);a=b.getSelection();var b=[],f;for(f=0;f<a.rangeCount;f++)b.push(a.getRangeAt(f));
this._ignoreSelect=!0;a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(f=0;f<b.length;f++)a.addRange(b[f]);this._ignoreSelect=!1;return c},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var c=this._getLineNode(a);return c&&!c.lineChanged&&!c.lineRemoved?c._line:new y(this,a)},_getLineHeight:function(a,c){if(void 0!==a&&this._lineHeight){var b=this._lineHeight[a];if(b)return b;if(c||void 0===c)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},
_getLineNode:function(a){for(var c=this._clientDiv.firstChild;c;){if(a===c.lineIndex)return c;c=c.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var c=this._getTopIndex(),
b=-this._topIndexY+this._getScroll().y;if(a>c)for(;c<a;c++)b+=this._getLineHeight(c);else for(c-=1;c>=a;c--)b-=this._getLineHeight(c);return b}return this._getLineHeight()*a},_getLineIndex:function(a,c){var b,f=0,e=this._model.getLineCount();if(this._lineHeight){var f=this._getTopIndex(),h=-this._topIndexY+this._getScroll().y;if(a!==h)if(a<h)for(;a<h&&0<f;)a+=this._getLineHeight(--f);else for(b=this._getLineHeight(f);a-b>=h&&f<e-1;)a-=b,b=this._getLineHeight(++f)}else b=this._getLineHeight(),f=Math.floor(a/
b);return c&&(0===e||0>f||f>e-1)?-1:Math.max(0,Math.min(e-1,f))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "innerRight":return this._innerRightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return(Array.isArray(this._selection)?this._selection[0]:this._selection).clone()},
_getSelections:function(){return(Array.isArray(this._selection)?this._selection:[this._selection]).map(function(a){return a.clone()})},_getTopIndex:function(a){var c=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=c.getBoundingClientRect();var b=this._getViewPadding(),f=this._viewDiv.getBoundingClientRect();a.top<f.top+b.top&&(c=this._getLineNext(c)||c)}return c.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(c){a._onModelChanging(c)},onChanged:function(c){a._onModelChanged(c)}};
this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var c=this._handlers=[],b=this._clientDiv,f=this._viewDiv,e=this._rootDiv,h=this._overlayDiv||b,n=b.ownerDocument,m=this._getWindow(),r=k.isIE?n:m;c.push({target:m,type:"resize",handler:function(c){return a._handleResize(c?
c:m.event)}});c.push({target:b,type:"blur",handler:function(c){return a._handleBlur(c?c:m.event)}});c.push({target:b,type:"focus",handler:function(c){return a._handleFocus(c?c:m.event)}});c.push({target:f,type:"focus",handler:function(){b.focus()}});c.push({target:f,type:"scroll",handler:function(c){return a._handleScroll(c?c:m.event)}});c.push({target:b,type:"textInput",handler:function(c){return a._handleTextInput(c?c:m.event)}});c.push({target:b,type:"keydown",handler:function(c){return a._handleKeyDown(c?
c:m.event)}});c.push({target:b,type:"keypress",handler:function(c){return a._handleKeyPress(c?c:m.event)}});c.push({target:b,type:"keyup",handler:function(c){return a._handleKeyUp(c?c:m.event)}});k.isIE&&c.push({target:n,type:"keyup",handler:function(c){return a._handleDocKeyUp(c?c:m.event)}});c.push({target:b,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:m.event)}});c.push({target:b,type:"copy",handler:function(c){return a._handleCopy(c?c:m.event)}});c.push({target:b,type:"cut",
handler:function(c){return a._handleCut(c?c:m.event)}});c.push({target:b,type:"paste",handler:function(c){return a._handlePaste(c?c:m.event)}});c.push({target:n,type:"selectionchange",handler:function(c){return a._handleSelectionChange(c?c:m.event)}});if(k.isIOS||k.isAndroid)c.push({target:b,type:"touchstart",handler:function(c){return a._handleTouchStart(c?c:m.event)}}),c.push({target:b,type:"touchmove",handler:function(c){return a._handleTouchMove(c?c:m.event)}}),c.push({target:b,type:"touchend",
handler:function(c){return a._handleTouchEnd(c?c:m.event)}});else{c.push({target:b,type:"selectstart",handler:function(c){return a._handleSelectStart(c?c:m.event)}});c.push({target:b,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:m.event)}});c.push({target:b,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:m.event)}});c.push({target:b,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:m.event)}});c.push({target:r,type:"mouseup",handler:function(c){return a._handleMouseUp(c?
c:m.event)}});c.push({target:r,type:"mousemove",handler:function(c){return a._handleMouseMove(c?c:m.event)}});c.push({target:e,type:"mousedown",handler:function(c){return a._handleRootMouseDown(c?c:m.event)}});c.push({target:e,type:"mouseup",handler:function(c){return a._handleRootMouseUp(c?c:m.event)}});c.push({target:h,type:"dragstart",handler:function(c){return a._handleDragStart(c?c:m.event)}});c.push({target:h,type:"drag",handler:function(c){return a._handleDrag(c?c:m.event)}});c.push({target:h,
type:"dragend",handler:function(c){return a._handleDragEnd(c?c:m.event)}});c.push({target:h,type:"dragenter",handler:function(c){return a._handleDragEnter(c?c:m.event)}});c.push({target:h,type:"dragover",handler:function(c){return a._handleDragOver(c?c:m.event)}});c.push({target:h,type:"dragleave",handler:function(c){return a._handleDragLeave(c?c:m.event)}});c.push({target:h,type:"drop",handler:function(c){return a._handleDrop(c?c:m.event)}});c.push({target:this._clientDiv,type:26<k.isFirefox?"wheel":
k.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:m.event)}});this._clipDiv&&c.push({target:this._clipDiv,type:26<k.isFirefox?"wheel":k.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:m.event)}});if(k.isFirefox&&(!k.isWindows||15<=k.isFirefox))(f=m.MutationObserver||m.MozMutationObserver)?(this._mutationObserver=new f(function(c){a._handleDataModified(c)}),this._mutationObserver.observe(b,{subtree:!0,characterData:!0})):
c.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(c){return a._handleDataModified(c?c:m.event)}});if(k.isFirefox&&(!k.isWindows||15<=k.isFirefox)||k.isIE||k.isWebkit)c.push({target:this._clientDiv,type:"compositionstart",handler:function(c){return a._handleCompositionStart(c?c:m.event)}}),c.push({target:this._clientDiv,type:"compositionend",handler:function(c){return a._handleCompositionEnd(c?c:m.event)}}),c.push({target:this._clientDiv,type:"compositionupdate",handler:function(c){return a._handleCompositionUpdate(c?
c:m.event)}});this._overlayDiv&&(c.push({target:this._overlayDiv,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:m.event)}}),c.push({target:this._overlayDiv,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:m.event)}}),c.push({target:this._overlayDiv,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:m.event)}}),c.push({target:this._overlayDiv,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:m.event)}}));this._isW3CEvents||c.push({target:this._clientDiv,
type:"dblclick",handler:function(c){return a._handleDblclick(c?c:m.event)}})}this._hookRulerEvents(this._leftDiv,c);this._hookRulerEvents(this._rightDiv,c);this._hookRulerEvents(this._innerRightDiv,c);this._hookRulerEvents(this._marginDiv,c);for(f=0;f<c.length;f++)e=c[f],E(e.target,e.type,e.handler,e.capture)},_hookRulerEvents:function(a,c){if(a){var b=this,f=this._getWindow();k.isIE&&c.push({target:a,type:"selectstart",handler:function(){return!1}});c.push({target:a,type:26<k.isFirefox?"wheel":k.isFirefox?
"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:f.event)}});c.push({target:a,type:"click",handler:function(a){b._handleRulerEvent(a?a:f.event)}});c.push({target:a,type:"dblclick",handler:function(a){b._handleRulerEvent(a?a:f.event)}});c.push({target:a,type:"mousemove",handler:function(a){b._handleRulerEvent(a?a:f.event)}});c.push({target:a,type:"mouseover",handler:function(a){b._handleRulerEvent(a?a:f.event)}});c.push({target:a,type:"mouseout",handler:function(a){b._handleRulerEvent(a?
a:f.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var c=a.parent;"string"===typeof c&&(c=(a.document||document).getElementById(c));if(!c)throw Error("no parent");a.parent=c;a.model=a.model||new w.TextModel;var b=this._defaultOptions(),e;for(e in b)b.hasOwnProperty(e)&&(this["_"+e]=void 0!==a[e]?
a[e]:b[e].value);this._keyModes=[];this._rulers=[];this._selection=[new f(0,0,!1)];this._linksVisible=!1;this._maxLineWidth=this._redrawCount=0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=-1;this._isRangeRects=(!k.isIE||9<=k.isIE)&&"function"===typeof c.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=c.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=
this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(k.isMac&&k.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var a=this._viewDiv,c=this._isOverOverlayScroll();a.style.pointerEvents=c.vertical||c.horizontal?
"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),c=this._lastMouseMoveX,b=this._lastMouseMoveY;return{vertical:a.top<=b&&b<a.bottom&&a.right-15<=c&&c<a.right,horizontal:a.bottom-15<=b&&b<a.bottom&&a.left<=c&&c<a.right}},_startUndo:function(){if(this._undoStack){var a=this;this._compoundChange=this._undoStack.startCompoundChange({end:function(){a._compoundChange=null}})}},_endUndo:function(){this._undoStack&&
this._undoStack.endCompoundChange()},_modifyContent:function(a,c,b,e){if(this._readonly&&!a._code)return!1;a.type="Verify";var h=a.start=a.selection[0].start,n=a.end=a.selection[0].end;this.onVerify(a);h!==a.start&&(a.selection[0].start=a.start);n!==a.end&&(a.selection[0].end=a.end);if(null===a.text||void 0===a.text)return!1;1<a.selection.length&&this.setRedraw(!1);(h=this._compoundChange)?f.compare(this._getSelections(),h.owner.selection)||(this._endUndo(),1<a.selection.length&&this._startUndo()):
1<a.selection.length&&this._startUndo();var m=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0);var r=0,v=0;a.selection.forEach(function(b){b.start+=r;b.end+=r;var f=Array.isArray(a.text)?a.text[v]:a.text;m.setText(f,b.start,b.end);r+=b.start-b.end+f.length;b.setCaret(c?b.start+f.length:b.start);v++})}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}this._setSelection(a.selection,b,!0,e);if(h=this._compoundChange)h.owner.selection=a.selection;1<a.selection.length&&this.setRedraw(!0);
this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var c=a.start,b=a.addedCharCount,f=a.removedCharCount,e=a.addedLineCount,h=a.removedLineCount,n=this._getSelections();n.forEach(function(a){a.end>c&&(a.end>c&&a.start<c+f?a.setCaret(c+b):(a.start+=b-f,a.end+=b-f))});this._setSelection(n,!1,!1);for(var n=this._model.getLineAtOffset(c),m=this._getLineNext();m;){var r=m.lineIndex;n<=r&&r<=n+h&&(n===r&&!m.modelChangedEvent&&
!m.lineRemoved?(m.modelChangedEvent=a,m.lineChanged=!0):(m.lineRemoved=!0,m.lineChanged=!1,m.modelChangedEvent=null));r>n+h&&(m.lineIndex=r+e-h,m._line.lineIndex=m.lineIndex);m=this._getLineNext(m)}this._lineHeight&&(a=[n,h].concat(Array(e)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(n<=this._maxLineIndex&&this._maxLineIndex<=n+h)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";
this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_rangesToSelections:function(a){var c=[],b=this._model.getCharCount();a.forEach(function(a){var e;if(a instanceof f)e=a.clone();else{e=a.start;a=a.end;var g=e>a;if(g){var h=e;e=a;a=h}e=Math.max(0,Math.min(e,b));a=Math.max(0,Math.min(a,b));e=new f(e,a,g)}c.push(e)});return c},_resetLineHeight:function(a,
c){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==c)for(var b=a;b<c;b++)this._lineHeight[b]=void 0;else b=this._model.getLineCount(),this._lineHeight=Array(b);this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();
this._setSelection(new f(0,0,!1),!1,!1);this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>k.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,c,b){var f=this._getWindow();if(b&&this._scrollAnimation){var e=this;this._animation=new F({window:f,duration:this._scrollAnimation,curve:[c,0],onAnimate:function(a){a=c-Math.floor(a);e._scrollView(0,a);c-=a},onEnd:function(){e._animation=null;
e._scrollView(a,c);b&&f.setTimeout(b,0)}});this._animation.play()}else this._scrollView(a,c),b&&f.setTimeout(b,0)},_scrollView:function(a,c){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);c&&(b.scrollTop+=c)},_setClipboardText:function(a,b){var f,e=this._getWindow(),h=e.clipboardData;!h&&b&&(h=b.clipboardData);if(h&&(f=[],c(a,function(a){f.push(a)},function(){f.push(k.platformDelimiter)}),h.setData(k.isIE?"Text":"text/plain",f.join(""))||21<k.isFirefox))return!0;var n=this._parent.ownerDocument,
m=k.createElement(n,"pre");m.style.position="fixed";m.style.left="-1000px";c(a,function(a){m.appendChild(n.createTextNode(a))},function(){m.appendChild(k.createElement(n,"br"))});m.appendChild(n.createTextNode(" "));this._clientDiv.appendChild(m);h=n.createRange();h.setStart(m.firstChild,0);h.setEndBefore(m.lastChild);var r=e.getSelection();0<r.rangeCount&&r.removeAllRanges();r.addRange(h);var v=this,h=function(){m&&m.parentNode===v._clientDiv&&v._clientDiv.removeChild(m);v._updateDOMSelection()},
r=!1;this._ignoreCopy=!0;try{r=n.execCommand("copy",!1,null)}catch(d){}this._ignoreCopy=!1;if(!r&&b)return e.setTimeout(h,0),!1;h();return!0},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;k.isIE&&a&&(this._hadFocus=this._hasFocus);var c=this._clientDiv;c.contentEditable=!a;this._hadFocus&&
!a&&c.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,c,b,e,h,n,m){if(a){void 0===b&&(b=!0);var r=this._getSelections();a=Array.isArray(a)?a:n?r.concat([a]):[a];this._selection=f.merge(a);m||a.forEach(function(a){a._columnX=-1});!1!==c&&this._showCaret(!1,e,c,h);b&&this._updateDOMSelection();f.compare(r,a)||(c={type:"Selection",oldValue:f.convert(r),
newValue:f.convert(a)},this.onSelection(c))}},_setSelectionTo:function(a,c,b,e,h,n){var m=this._model,r=this._getSelections(),v=this.convert({x:a,y:c},"page","document");c=this._getLineIndex(v.y);a=this._getLine(c);var d=a.getOffset(v.x,v.y-this._getLinePixel(c));if(n&&!e&&f.contains(r,d))return this._dragOffset=d,a.destroy(),!1;this._blockSelection?r=this._getBlockSelections(r,c,v):(b?e?(b=r[r.length-1],b._editing=!0):(b=new f(0,0),b._editing=!0,h?r.push(b):r=[b],b._docX=v.x):b=f.editing(r),1===
this._clickCount?(b.extend(d),e||b.collapse()):(0===(this._clickCount&1)?this._doubleClickSelection?d>=this._doubleClickSelection.start?(e=this._doubleClickSelection.start,m=a.getNextOffset(d,{unit:"wordend",count:1})):(e=a.getNextOffset(d,{unit:"word",count:-1}),m=this._doubleClickSelection.end):(e=a.getNextOffset(d,{unit:"word",count:-1}),m=a.getNextOffset(e,{unit:"wordend",count:1})):this._doubleClickSelection?(h=m.getLineAtOffset(this._doubleClickSelection.start),c>=h?(e=m.getLineStart(h),m=m.getLineEnd(c)):
(e=m.getLineStart(c),m=m.getLineEnd(h))):(e=m.getLineStart(c),m=m.getLineEnd(c)),b.setCaret(e),b.extend(m)));this._setSelection(r,!0,!0,null,!1);a.destroy();return!0},_setFullSelection:function(a,c){this._fullSelection=a;k.isWebkit&&(this._fullSelection=!0);this._domSelection||(this._domSelection=[],this._cursorVisible=!0);c||this._updateDOMSelection()},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},
_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,c=k.createElement(a.ownerDocument,"div");c.className="textviewBlockCursor";this._cursorDiv=c;c.tabIndex=-1;c.style.zIndex="2";c.style.color="transparent";c.style.position="absolute";c.style.pointerEvents="none";c.innerHTML="\x26nbsp;";a.appendChild(c);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=
null)},_setMarginOffset:function(a,c){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";c||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(a,c){this._wrapOffset=a;c||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,c){this._singleMode=a;this._updateOverflow();this._updateStyle(c)},_setNoScroll:function(a,
c){this._noScroll=a;this._updateOverflow();this._updateStyle(c)},_setTabSize:function(a,c){this._tabSize=a;this._customTabSize=void 0;var b=this._clientDiv;k.isOpera?b&&(b.style.OTabSize=this._tabSize+""):537.1<=k.isWebkit?b&&(b.style.tabSize=this._tabSize+""):4<=k.isFirefox?b&&(b.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);c||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",
this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,c){this._themeClass=a;var b="textview",f=this._theme.getThemeClass();f&&(b+=" "+f);this._themeClass&&f!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(c)},_setUndoStack:function(a){this._undoStack=a},_setWrapMode:function(a,c){this._wrapMode=a&&this._wrappable;var b=this._clientDiv;
this._wrapMode?(b.style.whiteSpace="pre-wrap",b.style.wordWrap="break-word"):(b.style.whiteSpace="pre",b.style.wordWrap="normal");this._updateOverflow();c||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,c,b,e){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection&&-1===this._imeOffset){var h=this._model,m=this._getSelections(),n=f.editing(m,"down"===this._autoScrollDir),r=this._getScroll(),m=n.getCaret(),v=n.start,d=n.end,p=h.getLineAtOffset(v),
k=h.getLineAtOffset(d),y=Math.max(Math.max(v,h.getLineStart(k)),d-1),h=this._getClientWidth(),l=this._getClientHeight(),z=h/4,q=this._getBoundsAtOffset(m===v?v:y),s=q.left,E=q.right,t=q.top,A=q.bottom,u=0,F="object"===typeof b;if((a||F)&&!n.isEmpty())q=this._getBoundsAtOffset(m===d?v:y),u=(q.bottom>A?q.bottom:A)-(q.top<t?q.top:t),a&&(q.top===t?m===v?E=s+Math.min(q.right-s,h):s=E-Math.min(E-q.left,h):m===v?A=t+Math.min(q.bottom-t,l):t=A-Math.min(A-q.top,l));a=0;s<r.x&&(a=Math.min(s-r.x,-z));E>r.x+
h&&(a=Math.max(E-r.x-h,z));n=0;t<r.y?n=t-r.y:A>r.y+l&&(n=A-r.y-l);e&&(0<e?0<n&&(n=Math.max(n,e)):0>n&&(n=Math.min(n,e)));e=F&&"always"===b.scrollPolicy;if(0!==a||0!==n||e)return F?(e=0<n,0===n&&(n=t-r.y),r=b.viewAnchor,t=b.selectionAnchor,b=Math.min(Math.max(0,b.viewAnchorOffset||0)),n="top"===r?n+Math.floor(e?(1-b)*l:-b*l):"bottom"===r?n+Math.floor(e?b*l:-(1-b)*l):"center"===r?n+Math.floor(e?l/2+b*l:l/2-(1-b)*l):n+Math.floor(e?b*l:-b*l),p!==k&&("top"===t&&m!==v?n+=Math.floor(-u):"bottom"===t&&m!==
d?n+=Math.floor(u):"center"===t&&(n+=Math.floor(u/2)))):0!==n&&"number"===typeof b&&(0>b&&(b=0),1<b&&(b=1),n+=Math.floor(0<n?b*l:-b*l)),this._scrollViewAnimated(a,n,c),l!==this._getClientHeight()||h!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;c&&c();return!1}},_startIME:function(){if(-1===this._imeOffset){for(var a=!1,c=this._getSelections(),b=0;b<c.length&&!a;b++)a=!c[b].isEmpty();a&&this._modifyContent({text:"",selection:c},!0);this._imeOffset=c[0].start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",
this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var c=this._handlers[a];A(c.target,c.type,c.handler)}this._handlers=null;this._mutationObserver&&this._mutationObserver.disconnect()},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&-1===this._imeOffset&&this._clientDiv){var a=
this._getSelections(),c=this._domSelection,b;if(c.length<a.length)for(b=c.length;b<a.length;b++)c.push(new v(this));else c.length>a.length&&c.splice(a.length).forEach(function(a){a.destroy()});for(b=0;b<c.length;b++)c[b].setPrimary(0===b),c[b].setSelection(a[b]);var a=this._getWindow(),f=this;1<c.length?this._cursorTimer||(this._cursorTimer=a.setInterval(function(){f._cursorVisible=!f._cursorVisible;f._domSelection.forEach(function(a){a.update()})},500)):this._cursorTimer&&(a.clearInterval(this._cursorTimer),
this._cursorTimer=null)}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var c=this._clientDiv,b=this._viewDiv;if(c){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var f=this._model,e=this._getScroll(!1),h=this._getViewPadding(),n=f.getLineCount(),m=this._getLineHeight(),r=!1,v=!1,d=!1,p=this._metrics.scrollWidth;this._wrapMode&&(c.style.width=(this._metrics.wrapWidth||
this._getClientWidth())+"px");var l,z,q,s,E=0,t=0,A;if(this._lineHeight){for(;t<n;){A=this._getLineHeight(t);if(E+A>e.y)break;E+=A;t++}l=t;z=Math.max(0,l-1);q=f=e.y-E;0<l&&(f+=this._getLineHeight(l-1))}else s=Math.max(0,e.y)/m,l=Math.floor(s),z=Math.max(0,l-1),f=Math.round((s-z)*m),q=Math.round((s-l)*m);this._topIndexY=q;s=this._rootDiv;var u=s.clientWidth,F=s.clientHeight;if(a){m=0;this._leftDiv&&(l=this._leftDiv.getBoundingClientRect(),m=l.right-l.left);l=this._getClientWidth();s=this._getClientHeight();
v=l;this._wrapMode?this._metrics.wrapWidth&&(v=this._metrics.wrapWidth):v=Math.max(this._maxLineWidth,v);for(;t<n;)A=this._getLineHeight(t,!1),E+=A,t++;n=E}else{s=this._getClientHeight();q=Math.min(l+Math.floor((s+q)/m),n-1);var e=Math.min(q+1,n-1),w;for(A=c.firstChild;A;){w=A.lineIndex;var B=A.nextSibling;if(!(z<=w&&w<=e)||A.lineRemoved||-1===A.lineIndex)this._mouseWheelLine===A?(A.style.display="none",A.lineIndex=-1):c.removeChild(A);A=B}A=this._getLineNext();var B=b.ownerDocument,H=B.createDocumentFragment();
for(w=z;w<=e;w++)!A||A.lineIndex>w?(new y(this,w)).create(H,null):(H.firstChild&&(c.insertBefore(H,A),H=B.createDocumentFragment()),A&&A.lineChanged&&(A=(new y(this,w)).create(H,A),A.lineChanged=!1),A=this._getLineNext(A));H.firstChild&&c.insertBefore(H,A);k.isWebkit&&!this._wrapMode&&(c.style.width="0x7fffffffpx");A=this._getLineNext();w=s+f;for(H=!1;A;)z=A.lineWidth,void 0===z&&(B=A._line.getBoundingClientRect(),z=A.lineWidth=Math.ceil(B.right-B.left),B=B.bottom-B.top,this._lineHeight?this._lineHeight[A.lineIndex]=
B:0!==m&&(0!==B&&Math.ceil(m)!==Math.ceil(B))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[A.lineIndex]=B)),this._lineHeight&&!H&&(w-=this._lineHeight[A.lineIndex],0>w&&(q=A.lineIndex,H=!0)),this._wrapMode||(z>=this._maxLineWidth&&(this._maxLineWidth=z,this._maxLineIndex=A.lineIndex),this._checkMaxLineIndex===A.lineIndex&&(this._checkMaxLineIndex=-1)),A.lineIndex===l&&(this._topChild=A),A.lineIndex===q&&(this._bottomChild=A),A=this._getLineNext(A);-1!==this._checkMaxLineIndex&&
(w=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=w&&w<n&&(m=new y(this,w),B=m.getBoundingClientRect(),z=B.right-B.left,z>=this._maxLineWidth&&(this._maxLineWidth=z,this._maxLineIndex=w),m.destroy()));for(;t<n;)A=this._getLineHeight(t,t<=q),E+=A,t++;n=E;this._updateRuler(this._leftDiv,l,e,F);this._updateRuler(this._rightDiv,l,e,F);this._updateRuler(this._innerRightDiv,l,e,F);this._updateRuler(this._marginDiv,l,e,F);m=0;this._leftDiv&&(l=this._leftDiv.getBoundingClientRect(),m=l.right-l.left);
E=0;this._rightDiv&&(e=this._rightDiv.getBoundingClientRect(),E=e.right-e.left);b.style.left=m+"px";b.style.right=E+"px";e=this._scrollDiv;e.style.height=n+(k.isWebkit?0:h.bottom)+"px";l=this._getClientWidth();!this._singleMode&&(!this._wrapMode&&!this._noScroll)&&(t=r=s,(q="scroll"===b.style.overflowX)?r+=p:t-=p,z=A=l,(w="scroll"===b.style.overflowY)?A+=p:z-=p,s=r,l=A,n>s&&(d=!0,l=z),this._maxLineWidth>l&&(v=!0,s=t,n>s&&(d=!0,l=z)),q!==v&&(b.style.overflowX=v?"scroll":"hidden"),w!==d&&(b.style.overflowY=
d?"scroll":"hidden"),r=q!==v||w!==d);d=l;this._wrapMode?this._metrics.wrapWidth&&(d=this._metrics.wrapWidth):d=Math.max(this._maxLineWidth+this._getInnerRightWidth(),d);v=d;if((!k.isIE||9<=k.isIE)&&this._maxLineWidth>l)d+=h.right+h.left;e.style.width=d+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=d+"px");e=this._getScroll(!1);if(d=this._innerRightDiv)d.style.right=E+("scroll"===b.style.overflowY?this._metrics.scrollWidth:0)+"px",d.style.bottom=("scroll"===b.style.overflowX?p:0)+"px"}this._scrollHeight=
n;this._vScrollDiv&&(d=s-8,E=Math.max(15,Math.ceil(Math.min(1,d/(n+h.top+h.bottom))*d)),this._vScrollDiv.style.left=m+l-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,e.y*d/n))+"px",this._vScrollDiv.style.height=E+"px");!this._wrapMode&&this._hScrollDiv&&(d=l-8,E=Math.max(15,Math.ceil(Math.min(1,d/(this._maxLineWidth+h.left+h.right))*d)),this._hScrollDiv.style.left=m+Math.floor(Math.max(0,Math.floor(e.x*d/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=s-9+"px",this._hScrollDiv.style.width=
E+"px");t=e.x;E=this._clipDiv;d=this._overlayDiv;if(q=this._marginDiv)q.style.left=-t+m+this._metrics.marginWidth+h.left+"px",q.style.bottom=("scroll"===b.style.overflowX?p:0)+"px";E?(E.scrollLeft=t,E.scrollTop=0,b=m+h.left,p=h.top,a=l,m=s,t=0,q=-f,0===e.x&&(b-=h.left,a+=h.left,t=h.left),e.x+l===v&&(a+=h.right),0===e.y&&(p-=h.top,m+=h.top,q+=h.top),e.y+s===n&&(m+=h.bottom),E.style.left=b+"px",E.style.top=p+"px",E.style.right=u-a-b+"px",E.style.bottom=F-m-p+"px",c.style.left=t+"px",c.style.top=q+"px",
c.style.width=v+"px",c.style.height=s+f+"px",d&&(d.style.left=c.style.left,d.style.top=c.style.top,d.style.width=c.style.width,d.style.height=c.style.height)):(b=t,p=f,u=t+l,F=f+s,0===b&&(b-=h.left),0===p&&(p-=h.top),u===v&&(u+=h.right),e.y+s===n&&(F+=h.bottom),c.style.clip="rect("+p+"px,"+u+"px,"+F+"px,"+b+"px)",c.style.left=-t+m+h.left+"px",c.style.width=(this._wrapMode||k.isWebkit?v:l+t)+"px",a||(c.style.top=-f+h.top+"px",c.style.height=s+f+"px"),d&&(d.style.clip=c.style.clip,d.style.left=c.style.left,
d.style.width=c.style.width,a||(d.style.top=c.style.top,d.style.height=c.style.height)));this._updateDOMSelection();r&&(c=this._ensureCaretVisible,this._ensureCaretVisible=!1,c&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._noScroll?a.style.overflow="hidden":this._wrapMode?(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,c,b,f){if(a)for(var e=this._parent.ownerDocument,h=this._getLineHeight(),
n=this._getViewPadding(),m=a.firstChild;m;){var r=m._ruler,v=r.getOverview();m.rulerChanged&&(p(r.getRulerStyle(),m),a.rulerWidth=void 0);if("fixed"!==v){var d=h;"page"===v&&(d+=this._topIndexY);m.style.top=-d+"px";m.style.height=f+d+"px";var y,l=m.firstChild;l?(y=l,l=l.nextSibling):(y=k.createElement(e,"div"),y.style.visibility="hidden",m.appendChild(y));var z;if(m.rulerChanged&&y){d=-1;if(z=r.getWidestAnnotation())p(z.style,y),z.html&&(y.innerHTML=z.html);y.lineIndex=d;y.style.height=h+n.top+"px"}var q,
s;if("page"===v){for(r=r.getAnnotations(c,b+1);l;)d=l.lineIndex,z=l.nextSibling,(!(c<=d&&d<=b)||l.lineChanged)&&m.removeChild(l),l=z;l=m.firstChild.nextSibling;s=e.createDocumentFragment();for(d=c;d<=b;d++)if(!l||l.lineIndex>d){q=k.createElement(e,"div");if(z=r[d])p(z.style,q),z.html&&(q.innerHTML=z.html),q.annotation=z;q.lineIndex=d;q.style.height=this._getLineHeight(d)+"px";s.appendChild(q)}else s.firstChild&&(m.insertBefore(s,l),s=e.createDocumentFragment()),l&&(l=l.nextSibling);s.firstChild&&
m.insertBefore(s,l)}else{z=this._getClientHeight();d=this._model.getLineCount();l=z+n.top+n.bottom-2*this._metrics.scrollWidth;h*d<l?(v=h,y=n.top):(v=l/d,y=this._metrics.scrollWidth);if(m.rulerChanged){for(z=m.childNodes.length;1<z;)m.removeChild(m.lastChild),z--;r=r.getAnnotations(0,d);s=e.createDocumentFragment();for(var E in r)d=E>>>0,0>d||(q=k.createElement(e,"div"),z=r[E],p(z.style,q),q.style.position="absolute",q.style.top=y+h+Math.floor(d*v)+"px",z.html&&(q.innerHTML=z.html),q.annotation=z,
q.lineIndex=d,s.appendChild(q));m.appendChild(s)}else if(m._oldTrackHeight!==l)for(q=m.firstChild?m.firstChild.nextSibling:null;q;)q.style.top=this._metrics.scrollWidth+h+Math.floor(q.lineIndex*v)+"px",q=q.nextSibling;m._oldTrackHeight=l}}m.rulerChanged=!1;m=m.nextSibling}},_updateStyleSheet:function(){var a="";k.isWebkit&&0<this._metrics.scrollWidth&&(a+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");if(a){var c=this._clientDiv.ownerDocument,b=c.getElementById("_textviewStyle");
if(b)b.removeChild(b.firstChild),b.appendChild(c.createTextNode(a));else{b=k.createElement(c,"style");b.id="_textviewStyle";var f=c.getElementsByTagName("head")[0]||c.documentElement;b.appendChild(c.createTextNode(a));f.insertBefore(b,f.firstChild)}}},_updateStyle:function(a,c){!a&&k.isIE&&(this._rootDiv.style.lineHeight="normal");c=this._metrics=c||this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=k.isIE?c.lineHeight-
(c.lineTrim.top+c.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(k.isMac&&k.isWebkit){var b=this._viewDiv;!c.invalid&&0===c.scrollWidth?(b.style.pointerEvents="none",b.style.zIndex="2"):(b.style.pointerEvents="",b.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};d.EventTarget.addMixin(z.prototype);return{TextView:z}});B("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(t,w){function u(d){this._model=d;this._projections=[];var q=
this;this._listener={onChanged:function(d){q._onChanged(d)},onChanging:function(d){q._onChanging(d)}};d.addEventListener("postChanged",this._listener.onChanged);d.addEventListener("preChanging",this._listener.onChanging)}u.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(d){if(d){var q=this._model,l=this._projections;
d._lineIndex=q.getLineAtOffset(d.start);d._lineCount=q.getLineAtOffset(d.end)-d._lineIndex;var k=d.text;k||(k="");d._model="string"===typeof k?new t.TextModel(k,q.getLineDelimiter()):k;var q=this.mapOffset(d.start,!0),k=d.end-d.start,s=d._lineCount,p=d._model.getCharCount(),b=d._model.getLineCount()-1,a={type:"Changing",text:d._model.getText(),start:q,removedCharCount:k,addedCharCount:p,removedLineCount:s,addedLineCount:b};this.onChanging(a);a=this._binarySearch(l,d.start);l.splice(a,0,d);this.onChanged({type:"Changed",
start:q,removedCharCount:k,addedCharCount:p,removedLineCount:s,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(d,q){var l=this._projections,k=0,s,p;if(q){for(s=0;s<l.length;s++){p=l[s];if(p.start>d)break;if(p.end>d)return-1;k+=p._model.getCharCount()-(p.end-p.start)}return d+k}for(s=0;s<l.length;s++){p=l[s];if(p.start>d-k)break;var b=p._model.getCharCount();if(p.start+b>d-k)return-1;k+=b-(p.end-p.start)}return d-
k},removeProjection:function(d){this._removeProjection(d)},_removeProjection:function(d,q){var l,k=0;for(l=0;l<this._projections.length;l++){var s=this._projections[l];if(s===d){d=s;break}k+=s._model.getCharCount()-(s.end-s.start)}if(l<this._projections.length){var s=this._model,k=d.start+k,p=d.end-d.start,b=d._lineCount,a=d._model.getCharCount(),h=d._model.getLineCount()-1;q||(s={type:"Changing",text:s.getText(d.start,d.end),start:k,removedCharCount:a,addedCharCount:p,removedLineCount:h,addedLineCount:b},
this.onChanging(s));this._projections.splice(l,1);if(!q)this.onChanged({type:"Changed",start:k,removedCharCount:a,addedCharCount:p,removedLineCount:h,addedLineCount:b})}},_binarySearch:function(d,q){for(var l=d.length,k=-1,s;1<l-k;)s=Math.floor((l+k)/2),q<=d[s].start?l=s:k=s;return l},getCharCount:function(){for(var d=this._model.getCharCount(),q=this._projections,l=0;l<q.length;l++)var k=q[l],d=d+(k._model.getCharCount()-(k.end-k.start));return d},getLine:function(d,q){if(0>d)return null;var l=this._model,
k=this._projections,s=0,p=[],b=0,a,h,c;for(a=0;a<k.length;a++){c=k[a];if(c._lineIndex>=d-s)break;h=c._model.getLineCount()-1;if(c._lineIndex+h>=d-s){b=d-(c._lineIndex+s);if(b<h)return c._model.getLine(b,q);p.push(c._model.getLine(h))}b=c.end;s+=h-c._lineCount}for(b=Math.max(b,l.getLineStart(d-s));a<k.length;a++){c=k[a];if(c._lineIndex>d-s)break;p.push(l.getText(b,c.start));h=c._model.getLineCount()-1;if(c._lineIndex+h>d-s)return p.push(c._model.getLine(0,q)),p.join("");p.push(c._model.getText());
b=c.end;s+=h-c._lineCount}k=l.getLineEnd(d-s,q);b<k&&p.push(l.getText(b,k));return p.join("")},getLineAtOffset:function(d){for(var q=this._model,l=this._projections,k=0,s=0,p=0;p<l.length;p++){var b=l[p];if(b.start>d-k)break;var a=b._model.getCharCount();if(b.start+a>d-k){l=d-(b.start+k);s+=b._model.getLineAtOffset(l);k+=l;break}s+=b._model.getLineCount()-1-b._lineCount;k+=a-(b.end-b.start)}return q.getLineAtOffset(d-k)+s},getLineCount:function(){for(var d=this._projections,q=this._model.getLineCount(),
l=0;l<d.length;l++)var k=d[l],q=q+(k._model.getLineCount()-1-k._lineCount);return q},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(d,q){if(0>d)return-1;for(var l=this._model,k=this._projections,s=0,p=0,b=0;b<k.length;b++){var a=k[b];if(a._lineIndex>d-s)break;var h=a._model.getLineCount()-1;if(a._lineIndex+h>d-s)return a._model.getLineEnd(d-(a._lineIndex+s),q)+a.start+p;p+=a._model.getCharCount()-(a.end-a.start);s+=h-a._lineCount}return l.getLineEnd(d-s,q)+
p},getLineStart:function(d){if(0>d)return-1;for(var q=this._model,l=this._projections,k=0,s=0,p=0;p<l.length;p++){var b=l[p];if(b._lineIndex>=d-k)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=d-k)return b._model.getLineStart(d-(b._lineIndex+k))+b.start+s;s+=b._model.getCharCount()-(b.end-b.start);k+=a-b._lineCount}return q.getLineStart(d-k)+s},getText:function(d,q){void 0===d&&(d=0);var l=this._model,k=this._projections,s=0,p=[],b,a,h;for(b=0;b<k.length;b++){a=k[b];if(a.start>d-s)break;
h=a._model.getCharCount();if(a.start+h>d-s){if(void 0!==q&&a.start+h>q-s)return a._model.getText(d-(a.start+s),q-(a.start+s));p.push(a._model.getText(d-(a.start+s)));d=a.end+s+h-(a.end-a.start)}s+=h-(a.end-a.start)}var c=d-s;if(void 0!==q){for(;b<k.length;b++){a=k[b];if(a.start>q-s)break;p.push(l.getText(c,a.start));h=a._model.getCharCount();if(a.start+h>q-s)return p.push(a._model.getText(0,q-(a.start+s))),p.join("");p.push(a._model.getText());c=a.end;s+=h-(a.end-a.start)}p.push(l.getText(c,q-s))}else{for(;b<
k.length;b++)a=k[b],p.push(l.getText(c,a.start)),p.push(a._model.getText()),c=a.end;p.push(l.getText(c))}return p.join("")},_onChanged:function(d){d=this._change;var q=d.baseStart,l=d.baseEnd,k,s,p=this._projections;for(k=0;k<p.length&&!(s=p[k],s.end>q);k++);var b=k;for(k=0;k<p.length&&!(s=p[k],s.start>=l);k++);var a=k,h=this._model,q=d.baseText.length-(l-q);for(k=a;k<p.length;k++)s=p[k],s.start+=q,s.end+=q,s._lineIndex=h.getLineAtOffset(s.start);s=p.splice(b,a-b);for(k=0;k<s.length;k++)s[k].annotation&&
s[k].annotation._expand();this.onChanged({type:"Changed",start:d.start,removedCharCount:d.removedCharCount,addedCharCount:d.addedCharCount,removedLineCount:d.removedLineCount,addedLineCount:d.addedLineCount});this._change=void 0},_onChanging:function(d){var q=!!this._change,l=this._change||{},k=d.start,s=k+d.removedCharCount;l.baseStart=k;l.baseEnd=s;l.baseText=d.text;l.addedLineCount=d.addedLineCount;if(!q){this._change=l;l.text=d.text;var p=this._projections,b,a,h;d=function(c){for(b=a=0;a<p.length;a++){h=
p[a];if(h.start>c)break;if(h.end>c)return-1;b+=h._model.getCharCount()-(h.end-h.start)}return c+b};l.start=d(k);-1===l.start&&(l.text=this._model.getText(h.start,k)+l.text,l.addedLineCount+=this._model.getLineAtOffset(k)-this._model.getLineAtOffset(h.start),l.start=h.start+b);l.end=d(s);-1===l.end&&(l.text+=this._model.getText(s,h.end),l.addedLineCount+=this._model.getLineAtOffset(h.end)-this._model.getLineAtOffset(s),l.end=h.start+b)}l.addedCharCount=l.text.length;l.removedCharCount=l.end-l.start;
l.removedLineCount=this.getLineAtOffset(l.end)-this.getLineAtOffset(l.start);this.onChanging({type:"Changing",text:l.text,start:l.start,removedCharCount:l.removedCharCount,addedCharCount:l.addedCharCount,removedLineCount:l.removedLineCount,addedLineCount:l.addedLineCount})},onChanging:function(d){return this.dispatchEvent(d)},onChanged:function(d){return this.dispatchEvent(d)},setLineDelimiter:function(d){this._model.setLineDelimiter(d)},setText:function(d,q,l){function k(c){for(p=b=0;b<s.length;b++){a=
s[b];if(a.start>c-p)break;var h=a._model.getCharCount();if(a.start+h>c-p)return-1;p+=h-(a.end-a.start)}return c-p}this._change={text:d||"",start:q||0,end:void 0===l?this.getCharCount():l};var s=this._projections,p,b,a,h,c;d=k(this._change.start);-1===d&&(h={projection:a,start:this._change.start-(a.start+p)},d=a.end);q=k(this._change.end);-1===q&&(c={projection:a,end:this._change.end-(a.start+p)},q=a.start);h&&c&&h.projection===c.projection?a._model.setText(this._change.text,h.start,c.end):(this._model.setText(this._change.text,
d,q),h&&(a=h.projection,a._model.setText("",h.start)),c&&(a=c.projection,a._model.setText("",0,c.end),a.start=a.end,a._lineCount=0));this._change=void 0}};w.EventTarget.addMixin(u.prototype);return{ProjectionTextModel:u}});(function(t,w){"function"===typeof B&&B.amd?B("orion/Deferred",w):"object"===typeof exports?module.exports=w():(t.orion=t.orion||{},t.orion.Deferred=w())})(this,function(){function t(){for(var d;d=q.shift();)d();l=!1}function w(d){q.push(d);l||(l=!0,k())}function u(d){return function(p){d(p)}}
function d(){function k(){for(var a;a=e.shift();){var b=a.deferred,n="fulfilled"===c?"resolve":"reject";a=a[n];if("function"===typeof a)try{var r=a(h),d=r&&("object"===typeof r||"function"===typeof r)&&r.then;if("function"===typeof d)if(r===b.promise)b.reject(new TypeError);else{var p=r.cancel;"function"===typeof p?b._parentCancel=p.bind(r):delete b._parentCancel;d.call(r,u(b.resolve),u(b.reject),u(b.progress))}else b.resolve(r)}catch(l){b.reject(l)}else b[n](h)}}function p(a){delete n._parentCancel;
c="rejected";h=a;e.length&&w(k)}function b(a){function f(a){return function(b){(!c||"assumed"===c)&&a(b)}}delete n._parentCancel;try{var v=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===typeof v)if(a===n)p(new TypeError);else{c="assumed";var r=a&&a.cancel;if("function"!==typeof r){var y=new d;a=y.promise;try{v(y.resolve,y.reject,y.progress)}catch(l){y.reject(l)}r=a.cancel;v=a.then}h=a;v.call(a,f(b),f(p));n._parentCancel=r.bind(a)}else c="fulfilled",h=a,e.length&&w(k)}catch(q){f(p)(q)}}
function a(){var a=n._parentCancel;a?(delete n._parentCancel,a()):c||(a=Error("Cancel"),a.name="Cancel",p(a))}var h,c,e=[],n=this;this.resolve=function(a){c||b(a);return n};this.reject=function(a){c||p(a);return n};this.progress=function(a){c||e.forEach(function(c){if(c.progress)try{c.progress(a)}catch(b){}});return n.promise};this.cancel=function(){n._parentCancel?setTimeout(a,0):a();return n};this.then=function(a,b,h){var r=new d;r._parentCancel=n.promise.cancel;e.push({resolve:a,reject:b,progress:h,
deferred:r});("fulfilled"===c||"rejected"===c)&&w(k);return r.promise};this.promise={then:n.then,cancel:n.cancel}}var q=[],l=!1,k=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var d=process.nextTick;return function(){d(t)}}if("function"===typeof MutationObserver){var p=document.createElement("div");(new MutationObserver(t)).observe(p,{attributes:!0});return function(){p.setAttribute("class","_tick")}}return function(){setTimeout(t,0)}}();d.all=function(k,p){function b(a,
b){e||(c[a]=b,0===--h&&n.resolve(c))}function a(a,c){if(!e){if(p)try{b(a,p(c));return}catch(h){c=h}n.reject(c)}}var h=k.length,c=[],e=!1,n=new d;n.then(void 0,function(){e=!0;k.forEach(function(a){a.cancel&&a.cancel()})});0===h?n.resolve(c):k.forEach(function(c,f){c.then(b.bind(void 0,f),a.bind(void 0,f))});return n.promise};d.when=function(k,p,b,a){var h;k&&"function"===typeof k.then||(h=new d,h.resolve(k),k=h.promise);return k.then(p,b,a)};return d});B("orion/webui/littlelib",["orion/util"],function(t){function w(a,
b){b||(b=document);return b.querySelectorAll(a)}function u(a){var b=a.tabIndex;0===b&&t.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[a.nodeName.toLowerCase()]&&!a.attributes.tabIndex&&(b=-1);return b}function d(a){if(0<=u(a))return a;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++){var c=d(a.childNodes[b]);if(c)return c}return null}function q(a){if(0<=u(a))return a;if(a.hasChildNodes())for(var b=a.childNodes.length-1;0<=b;b--){var c=
q(a.childNodes[b]);if(c)return c}return null}function l(a,b){if(3===a.nodeType){var c=k.exec(a.nodeValue);c&&1<c.length&&b(a,c)}if(a.hasChildNodes())for(c=0;c<a.childNodes.length;c++)l(a.childNodes[c],b)}var k=/\$\{([^\}]+)\}/,s=null,p={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46},b=Object.create(null);Object.keys(p).forEach(function(a){b[p[a]]=a});return{$:function(a,b){b||(b=document);return b.querySelector(a)},$$:w,
$$array:function(a,b){return Array.prototype.slice.call(w(a,b))},node:function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b},contains:function(a,b){if(!a||!b)return!1;if(a===b)return!0;var c=a.compareDocumentPosition(b);return Boolean(c&16)},bounds:function(a){a=a.getBoundingClientRect();var b=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),c=Math.max(document.documentElement.scrollTop,document.body.scrollTop);return{left:a.left+b,top:a.top+c,width:a.width,
height:a.height}},empty:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},firstTabbable:d,lastTabbable:q,stop:function(a){window.document.all&&(a.keyCode=0);a.preventDefault&&(a.preventDefault(),a.stopPropagation())},processTextNodes:function(a,b){l(a,function(a,e){a.parentNode.replaceChild(document.createTextNode(b[e[1]]||e[1]),a)})},processDOMNodes:function(a,b){l(a,function(a,e){var n=b[e[1]];if(n){var m=document.createRange(),f=e.index;m.setStart(a,f);m.setEnd(a,f+e[0].length);
m.deleteContents();m.insertNode(n)}})},addAutoDismiss:function(a,b){function c(a){s.forEach(function(c){var b=!1,f=c.excludeNodes.some(function(c){return document.body.contains(c)?(b=!0,c.contains(a.target)):!1});if(b&&!f)try{c.dismiss(a)}catch(h){"undefined"!==typeof console&&console&&console.error(h&&h.message)}});s=s.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===s&&(s=[],document.addEventListener("click",c,!0),t.isIOS&&document.addEventListener("touchend",
function(a){function c(){a.target.removeEventListener("click",c)}0===a.touches.length&&a.target.addEventListener("click",c)},!1));s.push({excludeNodes:a,dismiss:b})},setFramesEnabled:function(a){for(var b=document.getElementsByTagName("iframe"),c=0;c<b.length;c++)b[c].parentNode.style.pointerEvents=a?"":"none"},getOffsetParent:function(a){a=a.parentNode;for(var b=document.documentElement;a&&a!==b;){var c=window.getComputedStyle(a,null);if(!c)break;c=c.getPropertyValue("overflow-y");if("auto"===c||
"scroll"===c)break;a=a.parentNode}return a},removeAutoDismiss:function(a){s=s.filter(function(b){return a!==b.dismiss})},keyName:function(a){return b[a]||null},KEY:p,createNodes:function(a,b){var c=b,e=null;void 0===c&&(c=document.createElement("div"));c.innerHTML=a;return e=1<c.children.length?c.children:c.firstChild}}});B("orion/editor/tooltip","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/projectionTextModel orion/Deferred orion/editor/util orion/webui/littlelib orion/util".split(" "),
function(t,w,u,d,q,l,k){function s(d){this._view=d;d=d.getOptions("parent");this._create(d?d.ownerDocument:document)}s.getTooltip=function(d){d._tooltip||(d._tooltip=new s(d));return d._tooltip};s.prototype={_create:function(d){if(!this._tooltipDiv){var b=this._tooltipDiv=k.createElement(d,"div");b.tabIndex=0;b.className="textviewTooltip";b.setAttribute("aria-live","assertive");b.setAttribute("aria-atomic","true");this._tooltipDiv.style.visibility="hidden";d.body.appendChild(b);var a=this;q.addEventListener(d,
"mousedown",this._mouseDownHandler=function(h){a.isVisible()&&(q.contains(b,h.target||h.srcElement)||a._locked||a.hide())},!0);q.addEventListener(d,"mousemove",this._mouseMoveHandler=function(b){a.isVisible()&&(!a._locked&&!a._hasFocus())&&(a._isInRect(a._outerArea,b.clientX,b.clientY)||a.hide())},!0);q.addEventListener(b,"focus",function(b){a._locked||a._tooltipDiv.classList.add("textViewTooltipOnFocus")},!1);q.addEventListener(b,"blur",function(b){a._tooltipDiv.classList.remove("textViewTooltipOnFocus")},
!1);q.addEventListener(b,"mouseenter",function(b){a._locked||a._tooltipDiv.classList.add("textViewTooltipOnHover")},!1);q.addEventListener(b,"mouseleave",function(b){a._hasFocus()||a._tooltipDiv.classList.remove("textViewTooltipOnHover")},!1);q.addEventListener(b,"keydown",function(b){27===b.keyCode&&(a._locked||a.hide())},!1);this._view.addEventListener("Destroy",function(){a.destroy()})}},destroy:function(){if(this._tooltipDiv){this.hide();var d=this._tooltipDiv.parentNode;d&&d.removeChild(this._tooltipDiv);
d=this._tooltipDiv.ownerDocument;q.removeEventListener(d,"mousedown",this._mouseDownHandler,!0);q.removeEventListener(d,"mousemove",this._mouseMoveHandler,!0);this._tooltipDiv=null}},show:function(d,b,a){this._locked=b;this._giveFocus=a;this._processInfo(d.getTooltipInfo())},update:function(d){d&&this._processInfo(d.getTooltipInfo(),!0)},onHover:function(d,b,a){d&&!this._isInRect(this._anchorArea,b,a)&&(!this._isInRect(this._tooltipArea,b,a)&&!this._locked&&!this._hasFocus())&&this._processInfo(d.getTooltipInfo())},
hide:function(){this.isVisible()&&(this.hover&&this.hover.clearQuickFixes(),this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipDiv.removeChild(this._tooltipContents),this._tooltipContents=null),this._tooltipDiv.classList.remove("textviewTooltipCodeProjection"),this._tooltipDiv.classList.remove("textviewTooltipOnHover"),this._tooltipDiv.classList.remove("textviewTooltipOnFocus"),this._tooltipDiv.style.visibility=
"hidden",this._tooltipDiv.style.left="",this._tooltipDiv.style.right="",this._tooltipDiv.style.top="",this._tooltipDiv.style.bottom="",this._tooltipDiv.style.width="auto",this._tooltipDiv.style.maxWidth="",this._tooltipDiv.style.height="auto",this._tooltipDiv.style.maxHeight="",this._tooltipDiv.style.overflowX="",this._tooltipDiv.style.overflowY="",this._outerArea=this._tooltipArea=this._anchorArea=this._locked=this._giveFocus=void 0,this._hoverPromises&&this._hoverPromises.forEach(function(d){d.resolved||
d.cancel()}),this._tipRect=this._hoverPromises=void 0)},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},_processInfo:function(p,b){if(this._tooltipDiv){var a;b&&this._tooltipContents?(this._tooltipContents.innerHTML="",a=this._tooltipContents):a=k.createElement(this._tooltipDiv.ownerDocument,"div");if(p){if(p.contents&&this._renderImmediateInfo(a,p.contents,p.context))return this._showContents(a,p,b),!0;if(this.hover&&p.context&&(this._hoverPromises=this.hover.computeHoverInfo(p.context))){var h=
this;this._hoverPromises.slice(0).forEach(function(c){d.when(c,function(e){if(h._hoverPromises){var n=h._hoverPromises.indexOf(c);0<=n&&h._hoverPromises.splice(n,1)}e&&h._renderPluginContent(a,e)&&(e.offsetStart&&(p.context.offsetStart=e.offsetStart),e.offsetEnd&&(p.context.offsetEnd=e.offsetEnd),e.allowFullWidth&&(p.allowFullWidth=e.allowFullWidth),h._showContents(a,p,b))},function(a){console&&(a&&"Cancel"!==a.name)&&(console.log("Error computing hover tooltip"),console.log(a&&a.stack))})});return!0}}}},
_showContents:function(d,b,a){if(a){if(this._tooltipArea&&b.tooltipArea&&(this._tooltipArea.left!==b.tooltipArea.left||this._tooltipArea.top!==b.tooltipArea.top||this._tooltipArea.width!==b.tooltipArea.width||this._tooltipArea.height!==b.tooltipArea.height))this._outerArea=this._tooltipArea=this._anchorArea=null}else this.hide();this._tooltipContents=d;this._tooltipDiv.appendChild(d);this._anchorArea||(this._anchorArea=this._computeAnchorArea(b));this._tooltipArea||(this._tooltipArea=this._computeTooltipArea(b,
this._anchorArea,this._tooltipDiv));this._outerArea||(this._outerArea=this._computeOuterArea(this._anchorArea,this._tooltipArea));this._tooltipDiv.style.visibility="visible";this._giveFocus&&(this._setInitialFocus(this._tooltipDiv),this._giveFocus=void 0)},_computeAnchorArea:function(d){if(d.anchorArea&&d.anchorArea.top&&d.anchorArea.left&&d.anchorArea.height&&d.anchorArea.width)return d.anchorArea;if(d.context){if(d.context.offsetStart&&d.context.offsetEnd)return this._computeRectangleFromOffset(d.context.offsetStart,
d.context.offsetEnd);if(0<=d.context.offset){var b=this._view.getNextOffset(d.context.offset,{unit:"word",count:-1});d=this._view.getNextOffset(d.context.offset,{unit:"word",count:0});return this._computeRectangleFromOffset(b,d)}}return{top:0,left:0,height:0,width:0}},_computeTooltipArea:function(d,b,a){var h=a.ownerDocument.documentElement;if(d.tooltipArea&&d.tooltipArea.top&&d.tooltipArea.left&&d.tooltipArea.height&&d.tooltipArea.width)return a.style.overflowY="auto",a.style.resize="none",a.style.top=
d.tooltipArea.top+"px",a.style.left=d.tooltipArea.left+"px",a.style.height=d.tooltipArea.height-16+"px",a.style.width=d.tooltipArea.width-16+"px",d.tooltipArea;var c=a.getBoundingClientRect(),c={width:c.width,height:c.height},e=d.position?d.position:"below",n=(this._view._rootDiv?this._view._rootDiv:h).getBoundingClientRect(),h=n.left,m=n.top,f=n.width,n=n.height,v=f;if(!d.allowFullWidth){var v=Math.min(f/2,600),r=Math.min(n/2,400);c.width=Math.min(c.width,v);c.height=Math.min(c.height,r)}41>c.height&&
c.width>v-16&&(c.height=56);var v=n-(b.top+b.height-m),k=b.top-m,r=f-(b.left+b.width-h);"above"===e&&c.height>k&&c.height<=v?e="below":"below"===e&&(c.height>v&&c.height<=k)&&(e="above");k=d.tooltipOffsetX?d.tooltipOffsetX:0;d=d.tooltipOffsetY?d.tooltipOffsetY:0;switch(e){case "left":c.top=c.height+d>v+b.height?n+m-c.height:b.top+d;c.top=Math.max(c.top,m);c.left=Math.max(b.left-c.width+k,h);break;case "right":c.top=c.height+d>v+b.height?n+m-c.height:b.top+d;c.top=Math.max(c.top,m);c.left=Math.max(b.left+
b.width+k,h);break;case "above":c.left=c.width+k>r+b.width?f+h-c.width:b.left+k;c.left=Math.max(c.left,h);c.top=Math.max(b.top-c.height+d,m);break;case "below":c.left=c.width+k>r+b.width?f+h-c.width:b.left+k,c.left=Math.max(c.left,h),c.top=Math.max(b.top+b.height+d,m)}c.maxWidth=Math.min(f+h-c.left,f);c.maxHeight=Math.min(n+m-c.top,n);a.style.maxWidth=c.maxWidth-16+"px";a.style.maxHeight=c.maxHeight-16+"px";a.style.width=c.width-16+"px";a.style.height=c.height-16+"px";a.style.left=c.left+"px";a.style.top=
c.top+"px";return c},_computeOuterArea:function(d,b){var a=Math.min(d.left,b.left),h=Math.min(d.top,b.top),c=Math.max(d.left+d.width,b.left+b.width),e=Math.max(d.top+d.height,b.top+b.height);return{left:a,top:h,width:c-a,height:e-h}},_hasFocus:function(){var d=this._tooltipDiv;return!d?!1:q.contains(d,d.ownerDocument.activeElement)},_isNode:function(d){return"object"===typeof Node?d instanceof Node:d&&"object"===typeof d&&"number"===typeof d.nodeType&&"string"===typeof d.nodeName},_setInitialFocus:function(d){var b=
l.$("button",d);if(b)b.focus();else if(b=l.$("a",d)){b.focus();var a=this;b.addEventListener("click",function(){a.hide()})}else(d=l.firstTabbable(d))&&d.focus()},_isInRect:function(d,b,a){if(!d)return!1;a=a>=d.top&&a<=d.top+d.height;return b>=d.left&&b<=d.left+d.width&&a},mapOffset:function(d,b){var a=this._view.getModel();a.getBaseModel&&(d=a.mapOffset(d,b));return d},_computeRectangleFromOffset:function(d,b){d=this.mapOffset(d);b=this.mapOffset(b);var a=this._view,h=a.getLineAtOffset(d),c=a.getLineAtOffset(b);
h!==c&&(b=a.getModel().getLineEnd(h));h=a.getLineHeight(h);c=a.getLocationAtOffset(d);a=a.getLocationAtOffset(b);a={x:c.x,y:c.y,width:a.x-c.x,height:h};a=this._view.convert(a,"document","page");return{left:a.x,top:a.y,width:a.width,height:a.height}},_renderPluginContent:function(d,b){var a=this._tooltipDiv.ownerDocument;if("string"!==typeof b&&"undefined"===typeof b.content)return!1;var h=k.createElement(a,"div");if(b.title){var c=k.createElement(a,"div");c.innerHTML=this.hover.renderMarkDown?this.hover.renderMarkDown(b.title):
b.title;h.appendChild(c)}c=k.createElement(a,"div");if("string"===typeof b)c.appendChild(a.createTextNode(b));else switch(b.type){case "delegatedUI":case "html":b.content&&(a=a.createElement("iframe"),a.id="HtmlHover",a.name="HTML Hover",a.type="text/html",a.sandbox="allow-scripts allow-same-origin allow-forms",a.style.border="none",a.style.width="100%",a.style.height="100%",this._tooltipDiv.style.paddingBottom="5px",a.srcdoc=b.content,b.width&&(a.style.width=b.width),b.height&&(a.style.height=b.height),
h.style.height="100%",d.style.height="100%",h.appendChild(a));break;case "markdown":this.hover.renderMarkDown&&(c.innerHTML=this.hover.renderMarkDown(b.content));break;default:c.appendChild(a.createTextNode(b.content))}h.appendChild(c);d.appendChild(h);return!0},_renderImmediateInfo:function(d,b,a){if(b instanceof Array&&(b=this._getAnnotationContents(b,a),!b))return!1;if("string"===typeof b)return d.innerHTML=b,!0;if(this._isNode(b))return d.appendChild(b),!0;if(b instanceof u.ProjectionTextModel){var h=
this._view;a=h.getOptions();a.wrapMode=!1;a.parent=d;var c=a.themeClass;c?((c=c.replace("tooltipTheme",""))&&(c=" "+c),c="tooltipTheme"+c):c="tooltipTheme";a.themeClass=c;a=this._contentsView=new w.TextView(a);a.addEventListener("LineStyle",function(a){h.onLineStyle(a)});a.setModel(b);this._tooltipDiv.appendChild(d);this._tooltipDiv.classList.add("textviewTooltipCodeProjection");b=a.computeSize();d.style.width=b.width+8+"px";d.style.height=b.height+8+"px";a.resize();this._tooltipDiv.removeChild(d);
return!0}return!1},_getAnnotationContents:function(d,b){function a(a,c){var e=a.title,n=k.createElement(f,"div");n.className="tooltipRow";if(a.html){var g=k.createElement(f,"div");g.className="tooltipImage";g.innerHTML=a.html;g.lastChild&&q.addEventListener(g.lastChild,"click",function(){var c=a.start,b=a.end;r.getBaseModel&&(c=r.mapOffset(c,!0),b=r.mapOffset(b,!0));v.setSelection(c,b,1/3,function(){h.hide()})},!1);n.appendChild(g)}e||(e=l.getLineStart(l.getLineAtOffset(a.start)),g=l.getLineEnd(l.getLineAtOffset(a.end),
!0),e=l.getText(e,g));"function"===typeof e&&(e=a.title());"string"===typeof e&&(g=k.createElement(f,"span"),g.className="tooltipTitle",g.appendChild(f.createTextNode(e)),e=g);n.appendChild(e);c&&h.hover.renderQuickFixes(a,n);b&&(b.offsetStart=a.start,b.offsetEnd=a.end);return n}var h=this,c=h.hover?!0:!1;c&&(b&&b.source&&0<=b.source.indexOf("ruler"))&&(c=!1);for(var e,n=[],m=0;m<d.length;m++)e=d[m],""!==e.title&&!e.groupAnnotation&&(!c||e.title)&&n.push(e);d=n;if(0===d.length)return null;var f=this._tooltipDiv.ownerDocument,
v=this._view,r=v.getModel(),l=r.getBaseModel?r.getBaseModel():r;if(1===d.length&&"orion.annotation.folding"===d[0].type)return c=new u.ProjectionTextModel(l),e=l.getLineStart(l.getLineAtOffset(d[0].start)),n=l.getCharCount(),d[0].end!==n&&c.addProjection({start:d[0].end,end:n}),0<e&&c.addProjection({start:0,end:e}),c;if(1===d.length){if((e=a(d[0],c))&&e.firstChild)(c=e.firstChild.className)&&(c+=" "),e.firstChild.className=c+"single";return e}n=k.createElement(f,"div");e=k.createElement(f,"em");e.appendChild(f.createTextNode(t.multipleAnnotations));
n.appendChild(e);for(m=0;m<d.length;m++)(e=a(d[m],c))&&n.appendChild(e);return n}};return{Tooltip:s}});B("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(t,w){function u(){}function d(a,b,c){this.start=a;this.end=b;this._projectionModel=c;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function q(a,b){var c=a.lastIndexOf("."),c=a.substring(c+1),e={title:t[c],style:{styleClass:"annotation "+c},html:"\x3cdiv class\x3d'annotationHTML "+
c+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+c}};b?e.lineStyle={styleClass:"annotationLine "+c}:e.rangeStyle={styleClass:"annotationRange "+c};u.registerType(a,e)}function l(){}function k(a,b,c,e,n){var m;void 0===e&&(e=-1);void 0===n&&(n=a.length);for(;1<n-e;)if(m=Math.floor((n+e)/2),b<=a[m].start)n=m;else if(c&&b<a[m].end){n=m;break}else e=m;return n}function s(a){this._annotations=[];var b=this;this._listener={onChanged:function(a){b._onChanged(a)}};this.setTextModel(a)}
function p(a,b){this._view=a;this._annotationModel=b;var c=this;this._listener={onDestroy:function(a){c._onDestroy(a)},onLineStyle:function(a){c._onLineStyle(a)},onChanged:function(a){c._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);b.addEventListener("Changed",this._listener.onChanged)}d.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},
_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);
return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;var b=a.getBaseModel();this._projection={annotation:this,start:b.getLineStart(b.getLineAtOffset(this.start)+1),end:b.getLineEnd(b.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&
(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var b=this._annotationModel.getAnnotations(this.start,this.end);b.hasNext();){var c=b.next();c!==this&&c.type===u.ANNOTATION_FOLDING&&a.call(this,c)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};u.ANNOTATION_ERROR="orion.annotation.error";u.ANNOTATION_WARNING="orion.annotation.warning";u.ANNOTATION_TASK="orion.annotation.task";
u.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";u.ANNOTATION_BOOKMARK="orion.annotation.bookmark";u.ANNOTATION_FOLDING="orion.annotation.folding";u.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";u.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";u.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";u.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";u.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";u.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";
u.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";u.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup";u.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";u.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";u.ANNOTATION_BLAME="orion.annotation.blame";u.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";u.ANNOTATION_DIFF_ADDED="orion.annotation.diffAdded";u.ANNOTATION_DIFF_DELETED="orion.annotation.diffDeleted";u.ANNOTATION_DIFF_MODIFIED=
"orion.annotation.diffModified";var b={};u.registerType=function(a,h){var c=h;"function"!==typeof c&&(c=function(a,c,b){this.start=a;this.end=c;void 0!==b&&(this.title=b)},c.prototype=h);c.prototype.type=a;b[a]=c;return a};u.createAnnotation=function(a,b,c,e){return new (this.getType(a))(b,c,e)};u.getType=function(a){return b[a]};q(u.ANNOTATION_ERROR);q(u.ANNOTATION_WARNING);q(u.ANNOTATION_TASK);q(u.ANNOTATION_BREAKPOINT);q(u.ANNOTATION_BOOKMARK);q(u.ANNOTATION_CURRENT_BRACKET);q(u.ANNOTATION_MATCHING_BRACKET);
q(u.ANNOTATION_CURRENT_SEARCH);q(u.ANNOTATION_MATCHING_SEARCH);q(u.ANNOTATION_READ_OCCURRENCE);q(u.ANNOTATION_WRITE_OCCURRENCE);q(u.ANNOTATION_SELECTED_LINKED_GROUP);q(u.ANNOTATION_CURRENT_LINKED_GROUP);q(u.ANNOTATION_LINKED_GROUP);q(u.ANNOTATION_CURRENT_LINE,!0);q(u.ANNOTATION_BLAME,!0);q(u.ANNOTATION_CURRENT_BLAME,!0);q(u.ANNOTATION_DIFF_ADDED);q(u.ANNOTATION_DIFF_DELETED);q(u.ANNOTATION_DIFF_MODIFIED);u.registerType(u.ANNOTATION_FOLDING,d);l.addMixin=function(a){var b=l.prototype,c;for(c in b)b.hasOwnProperty(c)&&
(a[c]=b[c])};l.prototype={addAnnotationType:function(a,b){this._annotationTypes||(this._annotationTypes=[]);var c=b-1;void 0==b||!(0<=c&&c<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(c,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a)return b+1;return 0},getAnnotationsByType:function(a,b,c){a=a.getAnnotations(b,c);for(c=[];a.hasNext();)b=a.next(),0!==this.getAnnotationTypePriority(b.type)&&
c.push(b);var e=this;c.sort(function(a,c){return e.getAnnotationTypePriority(a.type)-e.getAnnotationTypePriority(c.type)});return c},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var b=0;b<this._annotationTypes.length;b++)if(this._annotationTypes[b]===a){this._annotationTypes.splice(b,1);break}}};s.prototype={addAnnotation:function(a){if(a){var b=this._annotations,c=k(b,a.start);b.splice(c,0,a);a._annotationModel=
this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,b){var c=this._annotations,e,n=0,m;m=void 0===a&&void 0===b?function(){return n<c.length?c[n++]:null}:function(){for(;n<c.length;){var f=c[n++];if(a===f.start||(a>f.start?a<f.end:f.start<b))return f;if(f.start>=b)break}return null};e=m();return{next:function(){var a=e;a&&(e=m());return a},hasNext:function(){return null!==e}}},modifyAnnotation:function(a){if(a&&
!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var b=this._annotations,c,e;if(a){c=[];for(e=b.length-1;0<=e;e--){var n=b[e];n.type===a&&(b.splice(e,1),c.splice(0,0,n),n._annotationModel=null)}}else c=b;this.onChanged({type:"Changed",removed:c,added:[],changed:[]})},removeAnnotation:function(a){if(a){var b=this._getAnnotationIndex(a);0>b||(a._annotationModel=null,a=
{type:"Changed",removed:this._annotations.splice(b,1),added:[],changed:[]},this.onChanged(a))}},replaceAnnotations:function(a,b){var c=this._annotations,e,n,m,f=[];if(a)for(e=a.length-1;0<=e;e--)m=a[e],n=this._getAnnotationIndex(m),0>n||(m._annotationModel=null,c.splice(n,1),f.splice(0,0,m));b||(b=[]);for(e=0;e<b.length;e++)m=b[e],n=k(c,m.start),m._annotationModel=this,c.splice(n,0,m);this.onChanged({type:"Changed",removed:f,added:b,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",
this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(a){for(var b=this._annotations,c=k(b,a.start);c<b.length&&b[c].start===a.start;){if(b[c]===a)return c;c++}return-1},_onChanged:function(a){var b=a.start,c=a.addedCharCount,e=a.removedCharCount,n=this._annotations,m=b+e;if(0<n.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};c-=e;for(e=0;e<n.length;e++){var f=n[e];f.start>=m?(f._oldStart=
f.start,f._oldEnd=f.end,f.start+=c,f.end+=c,a.changed.push(f)):f.end<=b||(f.start<b&&m<f.end?(f._oldStart=f.start,f._oldEnd=f.end,f.end+=c,a.changed.push(f)):(n.splice(e,1),a.removed.push(f),f._annotationModel=null,f.expand&&f.expand(),e--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};w.EventTarget.addMixin(s.prototype);p.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",
this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var c;b.tagName&&!a.tagName&&(a.tagName=b.tagName);if(b.style)for(c in a.style||(a.style={}),b.style)a.style[c]||(a.style[c]=b.style[c]);if(b.attributes)for(c in a.attributes||(a.attributes={}),b.attributes)a.attributes[c]||
(a.attributes[c]=b.attributes[c])}return a},_mergeStyleRanges:function(a,b){a||(a=[]);for(var c,e=k(a,b.start,!0);e<a.length&&b;e++){var n=a[e];if(b.end<=n.start)break;if(!(b.start>=n.end)){c=this._mergeStyle({},n.style);c=this._mergeStyle(c,b.style);var m=[];m.push(e,1);b.start<n.start&&m.push({start:b.start,end:n.start,style:b.style});b.start>n.start&&m.push({start:n.start,end:b.start,style:n.style});m.push({start:Math.max(n.start,b.start),end:Math.min(n.end,b.end),style:c});b.end<n.end&&m.push({start:b.end,
end:n.end,style:n.style});b=b.end>n.end?{start:n.end,end:b.end,style:b.style}:null;Array.prototype.splice.apply(a,m)}}b&&(c=this._mergeStyle({},b.style),a.splice(e,0,{start:b.start,end:b.end,style:c}));return a},_onAnnotationModelChanged:function(a){function b(a,c){m.getBaseModel&&(a=m.mapOffset(a,!0),c=m.mapOffset(c,!0));-1!==a&&-1!==c&&e.redrawRange(a,c)}function c(a,c){for(var e=0;e<a.length;e++)if(n.isAnnotationTypeVisible(a[e].type)){var m=a[e];b(m.start,m.end);c&&(void 0!==m._oldStart&&m._oldEnd)&&
b(m._oldStart,m._oldEnd)}}var e=this._view;if(e){var n=this,m=e.getModel();c(a.added);c(a.removed);c(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var b=this._annotationModel,c=a.textView.getModel(),e=b.getTextModel(),n=a.lineStart,m=a.lineStart+a.lineText.length;e!==c&&(n=c.mapOffset(n),m=c.mapOffset(m));for(b=b.getAnnotations(n,m);b.hasNext();)if(n=b.next(),this.isAnnotationTypeVisible(n.type)){if(n.rangeStyle){var m=n.start,f=n.end;e!==c&&(m=c.mapOffset(m,!0),
f=c.mapOffset(f,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:m,end:f,style:n.rangeStyle})}n.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,n.lineStyle))}}};l.addMixin(p.prototype);return{FoldingAnnotation:d,AnnotationType:u,AnnotationTypeList:l,AnnotationModel:s,AnnotationStyler:p}});B("orion/objects",[],function(){function t(t){for(var u=Object.prototype.hasOwnProperty,d=1,q=arguments.length;d<q;d++){var l=arguments[d],k;for(k in l)u.call(l,k)&&(t[k]=l[k])}return t}
return{clone:function(w){if(Array.isArray(w))return Array.prototype.slice.call(w);var u=Object.create(Object.getPrototypeOf(w));t(u,w);return u},mixin:t,toArray:function(t){return Array.isArray(t)?t:[t]}}});B("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(t,w,u,d,q,l){function k(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=
b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(b){a.onChanged(b)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}function s(b){b=b||{};k.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._zoomRulerFactory=b.zoomRulerFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=
b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._hoverFactory=b.hoverFactory;this._contentAssist=this._foldingRuler=this._zoomRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var p=d.AnnotationType;k.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},
checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._undoStack?!this._undoStack.isClean():this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},
onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,h){this._statusReporter&&this._statusReporter(b,a,h)},resize:function(){},setDirty:function(b){this._dirty!==b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,h,c){this._title=b;c||(a?this.reportStatus(a,"error"):null!==h&&void 0!==h&&("string"===typeof h&&this._setModelText(h),
this._undoStack&&this._undoStack.reset()));this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:h,contentsSaved:c})},setText:function(b,a,h){this.getModel().setText(b,a,h)},uninstall:function(){this.installed=!1}};w.EventTarget.addMixin(k.prototype);s.prototype=new k;q.mixin(s.prototype,{destroy:function(){k.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=
this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getTooltip:function(){return u.Tooltip.getTooltip(this._textView)},
getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},
focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var h=this._textView;b?h.addRuler(this._annotationRuler,0):h.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=b,this._foldingRuler){var h=this._textView;h.getModel().getBaseModel&&
(b?h.addRuler(this._foldingRuler):h.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var h=this._textView;b?h.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):h.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=b,this._overviewRuler){var h=this._textView;b?h.addRuler(this._overviewRuler):
h.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(b,a){if(this._zoomRulerVisible!==b||a)if(this._zoomRulerVisible=b,this._zoomRuler){var h=this._textView;b?h.addRuler(this._zoomRuler):h.removeRuler(this._zoomRuler)}},mapOffset:function(b,a){var h=this._textView.getModel();h.getBaseModel&&(b=h.mapOffset(b,a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},
getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},getSelections:function(){var b=this._textView,a=b.getModel(),b=b.getSelections();b.forEach(function(b){a.getBaseModel&&(b.start=a.mapOffset(b.start),b.end=a.mapOffset(b.end))});return b},_expandOffset:function(b){var a=this._textView.getModel(),h=this._annotationModel;if(h&&a.getBaseModel)for(b=h.getAnnotations(b,b+1);b.hasNext();)a=b.next(),
a.type===p.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,h){var c=this._textView,e=c.getModel();e.getBaseModel&&(this._expandOffset(b),b=e.mapOffset(b,!0));c.setCaretOffset(b,a,h)},setText:function(b,a,h,c,e){var n=this._textView,m=n.getModel();m.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=m.mapOffset(a,!0)),void 0!==h&&(this._expandOffset(h),h=m.mapOffset(h,!0)));n.setText(b,a,h,c,e)},setSelection:function(b,a,h,c){var e=this._textView,n=e.getModel();n.getBaseModel&&
(this._expandOffset(b),this._expandOffset(a),b=n.mapOffset(b,!0),a=n.mapOffset(a,!0));e.setSelection(b,a,h,c)},setSelections:function(b,a,h){var c=this,e=this._textView,n=e.getModel();b.forEach(function(a){var b=a.start,e=a.end;n.getBaseModel&&(c._expandOffset(b),c._expandOffset(e),b=n.mapOffset(b,!0),e=n.mapOffset(e,!0));a.start=b;a.end=e});e.setSelections(b,a,h)},moveSelection:function(b,a,h,c){var e=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===c||c)&&e.focus();h&&h()})},_getTooltipInfo:function(b,
a){var h=this._textView,c=this.getAnnotationModel();if(!c)return null;var e=this._annotationStyler;if(!e||!h.isValidTextPosition(b,a))return null;h=h.getOffsetAtLocation(b,a);if(-1===h)return null;for(var h=this.mapOffset(h),c=e.getAnnotationsByType(c,h,h+1),e=[],n=0;n<c.length;n++)c[n].rangeStyle&&e.push(c[n]);return{contents:e,position:"below",context:{source:"editor",offset:h}}},_highlightCurrentLine:function(b,a){function h(a){var c={};return a&&a.some(function(a){if(a&&a.isEmpty())c[m.getLineAtOffset(a.start).toString()]=
!0;else return!0;return!1})?{}:c}function c(a,c){for(var b in a)if(!c[b])return!0;return!1}var e=this._annotationModel;if(e){var n=this._textView;if(!n.getOptions("singleMode")){a=Array.isArray(a)?a:[a];b=Array.isArray(b)?b:[b];var m=n.getModel(),n=h(a),f=h(b);if(c(n,f)||c(f,n)){var n=this._currentLineAnnotations,d=[],r;for(r in f){var k=r>>0,f=m.getLineStart(k),k=m.getLineEnd(k);m.getBaseModel&&(f=m.mapOffset(f),k=m.mapOffset(k));f=p.createAnnotation(p.ANNOTATION_CURRENT_LINE,f,k);d.push(f)}this._currentLineAnnotations=
d;e.replaceAnnotations(n,d)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=this._textViewFactory();this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this._textView.setOptions({undoStack:this._undoStack}),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());
var b=u.Tooltip.getTooltip(this._textView);this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this),b.hover=this._hover);var a=this,d=this._textView,c=this;this._listener={onModelChanged:function(a){c.checkDirty()},onMouseOver:function(a){c._listener.onMouseMove(a)},onMouseDown:function(a){c._listener.mouseDown=!0},onMouseUp:function(a){c._listener.mouseDown=!1},onMouseMove:function(a){b&&!c._listener.mouseDown&&!(a.event.clientX===c._listener.lastMouseX&&a.event.clientY===c._listener.lastMouseY)&&
(c._listener.lastMouseX=a.event.clientX,c._listener.lastMouseY=a.event.clientY,c._hoverTimeout&&(window.clearTimeout(c._hoverTimeout),c._hoverTimeout=null),c._hoverTimeout=window.setTimeout(function(){c._hoverTimeout=null;if(c._listener)b.onHover({y:a.y,x:a.x,getTooltipInfo:function(){return c._getTooltipInfo(this.x,this.y)}},a.x,a.y)},175))},onMouseOut:function(a){c._hoverTimeout&&(window.clearTimeout(c._hoverTimeout),c._hoverTimeout=null)},onScroll:function(a){b&&b.hide()},onSelection:function(a){b&&
b.hide();c._updateCursorStatus();c._highlightCurrentLine(a.newValue,a.oldValue)}};d.addEventListener("ModelChanged",this._listener.onModelChanged);d.addEventListener("Selection",this._listener.onSelection);d.addEventListener("MouseOver",this._listener.onMouseOver);d.addEventListener("MouseOut",this._listener.onMouseOut);d.addEventListener("MouseDown",this._listener.onMouseDown);d.addEventListener("MouseUp",this._listener.onMouseUp);d.addEventListener("MouseMove",this._listener.onMouseMove);d.addEventListener("Scroll",
this._listener.onScroll);if(this._keyBindingFactory){var e;if(e="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(a,this._undoStack,this._contentAssist))this._textActions=e.textActions,this._linkedMode=e.linkedMode,this._sourceCodeActions=e.sourceCodeActions}e=function(c,b){if(void 0!==c&&-1!==c){for(var e=this.getView().getModel(),n=this.getAnnotationModel(),m=a.mapOffset(e.getLineStart(c)),
e=a.mapOffset(e.getLineEnd(c)),d=n.getAnnotations(m,e),h=null;d.hasNext();){var k=d.next();if(k.type===p.ANNOTATION_BOOKMARK){h=k;break}}h?n.removeAnnotation(h):(h=p.createAnnotation(p.ANNOTATION_BOOKMARK,m,e,a.getText(m,e)),n.addAnnotation(h))}};if(this._annotationFactory){var n=d.getModel();n.getBaseModel&&(n=n.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(n))if(n=this._annotationStyler=this._annotationFactory.createAnnotationStyler(d,this._annotationModel))n.addAnnotationType(p.ANNOTATION_CURRENT_SEARCH),
n.addAnnotationType(p.ANNOTATION_MATCHING_SEARCH),n.addAnnotationType(p.ANNOTATION_ERROR),n.addAnnotationType(p.ANNOTATION_WARNING),n.addAnnotationType(p.ANNOTATION_MATCHING_BRACKET),n.addAnnotationType(p.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(p.ANNOTATION_CURRENT_LINE),n.addAnnotationType(p.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(p.ANNOTATION_WRITE_OCCURRENCE),n.addAnnotationType(p.ANNOTATION_SELECTED_LINKED_GROUP),n.addAnnotationType(p.ANNOTATION_CURRENT_LINKED_GROUP),n.addAnnotationType(p.ANNOTATION_LINKED_GROUP),
n.addAnnotationType("orion.annotation.highlightError");var n=this._annotationFactory.createAnnotationRulers(this._annotationModel),m=this._annotationRuler=n.annotationRuler;m&&(m.onDblClick=e,m.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),m.addAnnotationType(p.ANNOTATION_ERROR),m.addAnnotationType(p.ANNOTATION_WARNING),m.addAnnotationType(p.ANNOTATION_TASK),m.addAnnotationType(p.ANNOTATION_BOOKMARK),m.addAnnotationType(p.ANNOTATION_DIFF_ADDED),m.addAnnotationType(p.ANNOTATION_DIFF_DELETED),
m.addAnnotationType(p.ANNOTATION_DIFF_MODIFIED));this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0);if(m=this._overviewRuler=n.overviewRuler)m.addAnnotationType(p.ANNOTATION_CURRENT_SEARCH),m.addAnnotationType(p.ANNOTATION_MATCHING_SEARCH),m.addAnnotationType(p.ANNOTATION_READ_OCCURRENCE),m.addAnnotationType(p.ANNOTATION_WRITE_OCCURRENCE),m.addAnnotationType(p.ANNOTATION_CURRENT_BLAME),m.addAnnotationType(p.ANNOTATION_ERROR),m.addAnnotationType(p.ANNOTATION_WARNING),
m.addAnnotationType(p.ANNOTATION_TASK),m.addAnnotationType(p.ANNOTATION_BOOKMARK),m.addAnnotationType(p.ANNOTATION_MATCHING_BRACKET),m.addAnnotationType(p.ANNOTATION_CURRENT_BRACKET),m.addAnnotationType(p.ANNOTATION_CURRENT_LINE),m.addAnnotationType(p.ANNOTATION_DIFF_ADDED),m.addAnnotationType(p.ANNOTATION_DIFF_DELETED),m.addAnnotationType(p.ANNOTATION_DIFF_MODIFIED);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=
this._zoomRulerFactory.createZoomRuler(this._annotationModel),this.setZoomRulerVisible(this._zoomRulerVisible,!0));this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(p.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(p.ANNOTATION_BLAME),this._lineNumberRuler.addAnnotationType(p.ANNOTATION_DIFF_ADDED),this._lineNumberRuler.addAnnotationType(p.ANNOTATION_DIFF_MODIFIED),
this._lineNumberRuler.addAnnotationType(p.ANNOTATION_DIFF_DELETED),this._lineNumberRuler.onDblClick=e,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(p.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",
textView:d});k.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var b=this._textView;b&&(b.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotations=this._title=null,this._dirty=!1,this._foldingRulerVisible=
this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),k.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=this.getKeyModes(),a=0;a<b.length;a++){var d=b[a];if(d.isActive()&&d.isStatusActive&&d.isStatusActive())return}b=this.getModel();a=this.getSelections();1<a.length?b=l.formatMessage(t.multiSelections,a.length):(a=a[0].getCaret(),d=b.getLineAtOffset(a),
b=b.getLineStart(d),b=l.formatMessage(t.lineColumn,d+1,a-b+1));this.reportStatus(b)},showAnnotations:function(b,a,d,c){var e=this._annotationModel;if(e){for(var n=[],m=[],f=e.getTextModel(),v=e.getAnnotations(),r;v.hasNext();)r=v.next(),-1!==a.indexOf(r.type)&&r.creatorID===this&&n.push(r);if(b)for(a=0;a<b.length;a++)if(r=b[a]){if(d)r=d(r);else{var k;r.lineStart&&r.lineEnd?(v=f.getLineStart(r.lineStart),k=f.getLineCount()===r.lineEnd?f.getLineEnd(r.lineEnd-1):f.getLineStart(r.lineEnd)):"number"===
typeof r.line?(k=f.getLineStart(r.line-1),v=k+r.start-1,k=k+r.end-1):(v=r.start,k=r.end);var l=c(r);if(!l)continue;r=p.createAnnotation(l,v,k,r.description)}r.id=b[a].id;b[a].data&&(r.data=b[a].data);r.creatorID=this;m.push(r)}e.replaceAnnotations(n,m)}},showProblems:function(b){this.showAnnotations(b,[p.ANNOTATION_ERROR,p.ANNOTATION_WARNING,p.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return p.ANNOTATION_ERROR;case "warning":return p.ANNOTATION_WARNING;case "task":return p.ANNOTATION_TASK}return null})},
showOccurrences:function(b){this.showAnnotations(b,[p.ANNOTATION_READ_OCCURRENCE,p.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?p.ANNOTATION_READ_OCCURRENCE:p.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,h=this.getTextView().getOptions("parent").ownerDocument;if(!a){var c=l.createElement(h,"div");c.className="annotation blame";h.body.appendChild(c);var e=(h.defaultView||h.parentWindow).getComputedStyle(c).getPropertyValue("background-color");c.parentNode.removeChild(c);
var c=e.indexOf("("),n=e.indexOf(")"),e=e.substring(c+1,n);this._blameRGB=a=e.split(",").slice(0,3)}var m=function(){var a=d.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=q.mixin({},a.style);a.style.style=q.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},f=function(){var a=l.createElement(h,"div");a.className="tooltipTitle";var c=this.blame.Message.indexOf("\n");
-1===c&&(c=this.blame.Message.length);var b=l.createElement(h,"a");b.href=this.blame.CommitLink;b.appendChild(h.createTextNode(this.blame.Message.substring(0,c)));a.appendChild(b);a.appendChild(l.createElement(h,"br"));a.appendChild(h.createTextNode(l.formatMessage(t.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},v=this.getModel();this.showAnnotations(b,[p.ANNOTATION_BLAME,p.ANNOTATION_CURRENT_BLAME],function(c){var b=v.getLineStart(c.Start-1),e=v.getLineEnd(c.End-1,!0),b=d.AnnotationType.createAnnotation(p.ANNOTATION_BLAME,
b,e,f),e=a.slice(0);e.push(c.Shade);b.style=q.mixin({},b.style);b.style.style=q.mixin({},b.style.style);b.style.style.backgroundColor="rgba("+e.join()+")";b.groupId=c.Name;b.groupType=p.ANNOTATION_CURRENT_BLAME;b.createGroupAnnotation=m;b.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+c.AuthorImage+'"/\x3e';b.blame=c;return b})},showDiffAnnotations:function(b){this.showAnnotations(b,[p.ANNOTATION_DIFF_ADDED,p.ANNOTATION_DIFF_MODIFIED,p.ANNOTATION_DIFF_DELETED],null,function(a){return"added"===
a.type?p.ANNOTATION_DIFF_ADDED:"modified"===a.type?p.ANNOTATION_DIFF_MODIFIED:p.ANNOTATION_DIFF_DELETED})},showSelection:function(b,a,d,c,e){return"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a),!0):"number"===typeof d?(b=this.getModel().getLineStart(d-1),"number"===typeof c&&(b+=c),"number"!==typeof e&&(e=0),this.moveSelection(b,b+e),!0):!1},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelections()))},
setInput:function(b,a,d,c,e){k.prototype.setInput.call(this,b,a,d,c);this._textView&&(!c&&!e)&&this._textView.focus()},onGotoLine:function(b,a,d,c){if(this._textView){var e=this.getModel();b=Math.max(0,Math.min(b,e.getLineCount()-1));var n=e.getLineStart(b),m=0;void 0===d&&(d=0);"string"===typeof a?(b=e.getLine(b).indexOf(a),-1!==b&&(m=b,d=m+a.length)):(m=a,a=e.getLineEnd(b)-n,m=Math.min(m,a),d=Math.min(d,a));this.moveSelection(n+m,n+d,c)}}});return{BaseEditor:k,Editor:s}});B("orion/editor/find",
"i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(t,w,u,d,q,l,k){function s(a){var b=a.getTextView();u.KeyMode.call(this,b);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";b.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));b.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));var c=this;
this._listener={onVerify:function(a){var b=c.editor,m=b.getModel(),f=b.mapOffset(a.start),b=b.mapOffset(a.end),m=m.getText(f,b);if((m=c._prefix.match(RegExp("^"+q.escape(m),"i")))&&0<m.length)c._prefix+=a.text,c._success=!0,c._status(),c.find(c._forward,!0),a.text=null},onSelection:function(){c._ignoreSelection||c.setActive(!1)}}}function p(a,b,c){if(a){this._editor=a;this._undoStack=b;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=!0;this._regex=
!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var e=this;this._listeners={onEditorFocus:function(a){e._removeCurrentAnnotation(a)}};this.setOptions(c)}}var b={};s.prototype=new u.KeyMode;l.mixin(s.prototype,{createKeyBindings:function(){var a=w.KeyBinding,b=[];b.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});b.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});b.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});b.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});b.push({actionID:"incrementalFind",keyBinding:new a(40)});b.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});b.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return b},find:function(a,b){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var c=this._prefix;if(0===c.length)return!1;var e=this.editor,n=e.getModel(),n=a?this._success?b?this._start:e.getCaretOffset()+
1:0:this._success?b?this._start:e.getCaretOffset():n.getCharCount()-1;(c=e.getModel().find({string:c,start:n,reverse:!a,caseInsensitive:c.toLowerCase()===c}).next())?(b||(this._start=n),this._ignoreSelection=this._success=!0,e.moveSelection(a?c.start:c.end,a?c.end:c.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?t.incrementalFindStr:t.incrementalFindStrNotFound:this._success?t.incrementalFindReverseStr:t.incrementalFindReverseStrNotFound;a=k.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=s;p.prototype={find:function(a,b,c){this.setOptions({reverse:!a});var e=this.getFindString(),n;b&&(e=b.findString||e,n=b.count);a=this.getOptions();this.setOptions(b);b=c?this._startOffset:this.getStartOffset();if((n=this._doFind(e,b,n))&&!c)this._startOffset=n.start;this.setOptions(a);this._hideAfterFind&&this.hide();return n},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=q.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var b=a;if(this._regex){for(var b="",c=!1,e=this._editor.getModel().getLineDelimiter(),n=0;n<a.length;n++){var m=a.substring(n,n+1);if(c){switch(m){case "R":b+=e;break;case "r":b+=
"\r";break;case "n":b+="\n";break;case "t":b+="\t";break;case "\\":b+="\\";break;default:b+="\\"+m}c=!1}else"\\"===m?c=!0:b+=m}c&&(b+="\\")}return b},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var b=this._editor,c=this._processReplaceString(this.getReplaceString()),e=b.getSelection().start;if(b=b.getModel().find({string:a,start:e,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(b.start,b.end,a,c),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var b=this._editor,c=b.getTextView();b.reportStatus(t.replacingAll);var e=this._processReplaceString(this.getReplaceString()),n=this;window.setTimeout(function(){for(var m=0,f=0;;){var d=n._doFind(a,m,null,!0);if(!d)break;f++;1===f&&(c.setRedraw(!1),n.startUndo());n._doReplace(d.start,d.end,a,e);m=n.getStartOffset()}0<
f&&(n.endUndo(),c.setRedraw(!0));0<m?b.reportStatus(k.formatMessage(t.replacedMatches,f)):b.reportStatus(t.nothingReplaced,"error");n._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var b=this._editor.getAnnotationModel();b&&b.removeAnnotations(d.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var b=this;window.setTimeout(function(){b._incremental&&b.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,b,c){return this._editor.getModel().find({string:a,start:b,end:this._end,reverse:this._reverse,wrap:c?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,b,c,e){c=c||1;var n=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var m,f;if(this._regex)try{f=this._find(a,b,e)}catch(v){n.reportStatus(v.message,
"error");return}else f=this._find(a,b,e);for(a=0;a<c&&f.hasNext();a++)m=f.next();if(!this._replacingAll){m?this._editor.reportStatus(""):this._editor.reportStatus(t.notFound,"error");if(this.isVisible()){c=d.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(f=n.getAnnotationModel())f.removeAnnotations(c),m&&f.addAnnotation(d.AnnotationType.createAnnotation(c,m.start,m.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var r=this;this._timer=window.setTimeout(function(){r._markAllOccurrences();
r._timer=null},500)}}this._findCallback?this._findCallback(m):m&&n.moveSelection(m.start,m.end,null,!1)}return m},_doReplace:function(a,b,c,e){var n=this._editor;this._regex&&(e=n.getText(a,b).replace(RegExp(c,this._caseInsensitive?"i":""),e));n.setText(e,a,b);n.setSelection(a,a+e.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var b=d.AnnotationType.ANNOTATION_MATCHING_SEARCH,c=a.getAnnotations(),e=[],n;c.hasNext();){var m=c.next();m.type===b&&e.push(m)}if(this.isVisible()){c=
this.getFindString();c=this._editor.getModel().find({string:c,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(n=[];c.hasNext();)m=c.next(),n.push(d.AnnotationType.createAnnotation(b,m.start,m.end))}a.replaceAnnotations(e,n)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(d.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(d.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=
this._editor.getAnnotationModel())&&a.removeAnnotations(d.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=p;return b});B("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(t,w,u,d,q){function l(d,l,p){w.Find.call(this,d,l,p)}l.prototype=new w.Find;u.mixin(l.prototype,{getFindString:function(){var d=this._findInput;return!d?w.Find.prototype.getFindString.call(this):d.value},getReplaceString:function(){var d=this._replaceInput;
return!d?w.Find.prototype.getReplaceString(this):d.value},hide:function(){var d=this.isVisible();w.Find.prototype.hide.call(this);d&&(this._rootDiv.className="textViewFind")},show:function(d){w.Find.prototype.show.call(this,d);var l=d.findString;d=d.replaceString;var p=this._findInput;p||(this._create(),p=this._findInput);l&&(p.value=l);d&&(this._replaceInput.value=d);var b=this;window.setTimeout(function(){b._rootDiv.className="textViewFind show";p.select();p.focus()},0)},_create:function(){var k=
this,l=this._editor.getTextView(),p=l.getOptions("parent").ownerDocument,b=q.createElement(p,"div");b.className="textViewFind";d.addEventListener(b,"keydown",function(a){k._handleKeyDown(a)});this._rootDiv=b;this._createContents(p,b);l._rootDiv.insertBefore(b,l._rootDiv.firstChild)},_createContents:function(k,l){var p=this,b=q.createElement(k,"input");b.className="textViewFindInput";this._findInput=b;b.type="text";b.placeholder=t.findWith;d.addEventListener(b,"input",function(a){return p._handleInput(a)});
l.appendChild(b);b=q.createElement(k,"span");p._createButton(k,b,t.next,function(){p.find(!0)});p._createButton(k,b,t.previous,function(){p.find(!1)});l.appendChild(b);p._editor.getTextView().getOptions("readonly")||(b=q.createElement(k,"input"),b.className="textViewReplaceInput",this._replaceInput=b,b.type="text",b.placeholder=t.replaceWith,l.appendChild(b),b=q.createElement(k,"span"),p._createButton(k,b,t.replace,function(){p.replace()}),p._createButton(k,b,t.replaceAll,function(){p.replaceAll()}),
l.appendChild(b));b=q.createElement(k,"span");p._createButton(k,b,t.regex,function(a){p._toggle("regex",a.target)},this._regex,t.regexTooltip);p._createButton(k,b,t.caseInsensitive,function(a){p._toggle("caseInsensitive",a.target)},this._caseInsensitive,t.caseInsensitiveTooltip);p._createButton(k,b,t.wholeWord,function(a){p._toggle("wholeWord",a.target)},this._wholeWord,t.wholeWordTooltip);l.appendChild(b);b=p._createButton(k,l,"",function(){p.hide()});b.className="textViewFindCloseButton";b.title=
t.closeTooltip},_createButton:function(k,l,p,b,a,h){var c=k.createElement("button");this._checked(a,c);h&&(c.title=h);d.addEventListener(c,"click",function(a){b.call(this,a)},!1);p&&c.appendChild(k.createTextNode(p));l.appendChild(c);return c},_toggle:function(d,l){var p={};p[d]=!this["_"+d];this.setOptions(p);this._checked(p[d],l)},_checked:function(d,l){l.className="textViewFindButton";d&&(l.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(d){var l,
p=(q.isMac?d.metaKey:d.ctrlKey)&&!d.altKey&&!d.shiftKey;p&&70===d.keyCode&&(l=!0);if((q.isMac?d.metaKey:d.ctrlKey)&&!d.altKey&&75===d.keyCode||13===d.keyCode)13===d.keyCode?this.find(this._reverse?d.shiftKey:!d.shiftKey):this.find(!d.shiftKey),l=!0;p&&82===d.keyCode&&(this.replace(),l=!0);27===d.keyCode&&(this.hide(),l=!0);return l?(d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault(),d.cancelBubble=!0,!1):!0}});return{FindUI:l}});B("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),
function(t,w,u,d,q,l,k){function s(a,b,d,m){function f(a,b,c){r.setText(a,b,c);h+=b-c+a.length}var h=0,r=a.editor,k=r.getSelections();!m&&(b||1<k.length)&&a.startUndo();k.forEach(function(a){a.start+=h;a.end+=h;d(a,f)});r.setSelections(k);!m&&(b||1<k.length)&&a.endUndo()}function p(a,b,d){this.editor=a;this.undoStack=b;this._incrementalFind=new q.IncrementalFind(a);this._find=d?d:new l.FindUI(a,b);this._lastEditLocation=null;this.init()}function b(a,b,d,m){this.editor=a;this.undoStack=b;this.contentAssist=
d;this.linkedMode=m;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));this.init()}var a=u.AnnotationType,h={};p.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var b=
1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.undo(),--b;return!0}return!1}.bind(this),{name:t.undo});a.setAction("redo",function(a){if(this.undoStack){var b=1;a&&a.count&&(b=a.count);for(;0<b;)this.undoStack.redo(),--b;return!0}return!1}.bind(this),{name:t.redo});a.setKeyBinding(new w.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:t.find});
a.setKeyBinding(new w.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?(this._find.find(!0,a),!0):!1}.bind(this),{name:t.findNext});a.setKeyBinding(new w.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:t.findPrevious});a.setKeyBinding(new w.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);
return!0}.bind(this),{name:t.incrementalFind});a.setKeyBinding(new w.KeyBinding("j",!0,!0),"incrementalFindReverse");a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:t.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:t.unindentLines});a.setKeyBinding(new w.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",
function(){return this.moveLinesUp()}.bind(this),{name:t.moveLinesUp});a.setKeyBinding(new w.KeyBinding(40,!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:t.moveLinesDown});a.setKeyBinding(new w.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:t.copyLinesUp});a.setKeyBinding(new w.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),
{name:t.copyLinesDown});a.setKeyBinding(new w.KeyBinding("d",!0,!1,!1),"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:t.deleteLines});a.setKeyBinding(new w.KeyBinding("l",!k.isMac,!1,!1,k.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:t.gotoLine});a.setKeyBinding(new w.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:t.nextAnnotation});
a.setKeyBinding(new w.KeyBinding(188,!0),"previousAnnotation");a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:t.prevAnnotation});a.setKeyBinding(new w.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:t.expand});a.setKeyBinding(new w.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:t.collapse});a.setKeyBinding(new w.KeyBinding("e",
!0,!0,!0,!1),"expandAll");a.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:t.expandAll});a.setKeyBinding(new w.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:t.collapseAll});a.setKeyBinding(new w.KeyBinding("q",!k.isMac,!1,!1,k.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:t.lastEdit})},copyLinesDown:function(){var a=this.editor;
if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!1,function(a,c){var f=b.getLineAtOffset(a.start),d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),h=b.getLineStart(f),f=b.getLineEnd(d,!0),k=b.getLineCount(),l="",h=b.getText(h,f);d===k-1&&(h=(l=b.getLineDelimiter())+h);c(h,f,f);a.start=f+l.length;a.end=f+h.length});return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!1,function(a,c){var f=b.getLineAtOffset(a.start),
d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),f=b.getLineStart(f),h=b.getLineEnd(d,!0),k=b.getLineCount(),l="",h=b.getText(f,h);d===k-1&&(h+=l=b.getLineDelimiter());c(h,f,f);a.start=f;a.end=f+h.length-l.length});return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=1;a&&a.count&&(d=a.count);var m=b.getModel();s(this,!1,function(a,b){var c=m.getLineAtOffset(a.start),e=m.getLineStart(c),c=a.start!==a.end||1===d?m.getLineAtOffset(a.end>a.start?
a.end-1:a.end):Math.min(c+d-1,m.getLineCount()-1),c=m.getLineEnd(c,!0);b("",e,c);a.start=a.end=e});return!0},expandAnnotation:function(a){var b=this.editor,d=b.getAnnotationModel();if(!d)return!0;var m=b.getModel(),f=b.getCaretOffset(),h=m.getLineAtOffset(f),f=m.getLineStart(h),h=m.getLineEnd(h,!0);m.getBaseModel&&(f=m.mapOffset(f),h=m.mapOffset(h),m.getBaseModel());for(var r,d=d.getAnnotations(f,h);!r&&d.hasNext();)m=d.next(),m.type===u.AnnotationType.ANNOTATION_FOLDING&&(r=m);r&&a!==r.expanded&&
(a?r.expand():(b.setCaretOffset(r.start),r.collapse()));return!0},expandAnnotations:function(a){var b=this.editor,d=b.getTextView(),b=b.getAnnotationModel();if(!b)return!0;var m=b.getAnnotations();for(d.setRedraw(!1);m.hasNext();)b=m.next(),b.type===u.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse());d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel(),m=
0,f=a.getSelections();1<f.length&&this.startUndo();if(f.some(function(h){h.start+=m;h.end+=m;var r=d.getLineAtOffset(h.start),k=d.getLineAtOffset(h.end>h.start?h.end-1:h.end);if(r!==k||1<f.length){var l=[];l.push("");for(var p=r;p<=k;p++)l.push(d.getLine(p,!0));var p=d.getLineStart(r),q=d.getLineEnd(k,!0),s=b.getOptions("tabSize","expandTab"),s=s.expandTab?Array(s.tabSize+1).join(" "):"\t",l=l.join(s);a.setText(l,p,q);var g=p===h.start?h.start:h.start+s.length,r=h.end+(k-r+1)*s.length;m+=p-q+l.length;
h.start=g;h.end=r}else return!0;return!1}))return!1;a.setSelections(f);1<f.length&&this.endUndo();return!0}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(t.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=
a.getModel();s(this,!0,function(a,c){var f=b.getLineAtOffset(a.start),d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),h=b.getLineCount();if(d!==h-1){var f=b.getLineStart(f),k=b.getLineEnd(d,!0),l=b.getLineEnd(d+1,!0)-(k-f),p=0;d!==h-2?d=b.getText(f,k):(h=b.getLineEnd(d),d=b.getText(h,k)+b.getText(f,h),p+=k-h);c("",f,k);c(d,l,l);a.start=l+p;a.end=l+p+d.length}});return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!0,function(a,
c){var f=b.getLineAtOffset(a.start);if(0!==f){var d=b.getLineAtOffset(a.end>a.start?a.end-1:a.end),h=b.getLineCount(),k=b.getLineStart(f-1),l=b.getLineStart(f),p=b.getLineEnd(d,!0),q=b.getText(l,p),s=0;d===h-1&&(d=b.getLineEnd(f-1),f=b.getLineEnd(f-1,!0),q+=b.getText(d,f),l=d,s=f-d);c("",l,p);c(q,k,k);a.start=k;a.end=k+q.length-s}});return!0},nextAnnotation:function(b){function e(b){return!!b.lineStyle||b.type===a.ANNOTATION_MATCHING_BRACKET||b.type===a.ANNOTATION_CURRENT_BRACKET||!f.isAnnotationTypeVisible(b.type)}
var n=this.editor,m=n.getAnnotationModel();if(!m)return!0;var f=n.getOverviewRuler()||n.getAnnotationStyler();if(!f)return!0;for(var h=n.getModel(),r=n.getCaretOffset(),k=m.getAnnotations(b?r:0,b?h.getCharCount():r),l=null;k.hasNext();){var p=k.next();if(b){if(p.start<=r)continue}else if(p.start>=r)continue;if(!e(p)&&(l=p,b))break}if(l){for(var q=[l],k=m.getAnnotations(l.start,l.start);k.hasNext();)p=k.next(),p!==l&&!e(p)&&q.push(p);var s=n.getTextView(),g=h.getLineAtOffset(l.start),t=d.Tooltip.getTooltip(s);
if(!t)return n.moveSelection(l.start),!0;n.moveSelection(l.start,l.start,function(){t.setTarget({getTooltipInfo:function(){var a=s.convert({x:s.getLocationAtOffset(l.start).x,y:s.getLocationAtOffset(h.getLineStart(g)).y},"document","page");return{contents:q,x:a.x,y:a.y+Math.floor(1.33*s.getLineHeight(g))}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel();s(this,!1,function(a,c){for(var h=
d.getLineAtOffset(a.start),r=d.getLineAtOffset(a.end>a.start?a.end-1:a.end),k=b.getOptions("tabSize"),l=Array(k+1).join(" "),p=[],q=0,s=0,g=h;g<=r;g++){var t=d.getLine(g,!0);if(d.getLineStart(g)!==d.getLineEnd(g))if(0===t.indexOf("\t"))t=t.substring(1),q++;else if(0===t.indexOf(l))t=t.substring(k),q+=k;else return!0;g===h&&(s=q);p.push(t)}h=d.getLineStart(h);k=d.getLineEnd(r,!0);r=d.getLineStart(r);p=p.join("");c(p,h,k);s=h===a.start?a.start:a.start-s;q=Math.max(s,a.end-q+(a.end===r+1&&a.start!==
a.end?1:0));a.start=s;a.end=q});return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};h.TextActions=p;b.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new w.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",
function(){return this.trimTrailingWhitespaces()}.bind(this),{name:t.trimTrailingWhitespaces});a.setKeyBinding(new w.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:t.toggleLineComment});a.setKeyBinding(new w.KeyBinding(191,!0,!k.isMac,!1,k.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:t.addBlockComment});a.setKeyBinding(new w.KeyBinding(220,!0,
!k.isMac,!1,k.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:t.removeBlockComment});a.setKeyBinding(new w.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new w.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));
a.setKeyBinding(new w.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c","\x3e")}.bind(this));a.setKeyBinding(new w.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new w.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",
function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new w.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new w.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new w.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",
function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new w.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new w.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},
autoIndent:function(){function a(b,c){if(b.start===b.end){for(var e=m.getLineAtOffset(b.start),d=m.getLine(e,!1),n=m.getLineStart(e),q=0,s=b.start-n,t;q<s&&(32===(t=d.charCodeAt(q))||9===t);)q++;var n=d.substring(0,q),u=d.substring(0,s),w=d.substring(s),B;if(p.smartIndentation&&123===d.charCodeAt(B=u.trimRight().length-1))return e=s-B-1,w=w.length-w.trimLeft().length,d=125===d.charCodeAt(s+w)?h+n+f+h+n:h+n+f,c(d,b.start-e,b.end+w),b.start=b.end=b.start+h.length+n.length+f.length-e,!0;if(p.autoCompleteComments&&
!l.test(u)&&(r.test(u)||k.test(u))){if(q=r.exec(u)){d=h+n+" * ";d=l.test(w)?d+w.substring(0,w.length-2).trim():d+w.trim();if(m.getLineCount()===e+1||!k.test(m.getLine(e+1)))d+=h+n+" */";c(d,b.start,b.end+w.length);b.start=b.end=b.start+h.length+n.length+3;return!0}if(q=k.exec(u))for(e-=1;0<=e;e--){q=m.getLine(e,!1);if(r.test(q))return l.test(w)||47===d.charCodeAt(s)?(d=h+n+"*"+w,n=b.start+h.length+n.length+1):(d=h+n+"* "+w,n=b.start+h.length+n.length+2),c(d,b.start,b.end+w.length),b.start=b.end=n,
!0;if(!k.test(q))break}}else{if(l.test(u)&&32===n.charCodeAt(n.length-1))return d=h+n.substring(0,n.length-1),c(d,b.start,b.end),b.start=b.end=b.start+d.length,!0;if(0<q){for(q=s;q<d.length&&(32===(t=d.charCodeAt(q++))||9===t);)b.end++;d=m.getLineDelimiter()+n;c(d,b.start,b.end);b.start=b.end=b.start+d.length;return!0}}}return!1}var b=this.editor,d=b.getTextView();if(d.getOptions("readonly")||d.getOptions("singleMode"))return!1;var m=b.getModel(),b=d.getOptions("tabSize","expandTab"),f=b.expandTab?
Array(b.tabSize+1).join(" "):"\t",h=m.getLineDelimiter(),r=/^[\s]*\/\*[\*]*[\s]*$/,k=/^[\s]*\*/,l=/\*\/[\s]*$/,p=this;s(this,!0,function(b,f){a(b,f)||(f(h,b.start,b.end),b.start=b.end=b.start+h.length)});return!0},addBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=/\/\*|\*\//g,m=this;s(this,!1,function(a,c){var h=m._findEnclosingComment(b,a.start,a.end);if(!(void 0!==h.commentStart&&void 0!==h.commentEnd)&&(h=b.getText(a.start,a.end),
0!==h.length)){var k=h.length,h=h.replace(d,""),l=h.length;c("/*"+h+"*/",a.start,a.end);a.start+=2;a.end+=2+(l-k)}});return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var m=/^$|[)}\]>]/,f=d.getModel();s(this,!1,function(d,n){var h=d.start===f.getCharCount()?"":f.getText(d.start,d.start+
1).trim();d.start===d.end&&m.test(h)?(h=a+b,n(h,d.start,d.start),d.start=d.end=d.start+1):d.start!==d.end?(h=a+f.getText(d.start,d.end)+b,n(h,d.start,d.end),d.start+=1,d.end+=1):(n(a,d.start,d.end),d.start=d.end=d.start+a.length)});return!0},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=/^"$|^'$/,m=/\w/,f=/^$|[)}\]>]/,h=b.getModel();s(this,!1,function(b,e){function k(){e(a,b.start,b.end);b.start=b.end=
b.start+a.length}var l=0===b.start?"":h.getText(b.start-1,b.start).trim(),p=b.start===h.getCharCount()?"":h.getText(b.start,b.start+1).trim();b.start!==b.end?(l=h.getText(b.start,b.end),d.test(l)?k():(e(a+l+a,b.start,b.end),b.start+=1,b.end+=1)):p===a?b.start=b.end=b.start+1:l===a||d.test(p)||m.test(l)||!f.test(p)?k():(e(a+a,b.start,b.end),b.start=b.end=b.start+a.length)});return!0},contentAssistProposalApplied:function(a){function b(){return"number"===typeof d.escapePosition?d.escapePosition:a.data.start+
d.proposal.length}var d=a.data.proposal;if(d.positions&&0<d.positions.length&&this.linkedMode){for(var m=[],f=0;f<d.positions.length;++f)m[f]={positions:[{offset:d.positions[f].offset,length:d.positions[f].length}]};this.linkedMode.enterLinkedMode({groups:m,escapePosition:b()})}else d.groups&&0<d.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:d.groups,escapePosition:b()}):"number"===typeof d.escapePosition&&this.editor.getTextView().setCaretOffset(d.escapePosition);return!0},
deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel();s(this,!1,function(a,c){if(a.start===a.end){var f=0===a.start?"":b.getText(a.start-1,a.start),d=a.start===b.getCharCount()?"":b.getText(a.start,a.start+1);("("===f&&")"===d||"["===f&&"]"===d||"{"===f&&"}"===d||"\x3c"===f&&"\x3e"===d||'"'===f&&'"'===d||"'"===f&&"'"===d)&&c("",a.start,a.start+1)}},!0);return!1},_findEnclosingComment:function(a,b,d){var m=a.getLineAtOffset(b),f=a.getLineAtOffset(d),
h,r,k,l,p,q;for(h=m;0<=h&&!(r=a.getLine(h),k=h===m?b-a.getLineStart(m):r.length,l=r.lastIndexOf("/*",k),r=r.lastIndexOf("*/",k),r>l);h--)if(-1!==l){p=a.getLineStart(h)+l;break}for(h=f;h<a.getLineCount()&&!(r=a.getLine(h),k=h===f?d-a.getLineStart(f):0,l=r.indexOf("/*",k),r=r.indexOf("*/",k),-1!==l&&l<r);h++)if(-1!==r){q=a.getLineStart(h)+r;break}return{commentStart:p,commentEnd:q}},lineStart:function(){var a=this.editor.getModel();s(this,!1,function(b){var d=b.getCaret(),m=a.getLineAtOffset(d),f=a.getLineStart(m),
m=a.getLine(m),h;for(h=0;h<m.length;h++){var r=m.charCodeAt(h);if(!(32===r||9===r))break}h+=f;d!==h?b.setCaret(h):b.setCaret(f)});return!0},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=this;s(this,!1,function(a,c){var h=b.getText(a.start,a.end),r,k,l;for(l=0;l<h.length;l++)if("/*"===h.substring(l,l+2)){r=a.start+l;break}for(;l<h.length;l++)if("*/"===h.substring(l,l+2)){k=a.start+l;break}void 0!==r&&void 0!==k?(h=b.getText(r+
2,k),c(h,r,k+2),a.start=r,a.end=k):(r=d._findEnclosingComment(b,a.start,a.end),void 0===r.commentStart||void 0===r.commentEnd||(h=b.getText(r.commentStart+2,r.commentEnd),c(h,r.commentStart,r.commentEnd+2),a.start-=2,a.end-=2))});return!0},toggleLineComment:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;var d=this.lineComment||"//",h=a.getModel();b.setRedraw(!1);s(this,!0,function(a,b){for(var c=h.getLineAtOffset(a.start),e=h.getLineAtOffset(a.end>a.start?a.end-
1:a.end),k=!0,l=[],p,q=c;q<=e;q++){var g=h.getLine(q,!0);p=g.indexOf(d);l.push(p);if(!k||-1===p)k=!1;else if(0!==p){for(k=0;k<p;k++){var s=g.charCodeAt(k);if(!(32===s||9===s))break}k=k===p}}q=d.length;g=h.getLineStart(c);if(k){for(k=l.length-1;0<=k;k--)p=l[k]+h.getLineStart(c+k),b("",p,p+q);p=h.getLineStart(e);l=g===a.start?a.start:a.start-q;c=a.end-q*(e-c+1)+(a.end===p+1?q:0)}else{for(k=l.length-1;0<=k;k--)p=h.getLineStart(c+k),b(d,p,p);l=g===a.start?a.start:a.start+q;c=a.end+q*(e-c+1)}a.start=l;
a.end=c});b.setRedraw(!0);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),d=a.getSelections();a.getTextView().setRedraw(!1);this.startUndo();for(var h=/(\s+$)/,f=b.getLineCount(),k=0;k<f;k++){var r=b.getLine(k);if(r=h.exec(r)){var l=b.getLineStart(k),p=r[0].length,q=l+r.index;b.setText("",q,q+p);d.forEach(function(a){a.start>q&&(a.start=Math.max(q,a.start-p));a.start!==a.end&&a.end>q&&(a.end=Math.max(q,a.end-p))})}}this.endUndo();a.setSelections(d,!1);a.getTextView().setRedraw(!0)},
startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=b.getModel(),h=b.getSelections();return 1===h.length&&h[0].start===h[0].end&&(h[0].start===d.getCharCount()?"":d.getText(h[0].start,h[0].start+1))===a?(h[0].start=h[0].end=h[0].start+1,b.setSelections(h),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=
a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};h.SourceCodeActions=b;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,
"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return h});B("orion/editor/undoStack",[],function(){function t(d,q,l,k,s){this.model=d;this.offset=q;this.text=l;this.previousText=k;this.type=s}function w(d){this.owner=d;this.changes=[]}function u(d,q){this.size=void 0!==q?q:100;this.reset();var l=this;this._listener={onChanging:function(d){l._onChanging(d)},onDestroy:function(d){l._onDestroy(d)}};if(d.getModel){var k=d.getModel();k.getBaseModel&&
(k=k.getBaseModel());this.model=k;this.setView(d)}else this.shared=!0,this.model=d;this.model.addEventListener("Changing",this._listener.onChanging)}t.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(d,q){this._doUndoRedo(this.offset,this.previousText,this.text,d,q);return!0},redo:function(d,q){this._doUndoRedo(this.offset,
this.text,this.previousText,d,q);return!0},merge:function(d,q,l,k,s){if(k===this.type){if(1===k&&d===this.offset+this.text.length)return this.text+=q,!0;if(-1===k&&s===this.offset)return this.offset=d,this.previousText=l+this.previousText,!0;if(-1===k&&d===this.offset)return this.previousText+=l,!0}return!1},_doUndoRedo:function(d,q,l,k,s){this.model.setText(q,d,d+l.length);s&&k&&(l=k.getModel(),l!==this.model&&(d=l.mapOffset(d,!0)),k.setSelection(d,d+q.length))}};w.prototype={getRedoChanges:function(){for(var d=
[],q=0;q<this.changes.length;q++)d=d.concat(this.changes[q].getRedoChanges());return d},getUndoChanges:function(){for(var d=[],q=this.changes.length-1;0<=q;q--)d=d.concat(this.changes[q].getUndoChanges());return d},add:function(d){this.changes.push(d)},end:function(d){d&&(this.endSelection=d.getSelections());(d=this.owner)&&d.end&&d.end()},undo:function(d,q){1<this.changes.length&&d&&d.setRedraw(!1);for(var l=this.changes.length-1;0<=l;l--)this.changes[l].undo(d,!1);q&&d&&d.setSelections(this.startSelection);
1<this.changes.length&&d&&d.setRedraw(!0);(l=this.owner)&&l.undo&&l.undo();return 0<this.changes.length},redo:function(d,q){1<this.changes.length&&d&&d.setRedraw(!1);for(var l=0;l<this.changes.length;l++)this.changes[l].redo(d,!1);q&&d&&d.setSelections(this.endSelection);(1<this.changes.length,d)&&d.setRedraw(!0);(l=this.owner)&&l.redo&&l.redo();return 0<this.changes.length},merge:function(d,q,l,k,s,p){var b=this.changes.length;return 0<b&&this===p?this.changes[b-1].merge(d,q,l,k,s):!1},start:function(d){d&&
(this.startSelection=d.getSelections());(d=this.owner)&&d.start&&d.start()}};u.prototype={destroy:function(){this._onDestroy()},add:function(d){this.compoundChange?this.compoundChange.add(d):(this.stack.splice(this.index,this.stack.length-this.index,d),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-
1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var d=[],q=this.index;q<this.stack.length;q++)d=d.concat(this.stack[q].getRedoChanges());return d},getUndoChanges:function(){this._commitUndo();for(var d=[],q=
this.index;0<=q;q--)d=d.concat(this.stack[q].getUndoChanges());return d},undo:function(){this._commitUndo();var d;d=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;d=this.stack[--this.index]}while(!(d=d.undo(this.view,!0)));this._ignoreUndo=!1;return d},redo:function(){this._commitUndo();var d;d=!1;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;d=this.stack[this.index++]}while(!(d=d.redo(this.view,!0)));this._ignoreUndo=!1;return d},reset:function(){this.index=0;this.cleanChange=void 0;
this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(d){this.view!==d&&(this.view&&d.removeEventListener("Destroy",this._listener.onDestroy),(this.view=d)&&d.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(d){this._commitUndo();d=new w(d);this.add(d);this.compoundChange=d;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(d){(!d||!this.shared)&&this.model.removeEventListener("Changing",
this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_trackUnsavedChanges:function(d){if(this._unsavedChanges){var q=this._unsavedChanges.length,l=d.removedCharCount,k=d.start,s=d.start+l,p=0;0===d.addedCharCount?p=-1:0===l&&(p=1);if(0<q&&p===this._previousChangeType){q=this._unsavedChanges[q-1];if(0===l&&k===q.end+q.text.length){q.text+=d.text;return}if(0===d.addedCharCount&&s===q.start){q.start=k;return}}this._previousChangeType=
p;this._unsavedChanges.push({start:k,end:s,text:d.text})}},_onChanging:function(d){this._trackUnsavedChanges(d);if(!this._ignoreUndo){var q=d.text,l=d.start,k=d.addedCharCount,s=d.removedCharCount;d=l+s;var p=0;0===k&&1===s?p=-1:1===k&&0===s&&(p=1);k=this.stack.length;s=this.model.getText(l,d);(!(0<k&&this.index===k)||!this.stack[k-1].merge(l,q,s,p,d,this.compoundChange))&&this.add(new t(this.model,l,q,s,p))}}};return{UndoStack:u}});B("orion/editor/rulers","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/annotations orion/editor/tooltip orion/objects orion/editor/util orion/util".split(" "),
function(t,w,u,d,q,l,k){function s(a,b,c){this._location=a||"left";this._overview=b||"page";this._rulerStyle=c;this._view=null}function p(a,b,c,f){s.call(this,b,c,f);var d=this;this._listener={onTextModelChanged:function(a){d._onTextModelChanged(a)},onAnnotationModelChanged:function(a){d._onAnnotationModelChanged(a)}};this.setAnnotationModel(a)}function b(a,b,c,f,d){p.call(this,a,b,"page",c);this._oddStyle=f||{style:{backgroundColor:"white"}};this._evenStyle=d||{style:{backgroundColor:"white"}};this._numOfDigits=
0;this._firstLine=1}function a(a,b,c){p.call(this,a,b,"page",c)}function h(a,b,c){p.call(this,a,b,"document",c)}function c(b,c,d){a.call(this,b,c,d)}s.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&
this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}};p.prototype=q.mixin(new s,{getAnnotations:function(a,b){var c=this._annotationModel;if(!c)return[];var f=this._view.getModel(),d=f.getLineStart(a),h=f.getLineEnd(b-1),k=f;f.getBaseModel&&(k=f.getBaseModel(),d=f.mapOffset(d),h=f.mapOffset(h));for(var l=[],c=this.getAnnotationsByType(c,d,h),d=0;d<c.length;d++)for(var h=c[d],p=k.getLineAtOffset(h.start),q=k.getLineAtOffset(Math.max(h.start,h.end-1)),s=p;s<=q;s++){var g=
s;if(f!==k){g=k.getLineStart(s);g=f.mapOffset(g,!0);if(-1===g)continue;g=f.getLineAtOffset(g)}if(a<=g&&g<b){var t=this._mergeAnnotation(l[g],h,s-p,q-p+1);t&&(l[g]=t)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var u in l)l[u]._multiple&&(l[u].html+=this._multiAnnotationOverlay.html);return l},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",
this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=a},onClick:function(a,b){if(void 0!==a){var c=this._view,f=c.getModel(),h=f.getLineStart(a),r=f.getLineEnd(a,!0),k=c.getSelection().start,c=c.getSelection().end,l=this._annotationModel,p,q,s;if(l){f.getBaseModel&&(h=f.mapOffset(h),
r=f.mapOffset(r),k=f.mapOffset(k),c=f.mapOffset(c));var g=this;q=(p=this._findNextAnnotation(l,h,r,k,c,function(a){return g.isAnnotationTypeVisible(a)}))?p.start:h;s=p?p.end:h;f.getBaseModel&&(q=f.mapOffset(q,!0),s=f.mapOffset(s,!0));p&&void 0!==p.groupId&&(this._currentClickGroup=this._currentClickGroup===p.groupId?null:p.groupId,this._setCurrentGroup(a))}this._view.setSelection(s,q,1/3,function(){});(f=d.Tooltip.getTooltip(this._view))&&(p&&"left"===this.getLocation()?f.show({getTooltipInfo:function(){return g._getTooltipInfo([p])}},
!1,!1):f.hide())}},onDblClick:function(a,b){},onMouseMove:function(a,b){var c=d.Tooltip.getTooltip(this._view);if(c&&!(c.isVisible()&&this._tooltipLineIndex===a)&&(this._tooltipLineIndex=a,!(b.clientX===this._lastMouseX&&b.clientY===this._lastMouseY))){this._lastMouseX=b.clientX;this._lastMouseY=b.clientY;this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null);var f=b.target?b.target:b.srcElement;this._curElementBounds=f.getBoundingClientRect();f._ruler&&(this._curElementBounds.top=
b.clientY,this._curElementBounds.height=1);var h=this;h._hoverTimeout=window.setTimeout(function(){h._hoverTimeout=null;c.onHover({getTooltipInfo:function(){var a=h._getAnnotationsAtLineIndex(h._tooltipLineIndex),a=h._getTooltipContents(h._tooltipLineIndex,a);return h._getTooltipInfo(a,b.clientY,{source:"ruler",rulerLocation:h.getLocation()})}},b.clientX,b.clientY)},175)}},onMouseOver:function(a,b){this.onMouseMove(a,b);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(a,b){this._currentClickGroup||
this._setCurrentGroup(-1);this._hoverTimeout&&(window.clearTimeout(this._hoverTimeout),this._hoverTimeout=null)},_findNextAnnotation:function(a,b,c,f,d,h){var k=null,l,p=b;if(0<=f&&0<=d&&f>=b&&f<c)for(var p=f,q=a.getAnnotations(f,d);!l&&q.hasNext();)if(b=q.next(),!h||h(b.type))b.start===f&&b.end===d&&(l=b);a=a.getAnnotations(p,c);for(var s;a.hasNext();)if(b=a.next(),!h||h(b.type)){k||(k=b);if(!l){k=b;break}if(s&&(l.start!==b.start||l.end!==b.end)){s=!1;k=b;break}l&&l===b&&(s=!0)}s&&(k=null);return k},
_getAnnotationsAtLineIndex:function(a){if(void 0!==a){var b=this._view.getModel(),c=this._annotationModel,f=[];c&&(f=b.getLineStart(a),a=b.getLineEnd(a),b.getBaseModel&&(f=b.mapOffset(f),a=b.mapOffset(a)),f=this.getAnnotationsByType(c,f,a));return f}},_getTooltipInfo:function(a,b,c){if(!a)return null;var f=Object.create(null);f.top=this._curElementBounds.top;f.left=this._curElementBounds.left;f.height=this._curElementBounds.height;f.width=this._curElementBounds.width;"string"===typeof a&&b&&(f.top=
b,f.height=1);var d=this.getLocation();b=this.getRulerStyle();var d="left"===d?"right":"left",h=0,k=0,h=this._view._clientDiv.getBoundingClientRect().left-(f.left+f.width),k=f.height;"left"===d&&(h=-25,1===f.height&&(h+=2));0<=b.styleClass.indexOf("folding")&&(k-=14);return{contents:a,position:d,tooltipOffsetX:h,tooltipOffsetY:k,anchorArea:f,context:c}},_getTooltipContents:function(a,b){return b},_getOnClickTooltipInfo:function(a){var b=this._view,c=Object.create(null);c.top=this._curElementBounds.top;
c.left=this._curElementBounds.left;c.height=this._curElementBounds.height;c.width=this._curElementBounds.width;var f="left"===this.getLocation()?"right":"left";a={contents:[a],position:f,anchorArea:c};b=b._clientDiv.getBoundingClientRect();a.offsetX=b.left-(c.left+c.width);a.offsetY=c.height;"left"===a.position&&(a.offsetX=20);return a},_onAnnotationModelChanged:function(a){function b(a){for(var e=0;e<a.length;e++)if(d.isAnnotationTypeVisible(a[e].type)){k=a[e].start;var h=a[e].end;f.getBaseModel&&
(k=f.mapOffset(k,!0),h=f.mapOffset(h,!0));-1!==k&&-1!==h&&c.redrawLines(f.getLineAtOffset(k),f.getLineAtOffset(Math.max(k,h-1))+1,d)}}var c=this._view;if(c){var f=c.getModel(),d=this,h=f.getLineCount();if(a.textModelChangedEvent){var k=a.textModelChangedEvent.start;f.getBaseModel&&(k=f.mapOffset(k,!0));a=f.getLineAtOffset(k);c.redrawLines(a,h,d)}else b(a.added),b(a.removed),b(a.changed)}},_mergeAnnotation:function(a,b,c,f){a||(a={});0===c&&(a.html&&b.html?(b.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&
(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=b.html);a.style=this._mergeStyle(a.style,b.style);return a},_mergeStyle:function(a,b){if(b){a||(a={});a.styleClass=a.styleClass&&b.styleClass&&a.styleClass!==b.styleClass?a.styleClass+(" "+b.styleClass):b.styleClass;var c;if(b.style)for(c in a.style||(a.style={}),b.style)void 0===a.style[c]&&(a.style[c]=b.style[c]);if(b.attributes)for(c in a.attributes||(a.attributes={}),b.attributes)void 0===a.attributes[c]&&(a.attributes[c]=b.attributes[c])}return a},
_setCurrentGroup:function(a){var b=this._annotationModel,c=null,f=b.getTextModel(),d,h=this._currentGroupAnnotation;if(-1!==a){var k=f.getLineStart(a),l=f.getLineEnd(a);f.getBaseModel&&(k=f.mapOffset(k),l=f.mapOffset(l));for(d=b.getAnnotations(k,l);d.hasNext();)if(f=d.next(),this.isAnnotationTypeVisible(f.type)&&f.start<=k&&f.end>=l&&void 0!==f.groupId){c=f;break}if(h&&c&&h.groupId===c.groupId)return}this._currentGroupAnnotation=null;h&&b.removeAnnotations(h.groupType);if(c&&-1!==a){this._currentGroupAnnotation=
c;d=b.getAnnotations();for(a=[];d.hasNext();)f=d.next(),delete f.groupAnnotation,f.groupId===c.groupId&&(f=f.createGroupAnnotation(),a.push(f));b.replaceAnnotations(null,a)}}});u.AnnotationTypeList.addMixin(p.prototype);b.prototype=new p;b.prototype.getAnnotations=function(a,b){for(var c=p.prototype.getAnnotations.call(this,a,b),f=this._view.getModel(),d=a;d<b;d++){var h=d-this._firstLine&1?this._oddStyle:this._evenStyle,k=d;f.getBaseModel&&(k=f.getLineStart(k),k=f.getBaseModel().getLineAtOffset(f.mapOffset(k)));
c[d]||(c[d]={});c[d].html=this._firstLine+k+"";c[d].style||(c[d].style=h)}return c};b.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};b.prototype.setFirstLine=function(a){this._firstLine=void 0!==a?a:1};b.prototype._onTextModelChanged=function(a){var b=a.start;a=this._view.getModel();var c=a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount(),c=(this._firstLine+c-1+"").length;this._numOfDigits!==c&&(this._numOfDigits=
c,b=a.getLineAtOffset(b),this._view.redrawLines(b,a.getLineCount(),this))};a.prototype=new p;h.prototype=new p;h.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};h.prototype._getTooltipContents=function(a,b){if(b&&0===b.length){var c=this._view.getModel(),f=a;c.getBaseModel&&(f=c.getLineStart(f),f=c.getBaseModel().getLineAtOffset(c.mapOffset(f)));return k.formatMessage(t.line,f+1)}return p.prototype._getTooltipContents.call(this,
a,b)};h.prototype._mergeAnnotation=function(a,b,c,f){if(0===c)return a||(a={html:"\x26nbsp;",style:{style:{height:3*f+"px"}}},a.style=this._mergeStyle(a.style,b.overviewStyle)),a};c.prototype=new a;c.prototype.onClick=function(a,b){if(void 0!==a){var c=this._annotationModel;if(c){var f=this._view.getModel(),h=f.getLineStart(a),k=f.getLineEnd(a,!0);f.getBaseModel&&(h=f.mapOffset(h),k=f.mapOffset(k),f=f.getBaseModel());for(var l,c=c.getAnnotations(h,k);!l&&c.hasNext();)k=c.next(),this.isAnnotationTypeVisible(k.type)&&
f.getLineAtOffset(k.start)===f.getLineAtOffset(h)&&(l=k);l&&((f=d.Tooltip.getTooltip(this._view))&&f.hide(),l.expanded?l.collapse():l.expand())}}};c.prototype._getTooltipContents=function(b,c){if(c&&0<c.length){var d=this._view.getModel(),f=d.getLineStart(b);d.getBaseModel&&(f=d.mapOffset(f),d=d.getBaseModel());for(var f=d.getLineAtOffset(f),h=0;h<c.length;h++){var k=c[h];if(this.isAnnotationTypeVisible(k.type)&&d.getLineAtOffset(k.start)===f){if(c[h].expanded)break;return a.prototype._getTooltipContents.call(this,
b,[k])}}}return null};c.prototype._onAnnotationModelChanged=function(b){function c(a){for(k=0;k<a.length;k++)if(h.isAnnotationTypeVisible(a[k].type)){var b=a[k].start;f.getBaseModel&&(b=f.mapOffset(b,!0));-1!==b&&(p=Math.min(p,f.getLineAtOffset(b)))}}if(b.textModelChangedEvent)a.prototype._onAnnotationModelChanged.call(this,b);else{var d=this._view;if(d){var f=d.getModel(),h=this,k,l=f.getLineCount(),p=l;c(b.added);c(b.removed);c(b.changed);b=d.getRulers();for(k=0;k<b.length;k++)d.redrawLines(p,l,
b[k])}}};u=function(a,b){s.call(this,a,"fixed",b)};u.prototype=q.mixin(new s,{setView:function(a){this._destroy();s.prototype.setView.call(this,a);this._create()},_create:function(){function a(b){var c=b.themeClass;c?((c=c.replace("textviewZoom",""))&&(c=" "+c),c="textviewZoom"+c):c="textviewZoom";b.themeClass=c;b.noScroll=!0;b.readonly=!0;return b}function b(){var a=p._metrics.viewPadding,c=p._metrics.viewPadding,f=p.getLineHeight(),d=s.getLineHeight(),h=p.getModel().getLineCount(),f=p._lineHeight?
p._scrollHeight:h*f,d=s._lineHeight?s._scrollHeight:h*d,h=d/f,e=p.getClientArea().height+a.top+a.bottom,c=s.getClientArea().height+c.top+c.bottom;return{zoomFactor:h,documentHeight:f,zoomDocumentHeight:d,clientHeight:e,zoomClientHeight:c,scrollWidth:p._metrics.scrollWidth,windowHeight:e*h,padding:a}}function c(a){a=a||{y:p.getTopPixel()};var f=b();s.setTopPixel(a.y*(f.zoomFactor+(f.windowHeight-f.clientHeight-f.scrollWidth)/f.documentHeight));a=a.y*f.zoomFactor;f=f.clientHeight*f.zoomFactor;x.top=
a;x.bottom=a+f;a=s.convert({y:a},"document","page").y;a-=x.node.getBoundingClientRect().top;u.style.top=a+"px";u.style.height=f-g+"px"}function f(a){a.wrapMode&&!a.wrapOffset&&p._metrics.charWidth?(a=k.createElement(t,"div"),a.style.position="fixed",a.style.left="-1000px",s._clientDiv.appendChild(a),a.innerHTML=Array(Math.ceil(p.getClientArea().width/p._metrics.charWidth)+1).join("a"),a=a.getBoundingClientRect(),a=Math.min(150,Math.ceil(a.right-a.left))+"px"):a="";var b=x.node.style.width;x.node.style.width=
a;return b!==a}function d(a,b,c){c||x.top<=a.y&&a.y<=x.bottom?(x.mouseDown=!0,x.delta=b-u.getBoundingClientRect().top+x.node.getBoundingClientRect().top):(a=s.getOffsetAtLocation(a.x,a.y),p.setSelection(a,a,0.5,function(){}))}function h(a){if(x.mouseDown){var c=b();a=Math.min(c.zoomClientHeight-c.windowHeight,Math.max(0,a-x.delta));p.setTopPixel(a*(c.documentHeight-c.clientHeight)/Math.min(c.zoomDocumentHeight,c.zoomClientHeight-c.windowHeight))}}var p=this.getView();if(p){var q=a(p.getOptions());
q.parent=this.node;var s=this._zoomView=new w.TextView(q);s._clientDiv.contentEditable=!1;s.setModel(p.getModel());var t=p.getOptions("parent").ownerDocument,u=this._windowDiv=k.createElement(t,"div");u.className="rulerZoomWindow";this.node.appendChild(u);var g=parseInt(l.getNodeStyle(u,"border-top-width",0))+parseInt(l.getNodeStyle(u,"border-bottom-width",0)),x=this;p.addEventListener("Scroll",this._scrollListener=function(a){c(a.newValue)});p.addEventListener("Resize",this._resizeListener=function(){f(s.getOptions());
c()});p.addEventListener("Redraw",this._redrawListener=function(a){a.ruler||s.redrawLines(a.startLine,a.endLine)});p.addEventListener("Options",this._optionsListener=function(b){b=a(b.options);s.setOptions(b);f(s.getOptions())});s.addEventListener("LineStyle",this._lineListener=function(a){p.onLineStyle(a)});k.isIOS||k.isAndroid?(u.addEventListener("touchstart",function(a){1===a.touches.length&&(d(a,a.touches[0].clientY,!0),a.preventDefault())}),u.addEventListener("touchend",function(a){0===a.touches.length&&
(x.mouseDown=!1)}),u.addEventListener("touchmove",function(a){1===a.touches.length&&h(a.touches[0].clientY)}),s.addEventListener("TouchStart",function(a){1===a.touchCount&&(d(a,a.event.touches[0].clientY),a.preventDefault())})):(u.style.pointerEvents="none",s.addEventListener("MouseDown",function(a){var b=a.event;(b.which?0===b.button:1===b.button)&&d(a,b.clientY);a.preventDefault()}),s.addEventListener("MouseUp",function(a){x.mouseDown=!1;a.preventDefault()}),s.addEventListener("MouseMove",function(a){h(a.event.clientY);
a.preventDefault()}));(t.defaultView||t.parentWindow).setTimeout(function(){c()},0)}},_destroy:function(){var a=this.getView();a&&(a.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,a.removeEventListener("Resize",this._resizeListener),this._resizeListener=null,a.removeEventListener("Redraw",this._redrawListener),this._redrawListener=null,a.removeEventListener("Options",this._optionsListener),this._optionsListener=null);if(a=this._zoomView)a.removeEventListener("LineStyle",
this._lineListener),a.setModel(null),a.destroy(),this._zoomView=null}});return{BaseRuler:s,Ruler:p,AnnotationRuler:a,LineNumberRuler:b,OverviewRuler:h,FoldingRuler:c,ZoomRuler:u}});B("orion/editor/textDND",["orion/util"],function(t){function w(t,d){this._view=t;this._undoStack=d;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var q=this;this._listener={onDragStart:function(d){q._onDragStart(d)},onDragEnd:function(d){q._onDragEnd(d)},onDragEnter:function(d){q._onDragEnter(d)},onDragOver:function(d){q._onDragOver(d)},
onDrop:function(d){q._onDrop(d)},onDestroy:function(d){q._onDestroy(d)}};t.addEventListener("DragStart",this._listener.onDragStart);t.addEventListener("DragEnd",this._listener.onDragEnd);t.addEventListener("DragEnter",this._listener.onDragEnter);t.addEventListener("DragOver",this._listener.onDragOver);t.addEventListener("Drop",this._listener.onDrop);t.addEventListener("Destroy",this._listener.onDestroy)}w.prototype={destroy:function(){var t=this._view;t&&(t.removeEventListener("DragStart",this._listener.onDragStart),
t.removeEventListener("DragEnd",this._listener.onDragEnd),t.removeEventListener("DragEnter",this._listener.onDragEnter),t.removeEventListener("DragOver",this._listener.onDragOver),t.removeEventListener("Drop",this._listener.onDrop),t.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(t){this.destroy()},_onDragStart:function(t){var d=this._view,q=d.getSelectionText();q&&(this._dragSelection=d.getSelections(),t.event.dataTransfer.effectAllowed="copyMove",t.event.dataTransfer.setData("Text",
q))},_onDragEnd:function(u){if(this._dragSelection){var d=this._view,q=u.event.dataTransfer.dropEffect;if(!t.isFirefox&&("none"!==q||this._dropText))q=u.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(u="move"===q)&&d.setText({text:"",selection:this._dragSelection});if(this._dropText){var q=this._dropText,l=this._dropOffset;u&&this._dragSelection.forEach(function(d){l>=d.end?l-=d.end-d.start:l>=d.start&&(l=d.start)});d.setText(q,l,l);d.setSelection(l,
l+q.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange();this._dragSelection=null}},_onDragEnter:function(t){this._onDragOver(t)},_onDragOver:function(u){var d=u.event.dataTransfer.types,q=!this._view.getOptions("readonly");q&&d&&(q=d.contains?d.contains("text/plain")||d.contains("Text"):-1!==d.indexOf("text/plain")||-1!==d.indexOf("Text"));q?t.isFirefox||(this._dropEffect=u.event.dataTransfer.dropEffect=(t.isMac?u.event.altKey:u.event.ctrlKey)?"copy":
"move"):u.event.dataTransfer.dropEffect="none"},_onDrop:function(u){var d=this._view,q=u.event.dataTransfer.getData("Text");q&&(t.isFirefox||(u.event.dataTransfer.dropEffect=this._dropEffect),u=d.getOffsetAtLocation(u.x,u.y),this._dragSelection?(this._dropOffset=u,this._dropText=q):(d.setText(q,u,u),d.setSelection(u,u+q.length)))}};return{TextDND:w}});B("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/objects orion/util".split(" "),
function(t,w,u,d,q){function l(d){this._data=d}function k(d,b,a){var h=d.getTextView();u.KeyMode.call(this,h);this.editor=d;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;h.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));h.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);return!0}.bind(this));h.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));
h.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),d=this.linkedModeModel,
h,f;d;)if(h=this._getPositionChanged(d,b,b+a.removedCharCount),f=h.position,void 0===f||f.model!==d)this.exitLinkedMode(!1),d=this.linkedModeModel;else break;if(d){d=0;a=a.addedCharCount-a.removedCharCount;h=h.positions;for(var k,r=0;r<h.length;++r){k=h[r];f=k.position;var l=f.offset<=b&&b<=f.offset+f.length;l&&!k.ansestor?(f.offset+=d,f.length+=a,d+=a):(f.offset+=d,k.ansestor&&l&&(f.length+=a));k.escape&&(k.model.escapePosition=f.offset)}this._updateAnnotations(h)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=
this.editor,d=b.mapOffset(a.start),h=this.editor.mapOffset(a.end),f=this.linkedModeModel,k,r;f;)if(k=this._getPositionChanged(f,d,h),r=k.position,void 0===r||r.model!==f)this.exitLinkedMode(!1),f=this.linkedModeModel;else break;if(f){var l=this._compoundChange;l?l.owner.model===f&&l.owner.group===r.group||(this.endUndo(),this.startUndo()):this.startUndo();f.selectedGroupIndex=r.group;var l=0,p=a.text.length-(h-d);k=k.positions;for(var q,d=d-r.position.offset,s=h-r.position.offset,t=0;t<k.length;++t)q=
k[t],h=q.position,q.oldOffset=h.offset,q.model===f&&q.group===r.group?(h.offset+=l,h.length+=p,l+=p):(h.offset+=l,q.ansestor&&(h.length+=r.count*p)),q.escape&&(q.model.escapePosition=h.offset);this.ignoreVerify=!0;for(t=k.length-1;0<=t;t--)q=k[t],q.model===f&&q.group===r.group&&b.setText(a.text,q.oldOffset+d,q.oldOffset+s,!1);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(k)}}}.bind(this)}}var s={};l.prototype={chop:function(d,b){return b.substring(d.length)},computeProposals:function(d,
b,a){b=a.prefix;d=[];a=(a=this._data.style?this._data.style:null)?a:"emphasis";for(var h=this._data.values,c=0;c<h.length;c++){var e=h[c];"string"===typeof e&&0===e.indexOf(b)?d.push({proposal:this.chop(b,e),description:e,hover:e,style:a}):"object"===typeof e&&e.proposal&&d.push({proposal:this.chop(b,e.proposal),description:e.description?e.description:e.proposal,hover:e.hover?e.hover:e.proposal,style:a})}b=this._data.title?this._data.title:null;0<d.length&&d.splice(0,0,{proposal:"",description:b?
b:"Options",style:"noemphasis_title",unselectable:!0});return d}};k.prototype=new u.KeyMode;q.mixin(k.prototype,{createKeyBindings:function(){var d=w.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new d(13)});b.push({actionID:"linkedModeCancel",keyBinding:new d(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new d(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new d(9,!1,!0)});return b},enterLinkedMode:function(d){if(!this.linkedModeModel){var b=this.editor.getTextView();
b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(t.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(d.previousModel=this.linkedModeModel,d.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=d);this.linkedModeModel=d;this.selectLinkedGroup(0)},
exitLinkedMode:function(d){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,h=a.getTextView();h.removeKeyMode(this);h.removeEventListener("Verify",this.linkedModeListener.onVerify);h.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);
h=this.contentAssist;h.removeEventListener("Activating",this.linkedModeListener.onActivating);h.offset=void 0;this.editor.reportStatus(t.linkedModeExited,null,!0);d&&"number"===typeof b.escapePosition&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var d=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){d._compoundChange=null}})}},endUndo:function(){this.undoStack&&
this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(d){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=d;d=b.groups[d];var a=d.positions[0],h=this.editor;h.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)b.offset=void 0,d.data&&"link"===d.data.type&&d.data.values?((this._groupContentAssistProvider=new l(d.data)).getPrefix=function(){var b=h.getSelection();return b.start===
b.end&&(b=h.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?h.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(d,b,a){for(var h=b.groups,c=0;c<h.length;c++)for(var e=h[c].positions,n=0;n<e.length;n++){var m=e[n];a&&(m={offset:m.offset+a,length:m.length});m={index:n,group:c,count:e.length,model:b,position:m};d.push(m);b.nextModel&&
b.nextModel.parentGroup===c&&(m.ansestor=!0,this._getModelPositions(d,b.nextModel,(a||0)+e[n].offset-e[0].offset))}},_getSortedPositions:function(d){var b=this._sortedPositions;if(!b){for(b=[];d.previousModel;)d=d.previousModel;for(this._getModelPositions(b,d);d;)"number"===typeof d.escapePosition&&b.push({escape:!0,model:d,position:{offset:d.escapePosition,length:0}}),d=d.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=b}return b},_getPositionChanged:function(d,
b,a){var h;d=this._getSortedPositions(d);for(var c=d.length-1;0<=c;c--)if(!d[c].escape){var e=d[c].position;if(e.offset<=b&&a<=e.offset+e.length){h=d[c];break}}return{position:h,positions:d}},_updateAnnotations:function(k){var b=this.editor.getAnnotationModel();if(b){for(var a=[],h=[],c=b.getAnnotations(),e;c.hasNext();)switch(e=c.next(),e.type){case d.AnnotationType.ANNOTATION_LINKED_GROUP:case d.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case d.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(e)}if(c=
this.linkedModeModel){k=k||this._getSortedPositions(c);for(var n=0;n<k.length;n++)if(e=k[n],e.model===c&&!e.escape){var m=d.AnnotationType.ANNOTATION_LINKED_GROUP;e.group===c.selectedGroupIndex&&(m=0===e.index?d.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:d.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);e=e.position;e=d.AnnotationType.createAnnotation(m,e.offset,e.offset+e.length,"");h.push(e)}}b.replaceAnnotations(a,h)}}});s.LinkedMode=k;return s});B("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode orion/util".split(" "),
function(t,w,u,d,q,l,k){function s(){}function p(){}function b(){}function a(){}function h(){}function c(){}function e(){}var n={};s.prototype={createKeyBindings:function(a,b,c,d){d=new t.TextActions(a,b,d);var h=new l.LinkedMode(a,b,c);a=new t.SourceCodeActions(a,b,c,h);return{textActions:d,linkedMode:h,sourceCodeActions:a}}};n.KeyBindingsFactory=s;p.prototype={createUndoStack:function(a){a=a.getTextView();return new w.UndoStack(a,200)}};n.UndoFactory=p;b.prototype={createLineNumberRuler:function(a){return new u.LineNumberRuler(a,
"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};n.LineNumberRulerFactory=b;a.prototype={createFoldingRuler:function(a){return new u.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};n.FoldingRulerFactory=a;h.prototype={createZoomRuler:function(a){return new u.ZoomRuler(k.isIOS||k.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}};n.ZoomRulerFactory=h;c.prototype={createAnnotationModel:function(a){return new d.AnnotationModel(a)},createAnnotationStyler:function(a,
b){return new d.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new u.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new u.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};n.AnnotationFactory=c;e.prototype={createTextDND:function(a,b){return new q.TextDND(a.getTextView(),b)}};n.TextDNDFactory=e;return n});B("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],
function(t,w,u,d){return d.mixin({},t,w,u)});B("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/tooltip orion/editor/util orion/util orion/webui/littlelib orion/metrics".split(" "),function(t,w,u,d,q,l,k,s,p,b,a){function h(a){this.textView=a;this.state=n.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=
a)&&this._updateFilterText(a)}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,a)?this.setState(n.INACTIVE):this.isActive()&&(this.state===n.ACTIVE&&this.setState(n.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(n.INACTIVE)}.bind(this)};a.setKeyBinding(p.isMac?new w.KeyBinding(" ",!1,!1,!1,!0):new w.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(p.isMac?new w.KeyBinding(" ",!1,!1,
!0,!0):new w.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();return!0},{name:t.contentAssist})}function c(a,b){var c=a.textView;u.KeyMode.call(this,c);this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;if(0===d.proposals.length)d.selectedIndex=-1,d.cancel();else{for(d.selectedIndex=0;d.proposals[d.selectedIndex]&&d.proposals[d.selectedIndex].unselectable;)d.selectedIndex++;
if(d.proposals[d.selectedIndex]){if(d.widget){var b=!0;if(a.autoApply){for(a=d.selectedIndex+1;d.proposals[a]&&d.proposals[a].unselectable;)a++;d.proposals[a]||(b=!1,d.contentAssist.apply(d.proposals[d.selectedIndex]))}b&&(d.widget.show(),d.widget.selectNode(d.selectedIndex))}}else d.selectedIndex=-1,d.cancel()}});c.setAction("contentAssistApply",function(){return this.enter()}.bind(this));c.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));c.setAction("contentAssistNextProposal",
function(){return this.lineDown()}.bind(this));c.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this));c.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));c.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));c.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));c.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-
1)}.bind(this));c.setAction("contentAssistTab",function(){return this.tab()}.bind(this));this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function e(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var c=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?c.getElementById(b):b;if(!this.parentNode){this.parentNode=p.createElement(c,"div");this.parentNode.className=
"contentassist";var d=c.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);else throw Error("parentNode is required");}s.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var h=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==h.parentNode&&h.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){h.hide()});this.scrollListener=function(a){h.isShowing&&h.position()};s.addEventListener(c,
"scroll",this.scrollListener)}var n={INACTIVE:1,ACTIVE:2,FILTERING:3},m={selected:"selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};h.prototype={apply:function(b){if(!b)return!1;var c=this.textView,d=c.getSelection(),h=this._initialCaretOffset,e=h,k=d=Math.max(d.start,d.end),m=
c.getModel();m.getBaseModel&&(e=m.mapOffset(e),k=m.mapOffset(k),m=m.getBaseModel());b.overwrite&&(h="string"===typeof b.prefix?e-b.prefix.length:this.getPrefixStart(m,e));e={proposal:b,start:e,end:k};this.setState(n.INACTIVE);c.setText("string"===typeof b?b:b.proposal,h,d);if(b.additionalEdits)for(d=0;d<b.additionalEdits.length;d++)h=b.additionalEdits[d],c.setText(h.text,h.offset,h.offset+h.length);this.dispatchEvent({type:"ProposalApplied",data:e});a.logEvent("contentAssist","apply");return!0},activate:function(b,
c){this.state===n.INACTIVE&&(a.logEvent("contentAssist","activate",void 0,c?0:1),this._autoTriggered=c?!0:!1,this.setState(n.ACTIVE,b))},deactivate:function(){this.setState(n.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===n.ACTIVE||this.state===n.FILTERING},isDeactivatingChange:function(a,b){var c=!1;(Array.isArray(b.newValue)?b.newValue:[b.newValue])[0].start<this._initialCaretOffset||!a?c=!0:a&&(c=0<a.removedLineCount||0<a.addedLineCount);return c},
setState:function(a,b){var c;a===n.ACTIVE?(c="Activating",this._mode&&this._mode.setActive(!0)):a===n.INACTIVE&&(c="Deactivating",this._mode&&this._mode.setActive(!1));c&&this.dispatchEvent({type:c,providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===n.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):a===n.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},
computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&
this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var c=b;0<c&&/[A-Za-z0-9_]/.test(a.getText(c-1,c));)c--;return c},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=this._providers,c=this.textView,d=c.getSelection(),h=c.getModel(),
e=a;h.getBaseModel&&(e=h.mapOffset(e),d.start=h.mapOffset(d.start),d.end=h.mapOffset(d.end),h=h.getBaseModel());a=h.getLine(h.getLineAtOffset(e));for(var m=0;m<a.length&&/\s/.test(a.charAt(m));)m++;var m=a.substring(0,m),c=c.getOptions("tabSize","expandTab"),c=c.expandTab?Array(c.tabSize+1).join(" "):"\t",k={line:a,offset:e,prefix:h.getText(this.getPrefixStart(h,e),e),selection:d,delimiter:h.getLineDelimiter(),tab:c,indentation:m},g=this,b=b.map(function(a){a=a.provider;var b;try{var c,d;if(c=a.computeContentAssist){var f=
g.editorContextProvider,m=f.getEditorContext();k=l.mixin(k,f.getOptions());d=c.apply(a,[m,k])}else if(c=a.getProposals||a.computeProposals)d=c.apply(a,[h.getText(),e,k]);b=g.progress?g.progress.progress(d,"Generating content assist proposal"):d}catch(n){return(new q).reject(n)}return q.when(b)});return q.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&(this._latestModelChangingEvent||a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,
this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),c=b,d=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;c="string"===typeof a.prefix?a.prefix:b;if(m[a.style]===m.hr||m[a.style]===m.noemphasis_title)return!0;var d="";if(a.overwrite){if(a.name)d=a.name;else if(a.proposal)d=a.proposal;else return!1;return 0===d.indexOf(c+this._filterText)}return a.name||a.proposal?(d=!1,a.name&&(d=0===a.name.indexOf(c+this._filterText)),
!d&&a.proposal&&(d=0===a.proposal.indexOf(this._filterText)),d):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&d.push(a))},this);a=[];d&&(d=this._removeExtraUnselectableElements(d),a=this._flatten(d));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,c){var d=!0;if(m[b.style]===m.hr)0===c||a.length-1===c?d=!1:m.hr===m[a[c-1].style]&&(d=!1);else if(m[b.style]===
m.noemphasis_title){var f=a[c+1];f?m[f.style]===m.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=this;this.setProviderInfoArray(a.map(function(a){return a.id?a:{provider:a,id:b._generateProviderId()}}))},
setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,b){var c=
a,d=null;b&&Array.isArray(b)&&(d=b.filter(function(a){return a}));if(d&&Array.isArray(d)&&0<d.length){var c=d,f=a,h=d[0].style;h&&(m[h]&&0===m[h].indexOf(m.noemphasis))&&(c=a,f=d);0<c.length&&(d=c[c.length-1].style)&&m.hr!==m[d]&&(c=c.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));c=c.concat(f)}return c},[])},_triggerListener:function(){var a=this.textView.getCaretOffset(),b=null,c=[];if(this._charTriggersInstalled){var d=this.textView.getText(a-
1,a);this._providers.forEach(function(h){var e=h.charTriggers;if(e&&e.test(d)){var e=!1,m=h.excludedStyles;this._styleAccessor&&m&&(b||(b=this._styleAccessor.getStyles(a-1)),e=b.some(function(a){return m.test(a.style)}));e||c.push(h)}},this);0<c.length&&this.activate(c,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",
this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),
this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,
this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};d.EventTarget.addMixin(h.prototype);c.prototype=new u.KeyMode;l.mixin(c.prototype,{createKeyBindings:function(){var a=w.KeyBinding,c=[];c.push({actionID:"contentAssistApply",keyBinding:new a(13)});c.push({actionID:"contentAssistCancel",keyBinding:new a(27)});c.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});c.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});c.push({actionID:"contentAssistNextPage",
keyBinding:new a(34)});c.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});c.push({actionID:"contentAssistHome",keyBinding:new a(b.KEY.HOME)});c.push({actionID:"contentAssistEnd",keyBinding:new a(b.KEY.END)});c.push({actionID:"contentAssistTab",keyBinding:new a(9)});return c},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},
setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,c){if(c){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var d=a;this.proposals[a]&&this.proposals[a].unselectable;){if(c){if(a++,
a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===d){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);this._showTooltip(!0);return!0},_showTooltip:function(a){var b=k.Tooltip.getTooltip(this.contentAssist.textView),c=this,d={getTooltipInfo:function(){var a=c.widget.parentNode.getBoundingClientRect(),b={width:350,height:a.height,top:a.top};a.left+a.width>=document.documentElement.clientWidth?(b.left=a.left-b.width,b.left-=
10):(b.left=a.left+a.width,b.left+=10);return{context:{proposal:c.proposals[c.selectedIndex]},anchorArea:a,tooltipArea:b}}};a?b.update(d):b.show(d,!0,!1)},_hideTooltip:function(){k.Tooltip.getTooltip(this.contentAssist.textView).hide()},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=
this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});e.prototype={onClick:function(a){a||(a=window.event);this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&
!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(m.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,c){var d=b.ownerDocument,h=p.createElement(d,"div");h.id="contentoption"+c;h.setAttribute("role","option");h.className=m[a.style]?m[a.style]:m.dfault;"hr"===a.style?a=p.createElement(d,"hr"):(a=this._createDisplayNode(h,a,c),h.contentAssistProposalIndex=c);h.appendChild(a);b.appendChild(h)},createAccessible:function(){var a=this._contentAssistMode,
c=this;s.addEventListener(this.parentNode,"keydown",function(d){d||(d=window.event);d.preventDefault&&d.preventDefault();return d.keyCode===b.KEY.ESCAPE?a.cancel():d.keyCode===b.KEY.UP?a.lineUp():d.keyCode===b.KEY.DOWN?a.lineDown():d.keyCode===b.KEY.ENTER?a.enter():d.keyCode===b.KEY.PAGEDOWN?a.pageDown():d.keyCode===b.KEY.PAGEUP?a.pageUp():d.keyCode===b.KEY.HOME?(c.scrollIndex(0,!0),a.lineDown(0)):d.keyCode===b.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,c){var d=
a=null;if("string"===typeof b)d=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var h=this._createNameNode(b.name);h.contentAssistProposalIndex=c;a=document.createElement("span");a.appendChild(h);b=document.createTextNode(b.description);a.appendChild(b)}else d=b.description;else d=b.proposal;d&&(a=this._createNameNode(d));a.contentAssistProposalIndex=c;return a},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");
b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var c=a[b];if(c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,
b-1)}return a.length-1},scrollIndex:function(a,b){var c=this.parentNode.childNodes[a];c&&(c.scrollIntoView(b),this.preserveCloneThroughScroll=!0)},selectNode:function(a){var b=null;this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null);this._fadeTimer&&(window.clearTimeout(this._fadeTimer),this._fadeTimer=null);this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(m.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode());
if(-1!==a&&(b=this.parentNode.childNodes[a])){b.classList.add(m.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var c=(b.firstChild||b).getBoundingClientRect(),d=this.parentNode.clientWidth?this.parentNode.clientWidth:this.parentNode.getBoundingClientRect();
a=window.getComputedStyle(this.parentNode);var h=window.getComputedStyle(b),h=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(h.paddingLeft)+parseInt(h.paddingRight);if(c.width>=d-h){h=parseInt(a.top);d=b.cloneNode(!0);d.classList.add("cloneProposal");d.style.top=h+b.offsetTop-this.parentNode.scrollTop+"px";d.style.left=a.left;d.setAttribute("id",d.id+"_clone");c=c.left+c.width-parseInt(document.documentElement.clientWidth);0<c&&(a=parseInt(a.left)-c,0>a&&(a=0),d.style.left=a+"px");var e=
document.createElement("div");e.id="clone_contentassist";e.classList.add("contentassist");e.classList.add("cloneWrapper");e.appendChild(d);e.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(e,this.parentNode);var k=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++)k(a.childNodes[c])};k(e);var n=this;this._hideTimeout=window.setTimeout(function(){n._hideTimeout=null;b.classList.add(m.selected);var a=
1;n._fadeTimer=window.setInterval(function(){!n.previousCloneNode||0.01>=a?(n._removeCloneNode(),window.clearInterval(n._fadeTimer),n._fadeTimer=null):(e.style.opacity=a,e.style.filter="alpha(opacity\x3d"+100*a+")",a-=0.1*a)},50)},1500);b.classList.remove(m.selected);this.previousCloneNode=e}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML=
"";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this._contentAssistMode._showTooltip(!1);this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display="none";this.parentNode.onclick=null;this.isShowing=
!1;this._contentAssistMode._hideTooltip();this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,c=b.getModel();c.getBaseModel&&(a=c.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);
a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;c=this.parentNode.ownerDocument;b=c.documentElement.clientWidth;c=c.documentElement.clientHeight-a.y;if(this.parentNode.offsetHeight>c){var d=a.y-this.textView.getLineHeight();this.parentNode.offsetHeight>d?c>d?this.parentNode.style.maxHeight=c+"px":(this.parentNode.style.maxHeight=
d+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=d+"px")}else this.parentNode.style.maxHeight=c+"px";a.x+this.parentNode.offsetWidth>b?(a=b-this.parentNode.offsetWidth,0>a&&(a=0),this.parentNode.style.left=a+"px",this.parentNode.style.maxWidth=b-a):this.parentNode.style.maxWidth=b+a.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);
this.previousCloneNode=null}};return{ContentAssist:h,ContentAssistMode:c,ContentAssistWidget:e}});B("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget","orion/metrics"],function(t,w,u){function d(b,a,d){this._patternManager=new q(b,a);this._contentType=d}function q(b,a){this._unnamedCounter=0;this._patterns=[];this._rootId=a;b.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function l(b,a,d,c,e,
k,m){this.start=b.start;this.end=b.end;this.contentStart=b.contentStart;this.contentEnd=b.contentEnd;this.name=a;this.typeId=d;this.styler=c;this.parent=k;m&&m(this);this._subBlocks=c.computeBlocks(e,e.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function k(b){this._styler=b}function s(b,a,d){this._highlightCaretLine=this._whitespacesVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._annotationProviders=[];this._view=b;this._annotationModel=a;this._stylerAdapter=
d;this._stylerAdapter.setStyler(this);this._accessor=new k(this);this._bracketAnnotations;var c=this;this._listener={onChanged:function(a){c._onModelChanged(a)},onDestroy:function(a){c._onDestroy(a)},onLineStyle:function(a){c._onLineStyle(a)},onMouseDown:function(a){c._onMouseDown(a)},onSelection:function(a){c._onSelection(a)}};var e=b.getModel();e.getBaseModel&&(e=e.getBaseModel());e.addEventListener("Changed",this._listener.onChanged);b.addEventListener("MouseDown",this._listener.onMouseDown);b.addEventListener("Selection",
this._listener.onSelection);b.addEventListener("Destroy",this._listener.onDestroy);b.addEventListener("LineStyle",this._listener.onLineStyle);var n=e.getCharCount(),m={start:0,contentStart:0,end:n,contentEnd:n};if(5E4<=n)var f=(new Date).getTime();this._rootBlock=this._stylerAdapter.createBlock(m,this,e,null);f&&(m=(new Date).getTime()-f,10<m&&u.logTiming("editor","styler compute blocks (ms/50000 chars)",5E4*m/n,d.getContentType()));a&&(d=[],a.removeAnnotations(t.AnnotationType.ANNOTATION_FOLDING),
this._computeFolding(this._rootBlock.getBlocks(),b.getModel(),d),this._detectTasks&&(a.removeAnnotations(t.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,e,d)),a.replaceAnnotations([],d));b.redrawLines()}var p=function(b,a,d,c,e){var k;void 0===c&&(c=-1);void 0===e&&(e=b.length);for(;1<e-c;)if(k=Math.floor((e+c)/2),a<=b[k].start)e=k;else if(d&&a<b[k].end){e=k;break}else c=k;return e};d.prototype={blockSpansBeyondEnd:function(b){return b.pattern.regexEnd===this._eolRegex},computeBlocks:function(b,
a,d,c,e,k,m){if(!a)return[];var f=[],l=[],r;e=e||0;k=k||Infinity;m=m||Infinity;d.blockPatterns.forEach(function(b){(r=this._findMatch(b.regexBegin||b.regex,a,e))&&l.push({result:r,pattern:b})}.bind(this));if(!l.length)return f;l.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var p=0;0<l.length;){var q=l[0];l.splice(0,1);if(k<q.result.index)break;if(!(q.result.index<p)){var p=c+q.result.index,s=q.result.index,
t=null,u=q.pattern.regexEnd;if(u){var s=s+q.result[0].length,g=q.pattern,x=this._substituteCaptureValues(u,q.result);x!==u&&(g={pattern:g.pattern,regexBegin:g.regexBegin,regexEnd:x},u=x);for(x=s;!t;){r=this._findMatch(u,a,x);r||(this._eolRegex.lastIndex=0,r=this._eolRegex.exec(a),g={pattern:g.pattern,regexBegin:g.regexBegin,regexEnd:this._eolRegex});var x=this.createBlock({start:p,end:c+r.index+r[0].length,contentStart:c+s,contentEnd:c+r.index},d.styler,b,d,g),w=x.getBlocks();if(!w.length||w[w.length-
1].end<=r.index+c)t=x;x=r.index+r[0].length}}else t=this.createBlock({start:p,end:p+q.result[0].length,contentStart:p,contentEnd:p+q.result[0].length},d.styler,b,d,q.pattern);f.push(t);if(f.length===m||k<=t.end)break;p=t.end-c}this._updateMatch(q,a,l,p,k)}return f},computeStyle:function(b,a,d){if(!b.pattern)return null;var c={start:b.start,end:b.end,style:b.pattern.pattern.name};if(b.contentStart<=d&&d<b.contentEnd)return b.pattern.pattern.contentName?{start:b.contentStart,end:b.contentEnd,style:b.pattern.pattern.contentName}:
c;var e,k;if(d<b.contentStart){k=b.pattern.pattern.beginCaptures||b.pattern.pattern.captures;if(!k)return c;e=b.pattern.regexBegin;a=a.getText(b.start,b.contentStart);b=b.start}else{k=b.pattern.pattern.endCaptures||b.pattern.pattern.captures;if(!k)return c;e=b.pattern.regexEnd;a=a.getText(b.contentEnd,b.end);b=b.contentEnd}e.lastIndex=0;if(e=e.exec(a))if(a=[],this._getCaptureStyles(e,k,b,a),(k=a[p(a,d,!0)])&&k.start<=d&&d<k.end)return k;return c},createBlock:function(b,a,d,c,e){return new l(b,e?e.pattern.name:
null,e?e.pattern.id:null,a,d,c,function(a){a.pattern=e;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,a)}.bind(this))},getBlockContentStyleName:function(b){return b.pattern.pattern.contentName||b.pattern.pattern.name},getBlockEndStyle:function(b,a,d,c){var e;if(b.pattern.regexEnd&&(e=this._findMatch(b.pattern.regexEnd,a,0)))(a=b.pattern.pattern.endCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(e,a,d-e[0].length,c):b.pattern.pattern.name&&
c.push({start:d-e[0].length,end:d,style:b.pattern.pattern.name});return e?e[0]:null},getBlockFoldBounds:function(b,a){return{start:b.start,end:b.end}},getBlockStartStyle:function(b,a,d,c){var e;if(b.pattern.regexBegin&&(e=this._findMatch(b.pattern.regexBegin,a,0)))(a=b.pattern.pattern.beginCaptures||b.pattern.pattern.captures)?this._getCaptureStyles(e,a,d,c):c.push({start:d,end:d+e[0].length,style:b.pattern.pattern.name});return e?e[0]:null},getBracketMatch:function(b,a){for(var d,c=Object.keys(b.enclosurePatterns),
e=0;e<c.length;e++){var k=b.enclosurePatterns[c[e]],m=this._findMatch(k.regex,a,0);if(m&&0===m.index){d=k;break}}if(!d)return null;e=!1;-1!==d.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(e=!0,c=d.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):c=d.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);return!b.enclosurePatterns[c]?null:{beginName:d.pattern.name,endName:c,atStart:e}},getContentType:function(){return this._contentType},
parse:function(b,a,d,c,e,k){if(b&&(c=c.linePatterns)){var m=[],f;c.forEach(function(a){var c=a.regex||a.regexBegin;c.oldLastIndex=c.lastIndex;(f=this._findMatch(c,b,d))&&m.push({result:f,pattern:a})}.bind(this));m.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var l=d;0<m.length;){var p=m[0];m.splice(0,1);if(!(p.result.index<l)){var q=p.result.index,s,l=[];if(p.pattern.regex){f=p.result;s=q+f[0].length;
s={start:a+q,end:a+s,style:p.pattern.pattern.name};if(!k){p.pattern.pattern.captures&&this._getCaptureStyles(f,p.pattern.pattern.captures,a+q,l);l.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(q=0;q<l.length-1;q++)if(l[q+1].start<l[q].end){var t={start:l[q+1].end,end:l[q].end,style:l[q].style};l[q].end=l[q+1].start;l.splice(q+2,0,t)}}this._mergeStyles(s,l,e)}else l=p.pattern.regexEnd,l=this._substituteCaptureValues(l,p.result),f=this._findMatch(l,b,p.result.index+p.result[0].length),
f||(this._eolRegex.lastIndex=0,f=this._eolRegex.exec(b)),s=f.index+f[0].length,e.push({start:a+q,end:a+s,style:p.pattern.pattern.name});l=f.index+f[0].length}this._updateMatch(p,b,m,l)}c.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(b){},verifyBlock:function(b,a,d,c){var e=null,k=[],m;d.parent.blockPatterns.forEach(function(b){(m=this._findMatch(b.regexBegin||b.regex,a,0))&&k.push({result:m,pattern:b})}.bind(this));k.sort(function(a,b){return!a.result.index&&
b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!k.length||0!==k[0].result.index||k[0].pattern.pattern.id!==d.pattern.pattern.id)e=!1;else{m=k[0];var f=m.pattern.regexEnd;if(f){for(var f=this._substituteCaptureValues(f,m.result),l=m.result[0].length,p=this._findMatch(f,a,l);null===e&&p&&d.start+p.index!==d.contentEnd+c;){var q=this.computeBlocks(b,a,d,d.start,l,p.index+1,null);!q.length||q[q.length-1].end<=
d.start+p.index?e=!1:q.length?(l=q[q.length-1].end-d.start,p=this._findMatch(f,a,l)):p=null}p||(this._eolRegex.lastIndex=0,p=this._eolRegex.exec(a),e=d.start+p.index===d.end+c)}else e=d.start+m.result[0].length===d.end+c}return null!==e?e:!0},_findMatch:function(b,a,d,c){var e=d,k=b.lastIndex;this._linebreakRegex.lastIndex=d;d=this._linebreakRegex.exec(a);var m,f;b.lastIndex=0;if(d){for(f=d.index;0<=--f&&!(m=a.charAt(f),m===this._NEWLINE||m===this._CR););m=a.substring(f+1,d.index+d[1].length);b.lastIndex=
f=d.index-f-1}for(;d&&d.index<a.length;){var l;if(c){var p=b.lastIndex;b.test(m)&&(b.lastIndex=p,l=b.exec(m))}else l=b.exec(m);if(l)return l.index+=e,l.index-=f,b.lastIndex=k,l;f=0;e+=d[0].length;if(d=this._linebreakRegex.exec(a))m=d[1],b.lastIndex=0}b.lastIndex=k;return null},_getCaptureStyles:function(b,a,d,c){if(a[0])c.push({start:d,end:d+b[0].length,style:a[0].name});else for(var e=0,k=1;k<b.length;k++)if(b[k]){var m=a[k];if(m){var f=d+e;c.push({start:f,end:f+b[k].length,style:m.name})}e+=b[k].length}},
_initPatterns:function(b,a){if(a.pattern&&a.pattern.pattern.linePatterns)a.linePatterns=a.pattern.pattern.linePatterns,a.blockPatterns=a.pattern.pattern.blockPatterns,a.enclosurePatterns=a.pattern.pattern.enclosurePatterns;else{var d=b.getPatterns(a.pattern?a.pattern.pattern:null),c=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),c=this._FLAGS;b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,c)}.bind(this),e=-1,k=0;d.forEach(function(b){var d;if(b.match&&!b.begin&&
!b.end){if(d={regex:c(b.match),pattern:b},a.linePatterns.push(d),b.name&&0===b.name.indexOf("punctuation.section")&&(-1!==b.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||-1!==b.name.indexOf(this._PUNCTUATION_SECTION_END)))a.enclosurePatterns[b.name]=d}else!b.match&&(b.begin&&b.end)&&(e=k,d={regexBegin:c(b.begin),regexEnd:c(b.end),pattern:b},a.linePatterns.push(d));k++}.bind(this));a.blockPatterns=a.linePatterns.slice(0,e+1);a.pattern&&(a.pattern.pattern.enclosurePatterns=a.enclosurePatterns,a.pattern.pattern.linePatterns=
a.linePatterns,a.pattern.pattern.blockPatterns=a.blockPatterns)}},_mergeStyles:function(b,a,d){var c=b.start;a.forEach(function(a){c<=a.start&&d.push({start:c,end:a.start,style:b.style});d.push(a);c=a.end});c<b.end&&d.push({start:c,end:b.end,style:b.style})},_substituteCaptureValues:function(b,a){var d=b.toString();this._captureReferenceRegex.lastIndex=0;if(!this._captureReferenceRegex.test(d))return b;this._captureReferenceRegex.lastIndex=0;for(var c=this._captureReferenceRegex.exec(d);c;)d=d.replace(c[0],
a[c[1]]||""),this._captureReferenceRegex.lastIndex=0,c=this._captureReferenceRegex.exec(d);return RegExp(d.substring(1,d.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(b,a,d,c,e){var k=b.pattern.regex?b.pattern.regex:b.pattern.regexBegin;e=e||Infinity;if((a=this._findMatch(k,a,c,!0))&&a.index<e){b.result=a;for(e=0;e<d.length;e++)if(a.index<d[e].result.index||a.index===d[e].result.index&&b.pattern.pattern.index<d[e].pattern.pattern.index){d.splice(e,0,b);return}d.push(b)}},_captureReferenceRegex:/\\(\d)/g,
_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"};q.prototype={getPatterns:function(b){b?(b="string"===typeof b?b:b.qualifiedId,b+="#"):b=this._rootId+"#"+this._NO_ID;var a=[0],d={},c=RegExp("^"+b+"[^#]+$");this._patterns.forEach(function(b){if(c.test(b.qualifiedId))if(b.include)this._processInclude(b,a,d);else{var e=JSON.parse(JSON.stringify(b));e.index=a[0]++;d[b.qualifiedId]=
e}}.bind(this));var e=[];Object.keys(d).forEach(function(a){e.push(d[a])});return e},_addPattern:function(b,a,d){b.parentId=d;b.id=a;b.qualifiedId=b.parentId+"#"+b.id;this._patterns.push(b);b.patterns&&!b.include&&this._addPatterns(b.patterns,b.qualifiedId)},_addPatterns:function(b,a){b.forEach(function(b){this._addPattern(b,this._NO_ID+this._unnamedCounter++,a)}.bind(this))},_addRepositoryPatterns:function(b,a){Object.keys(b).forEach(function(d){this._addPattern(b[d],d,a)}.bind(this))},_processInclude:function(b,
a,d){var c,e=b.include.indexOf("#");c=0===e?RegExp("^"+b.qualifiedId.substring(0,b.qualifiedId.indexOf("#"))+b.include+"$"):-1===e?RegExp("^"+b.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+b.include+"$");this._patterns.forEach(function(b){if(c.test(b.qualifiedId))if(b.include)this._processInclude(b,a,d);else if(!d[b.qualifiedId]){var e=JSON.parse(JSON.stringify(b));e.index=a[0]++;d[b.qualifiedId]=e}}.bind(this))},_NO_ID:"NoID"};l.prototype={adjustBounds:function(b,a){b<this.start&&(this.start+=a);
b<this.contentStart&&(this.contentStart+=a);b<=this.end&&(this.end+=a);b<=this.contentEnd&&(this.contentEnd+=a);this._subBlocks.forEach(function(d){b<=d.end&&d.adjustBounds(b,a)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(b){return p(this.getBlocks(),b,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};k.prototype={getStyles:function(b){return this._styler.getStyles(b)}};s.prototype={addAnnotationProvider:function(b){"function"===typeof b&&
this._annotationProviders.push(b)},computeBlocks:function(b,a,d,c,e,k,m){return this._stylerAdapter.computeBlocks(b,a,d,c,e,k,m)},destroy:function(){if(this._view){var b=this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());b.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",
this._listener.onLineStyle);this._view=null}},getAnnotationModel:function(){return this._annotationModel},getBlockAtIndex:function(b){return this._findBlock(this._rootBlock,b)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(b){var a=[],d=this._view.getModel();d.getBaseModel&&(d=d.getBaseModel());var c=this._findBlock(this._rootBlock,b),e=d.getLineAtOffset(b),k=d.getLine(e),m=[];this._stylerAdapter.parse(k,d.getLineStart(e),0,c,
m);for((e=m[p(m,b,!0)])&&(e.start<=b&&b<e.end)&&a.push(e);c;)(e=this._stylerAdapter.computeStyle(c,d,b))&&a.splice(0,0,e),c=c.parent;return a},getTextModel:function(){var b=this._view.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},removeAnnotationProvider:function(b){"function"===typeof b&&(b=this._annotationProviders.indexOf(b),-1!==b&&this._annotationProviders.splice(b,1))},setDetectHyperlinks:function(){},setDetectTasks:function(b){this._detectTasks=b},setFoldingEnabled:function(b){this._foldingEnabled=
b},setHighlightCaretLine:function(b){this._highlightCaretLine=b},setWhitespacesVisible:function(b,a){this._whitespacesVisible!==b&&(this._whitespacesVisible=b,a&&this._view.redraw())},_computeFolding:function(b,a,d){if(a.getBaseModel){var c=a.getBaseModel();b.forEach(function(b){var k=this._stylerAdapter.getBlockFoldBounds(b,c);(k=this._createFoldingAnnotation(a,c,k.start,k.end))&&d.push(k);this._computeFolding(b.getBlocks(),a,d)}.bind(this))}},_computeTasks:function(b,a,d,c,e){c=c||b.start;e=e||
b.end;if(b.start<=e&&c<=b.end&&this._annotationModel){var k=t.AnnotationType.ANNOTATION_TASK;if(b.name&&0===b.name.indexOf("comment")){var m=[],f=a.getLineAtOffset(b.contentStart),f=a.getLineStart(f);this._stylerAdapter.parse(a.getText(f,b.end),f,b.contentStart-f,b,m,!0);for(f=0;f<m.length;f++)"meta.annotation.task.todo"===m[f].style&&(c<=m[f].start&&m[f].end<=e)&&d.push(t.AnnotationType.createAnnotation(k,m[f].start,m[f].end,a.getText(m[f].start,m[f].end)))}b.getBlocks().forEach(function(b){this._computeTasks(b,
a,d,c,e)}.bind(this))}},_createFoldingAnnotation:function(b,a,d,c){var e=a.getLineAtOffset(d),k=a.getLineAtOffset(c);return e===k||e+1===k&&a.getLineStart(k)===a.getLineEnd(k)?null:new (t.AnnotationType.getType(t.AnnotationType.ANNOTATION_FOLDING))(d,c,b)},_findBlock:function(b,a){var d=b.getBlocks();if(!d.length)return b;var c=p(d,a,!0);return c<d.length&&d[c].start<=a&&a<d[c].end?this._findBlock(d[c],a):b},_findBrackets:function(b,a,d,c,e,k){for(var m=[],f=[],l=e,q=d.getBlocks(),s=p(q,e,!0);s<q.length&&
!(q[s].start>=k);s++){var t=q[s].start,u=q[s].end;if(l<t){var w=b.getLineAtOffset(l),w=b.getLineStart(w);this._stylerAdapter.parse(c.substring(w-e,t-e),w,l-w,d,f);f.forEach(function(b){b.style&&(0===b.style.indexOf(a.beginName)?m.push(b.start+1):0===b.style.indexOf(a.endName)&&m.push(-(b.start+1)))});f=[]}l=u}l<k&&(w=b.getLineAtOffset(l),w=b.getLineStart(w),this._stylerAdapter.parse(c.substring(w-e,k-e),w,l-w,d,f),f.forEach(function(b){b.style&&(0===b.style.indexOf(a.beginName)?m.push(b.start+1):
0===b.style.indexOf(a.endName)&&m.push(-(b.start+1)))}));return m},_findMatchingBracket:function(b,a,d){var c=b.getLineAtOffset(d),e=b.getLineEnd(c),k=b.getText(d,e),k=this._stylerAdapter.getBracketMatch(a,k);if(!k)return-1;for(var m=b.getLine(c),f=b.getLineStart(c),e=this._findBrackets(b,k,a,m,f,e),l=0;l<e.length;l++)if(m=0<=e[l]?1:-1,e[l]*m-1===d){d=1;if(k.atStart){for(l++;l<e.length;l++)if(m=0<=e[l]?1:-1,d+=m,0===d)return e[l]*m-1;c+=1;for(l=b.getLineCount();c<l;){m=b.getLine(c);f=b.getLineStart(c);
e=b.getLineEnd(c);e=this._findBrackets(b,k,a,m,f,e);for(f=0;f<e.length;f++)if(m=0<=e[f]?1:-1,d+=m,0===d)return e[f]*m-1;c++}}else{for(l--;0<=l;l--)if(m=0<=e[l]?1:-1,d+=m,0===d)return e[l]*m-1;for(c-=1;0<=c;){m=b.getLine(c);f=b.getLineStart(c);e=b.getLineEnd(c);e=this._findBrackets(b,k,a,m,f,e);for(l=e.length-1;0<=l;l--)if(m=0<=e[l]?1:-1,d+=m,0===d)return e[l]*m-1;c--}}break}return-1},_getLineStyle:function(b){if(this._highlightCaretLine){var a=this._view,d=a.getModel(),c=!1;if(!a.getSelections().some(function(a){return a.start===
a.end?(c=c||d.getLineAtOffset(a.start)===b,!1):!0})&&c)return this._caretLineStyle}return null},_getStyles:function(b,a,d,c,e){var k=c+d.length,l=[],f=c+e;e=b.getBlocks();for(var q=p(e,f,!0);q<e.length&&!(e[q].start>=k);q++){var r=e[q].start,s=e[q].end;if(f<r){var t=a.getLineAtOffset(f),t=a.getLineStart(t);this._stylerAdapter.parse(d.substring(t-c,r-c),t,f-t,b,l)}var u=Math.max(f,r);u===r&&(r=this._stylerAdapter.getBlockStartStyle(e[q],d.substring(u-c),u,l))&&(u+=r.length);var r=Math.min(k,s),w=[];
r===s&&(f=d.substring(r-f-(e[q].end-e[q].contentEnd)),(f=this._stylerAdapter.getBlockEndStyle(e[q],f,r,w))&&(r-=f.length));var t=a.getLineAtOffset(u),t=a.getLineStart(t),f=this._getStyles(e[q],a,d.substring(t-c,r-c),t,u-t),B=this._stylerAdapter.getBlockContentStyleName(e[q]);if(B){var g=u;f.forEach(function(a){a.start-g&&l.push({start:g,end:a.start,style:B});a.mergeable&&(a.style+=","+B);l.push(a);g=a.end});r-g&&l.push({start:g,end:r,style:B})}else l=l.concat(f);l=l.concat(w);f=s}f<k&&(t=a.getLineAtOffset(f),
t=a.getLineStart(t),this._stylerAdapter.parse(d.substring(t-c,k-c),t,f-t,b,l));return l},_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},_onLineStyle:function(b){b.textView===this._view&&(b.style=this._getLineStyle(b.lineIndex));var a=b.lineStart,d=b.textView.getModel();if(d.getBaseModel)var a=d.mapOffset(a),c=d.getBaseModel();b.ranges=this._getStyles(this._rootBlock,c||d,b.lineText,a,0);for(a=b.ranges.length-1;0<=a;a--){var e=b.ranges[a];if(e.style){if(e.style=
{styleClass:e.style.replace(/\./g," ")},c){var k=e.end-e.start;e.start=d.mapOffset(e.start,!0);e.end=e.start+k}}else b.ranges.splice(a,1)}this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,b.ranges,b.lineText,b.lineStart),this._spliceStyles(this._tabPattern,b.ranges,b.lineText,b.lineStart))},_onModelChanged:function(b){var a=b.start,d=b.removedCharCount;b=b.addedCharCount-d;var c=this._view.getModel(),e=c.getBaseModel?c.getBaseModel():c,d=a+d,k=e.getCharCount(),l=e.getLineStart(e.getLineAtOffset(a)),
f=this._findBlock(this._rootBlock,a),q,r,s,u,w,A,B;do{s=f.parent;if(!q&&s){if(0>b&&f.end-a<=-b){f=s;continue}w=e.getText(f.start,Math.min(k,f.end+b+1));if(!this._stylerAdapter.verifyBlock(e,w,f,b)){f=s;continue}}r=f.getBlocks();var g=r.length,x=p(r,l,!0),C=p(r,d,!1,x-1,g);q=!1;if(x&&r.length&&r[x-1].end===a){w=e.getText(r[x-1].start,Math.min(k,a+1));var D=this.computeBlocks(e,w,f,r[x-1].start,null,null,null);D.length&&D[0].end!==r[x-1].end&&(x--,q=!0)}x<g&&r[x].start<=l&&(l<r[x].end||q)?(B=r[x].start,
B>a&&(B+=b)):x===g&&0<g&&f.end-b===r[g-1].end?(B=r[--x].start,B>a&&(B+=b)):B=Math.max(l,f.contentStart);A=C<g?r[C].end:f.contentEnd;a<=A&&(A+=b);A=Math.min(A,k-1);w=e.getText(B,A+1);D=this.computeBlocks(e,w,f,B,null,null,null);if(C<g){if(D.length&&D[D.length-1].end===A&&D[D.length-1].typeId===r[C].typeId)break;if(D.length&&this._stylerAdapter.blockSpansBeyondEnd(D[D.length-1])){C++;for(var G=D[D.length-1].getBlocks(),G=(G.length?G[G.length-1]:D[D.length-1]).typeId;C<g;){if(r[C].typeId===G){var K=
r[C].end+b,K=Math.min(K,k-1);w=e.getText(B,K+1);w=this.computeBlocks(e,w,f,B,null,null,null);if(w.length&&w[w.length-1].end===K){A=K;D=w;break}}C++}if(C<g)break}}else if(!D.length||D[D.length-1].end<=f.contentEnd+b)break;if(!s){A=k;C=g;w=e.getText(B,A);D=this.computeBlocks(e,w,f,B,null,null,null);break}f=s;u=!0}while(1);this._rootBlock.adjustBounds(a,b);C=Math.min(C+1,g);u||(u=C-x!==D.length);if(!u)for(g=0;g<D.length;g++)if(q=r[x+g],k=D[g],q.start!==k.start||q.end!==k.end||q.typeId!==k.typeId){u=
!0;break}!r.length&&!D.length?(q=[f],this.dispatchEvent({type:"BlocksChanged",oldBlocks:[f],newBlocks:q}),f=q[0]):this.dispatchEvent({type:"BlocksChanged",oldBlocks:r.slice(x,C),newBlocks:D});x=[x,C-x].concat(D);Array.prototype.splice.apply(r,x);u&&(r=B,u=A,c!==e&&(r=c.mapOffset(r,!0),u=c.mapOffset(u,!0)),this._view.redrawRange(r,u));if(this._annotationModel){var J=[],L=[],I=[];r=this._annotationModel.getAnnotations(B,A);u=this._foldingEnabled&&e!==c;for(x=f.parent||f;r.hasNext();)if(C=r.next(),u&&
C.type===t.AnnotationType.ANNOTATION_FOLDING){I.push(C);for(q=this._findBlock(x,C.start);q;){var M=this._stylerAdapter.getBlockFoldBounds(q,e);if(C.start===M.start&&C.end===M.end)break;q=q.parent}q&&C.start===M.start&&C.end===M.end?(D=C.start,q=C.end,D>a&&(D-=b),q>a&&(q-=b),D<=a&&(a<q&&D<=d&&d<q)&&(D=e.getLineAtOffset(C.start),q=e.getLineAtOffset(C.end),D!==q?C.expanded||C.expand():J.push(C))):(J.push(C),C.expand())}else C.type===t.AnnotationType.ANNOTATION_TASK&&f.start<=C.start&&C.end<=f.end&&J.push(C);
u&&x.getBlocks().forEach(function(a){this._updateFolding(a,e,c,I,L,B,A)}.bind(this));this._detectTasks&&this._computeTasks(f,e,L,B,A);this._annotationProviders.forEach(function(a){var b=[],c=[];a(this._annotationModel,e,f,B,A,b,c);J=J.concat(b);L=L.concat(c)}.bind(this));this._annotationModel.replaceAnnotations(J,L)}},_onMouseDown:function(b){if(2===b.clickCount){var a=this._view.getModel(),d=this._view.getOffsetAtLocation(b.x,b.y);if(0<d){var c=d-1,e=a;a.getBaseModel&&(c=a.mapOffset(c),e=a.getBaseModel());
var k=this._findBlock(this._rootBlock,c),c=this._findMatchingBracket(e,k,c);-1!==c&&(b.preventDefault(),b=c,a.getBaseModel&&(b=a.mapOffset(b,!0)),d>b&&(d--,b++),this._view.setSelection(b,d))}}},_onSelection:function(b){var a=Array.isArray(b.oldValue)?b.oldValue:[b.oldValue];b=Array.isArray(b.newValue)?b.newValue:[b.newValue];var d=this._view,c=d.getModel(),e;if(this._highlightCaretLine){var k=function(a){var b={};return a.some(function(a){if(a.isEmpty())b[c.getLineAtOffset(a.start).toString()]=!0;
else return!0;return!1})?{}:b},a=k(a),k=k(b),l=function(a,b){for(var c in a)b[c]||(e=c>>0,d.redrawLines(e,e+1))};l(a,k);l(k,a)}if(this._annotationModel){var a=this._bracketAnnotations,f,p;if(1===b.length&&b[0].isEmpty()&&0<(p=b[0].getCaret()))p-=1,c.getBaseModel&&(p=c.mapOffset(p),c=c.getBaseModel()),b=this._findBlock(this._rootBlock,p),b=this._findMatchingBracket(c,b,p),-1!==b&&(f=[t.AnnotationType.createAnnotation(t.AnnotationType.ANNOTATION_MATCHING_BRACKET,b,b+1),t.AnnotationType.createAnnotation(t.AnnotationType.ANNOTATION_CURRENT_BRACKET,
p,p+1)]);this._bracketAnnotations=f;this._annotationModel.replaceAnnotations(a,f)}},_spliceStyles:function(b,a,d,c){for(var e=b.regex,k=e.lastIndex=0,l=e.exec(d);l;){for(l=c+l.index;k<a.length&&!(l<a[k].end);)k++;var f={start:l,end:l+1,style:JSON.parse(JSON.stringify(b.style))};if(k<a.length&&a[k].start<=l){var p={start:l+1,end:a[k].end,style:a[k].style};a[k].end=l;a.splice(k+1,0,p);a.splice(k+1,0,f);k+=2;f.style.styleClass+=" "+a[k].style.styleClass}else a.splice(k,0,f),k++;l=e.exec(d)}},_updateFolding:function(b,
a,d,c,e,k,l){k=k||b.start;l=l||b.end;var f=this._stylerAdapter.getBlockFoldBounds(b,a);if(!b.doNotFold&&f.start<=l&&k<=f.end){var q=p(c,f.start,!0);q<c.length&&c[q].start===f.start&&c[q].end===f.end||(f=this._createFoldingAnnotation(d,a,f.start,f.end))&&e.push(f);b.getBlocks().forEach(function(b){this._updateFolding(b,a,d,c,e,k,l)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,
style:{styleClass:"punctuation separator tab",unmergeable:!0}}};w.EventTarget.addMixin(s.prototype);return{TextStyler:s,Block:l,createPatternBasedAdapter:function(b,a,h){return new d(b,a,h)}}});B("orion/editor/edit","require orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist orion/editor/textStyler".split(" "),function(t,w,u,d,q,l,k,s,p){function b(a,b,c){for(var d;c&&c!==b&&
"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function a(a){var c=a.firstChild;if(c&&"TEXTAREA"===c.tagName)return c.value;var d=a.ownerDocument,e=d.defaultView||d.parentWindow;if(!e.getSelection||1===a.childNodes.length&&c.nodeType===Node.TEXT_NODE||"none"===b(e,d,a))return a.innerText||a.textContent;c=d.createRange();c.selectNode(a);a=e.getSelection();e=[];for(d=0;d<a.rangeCount;d++)e.push(a.getRangeAt(d));
a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(d=0;d<e.length;d++)a.addRange(e[d]);return c}function h(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function e(a,b){var d={};c(d,b);for(var e,f=0,k=a.attributes,g=k.length;f<g;f++){e=k.item(f);var l=h(e.nodeName);if(l){e=e.nodeValue;if("true"===e||"false"===e)e="true"===e;d[l]=
e}}return d}function n(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function m(c){var f=c.document||document,h=c.parent;h||(h="editor");"string"===typeof h&&(h=f.getElementById(h));if(!h&&c.className){var v=n(f,c.className);if(v){c.className=void 0;1<v.length&&void 0===c.noFocus&&(c.noFocus=!0);for(var f=[],A=v.length-1;0<=A;A--)c.parent=v[A],f.push(m(c));return f}}if(!h)throw Error("no parent");
c=e(h,c);if("string"===typeof c.theme){var v=d.TextTheme.getTheme(c.theme),B=c.theme.lastIndexOf("/"),g=c.theme;-1!==B&&(g=g.substring(B+1));".css"===g.substring(g.length-4)&&(g=g.substring(0,g.length-4));v.setThemeClass(g,{href:c.theme});c.theme=v}var x;c.readonly||(A={createContentAssistMode:function(a){x=new s.ContentAssist(a.getTextView());a=new s.ContentAssistWidget(x);a=new s.ContentAssistMode(x,a);x.setMode(a);return a}});var C=new l.Editor({textViewFactory:function(){return new w.TextView({parent:h,
model:new q.ProjectionTextModel(c.model?c.model:new u.TextModel("")),tabSize:c.tabSize?c.tabSize:4,readonly:c.readonly,fullSelection:c.fullSelection,tabMode:c.tabMode,expandTab:c.expandTab,singleMode:c.singleMode,themeClass:c.themeClass,theme:c.theme,wrapMode:c.wrapMode,wrappable:c.wrappable})},undoStackFactory:new k.UndoFactory,annotationFactory:new k.AnnotationFactory,lineNumberRulerFactory:new k.LineNumberRulerFactory,foldingRulerFactory:new k.FoldingRulerFactory,textDNDFactory:new k.TextDNDFactory,
contentAssistFactory:A,keyBindingFactory:new k.KeyBindingsFactory,statusReporter:c.statusReporter,domNode:h});C.addEventListener("TextViewInstalled",function(){var a=C.getLineNumberRuler();a&&void 0!==c.firstLineIndex&&a.setFirstLine(c.firstLineIndex);if(a=C.getSourceCodeActions())a.setAutoPairParentheses(c.autoPairParentheses),a.setAutoPairBraces(c.autoPairBraces),a.setAutoPairSquareBrackets(c.autoPairSquareBrackets),a.setAutoPairAngleBrackets(c.autoPairAngleBrackets),a.setAutoPairQuotations(c.autoPairQuotations),
a.setAutoCompleteComments(c.autoCompleteComments),a.setSmartIndentation(c.smartIndentation)});A=c.contents;void 0===A&&(A=a(h));A||(A="");C.installTextView();C.setLineNumberRulerVisible(void 0===c.showLinesRuler||c.showLinesRuler);C.setAnnotationRulerVisible(void 0===c.showAnnotationRuler||c.showFoldingRuler);C.setOverviewRulerVisible(void 0===c.showOverviewRuler||c.showOverviewRuler);C.setZoomRulerVisible(void 0===c.showZoomRuler||c.showZoomRuler);C.setFoldingRulerVisible(void 0===c.showFoldingRuler||
c.showFoldingRuler);C.setInput(c.title,null,A,!1,c.noFocus);({styler:null,highlight:function(a,b){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===a?a="application/javascript":"css"===a?a="text/css":"html"===a?a="text/html":"java"===a&&(a="text/x-java-source");var d=b.getTextView(),e=b.getAnnotationModel();if(a){var f=a.replace(/[*|:/".<>?+]/g,"_");t(["./stylers/"+f+"/syntax"],function(b){b=new p.createPatternBasedAdapter(b.grammars,b.id,a);this.styler=new p.TextStyler(d,
e,b)},function(a){})}"text/css"===a&&b.setFoldingRulerVisible(void 0===c.showFoldingRuler||c.showFoldingRuler)}}).highlight(c.contentType||c.lang,C);A=f.defaultView||f.parentWindow;!c.noComputeSize&&("none"!==b(A,f,h)&&50>=h.clientHeight)&&(f=C.getTextView().computeSize().height,h.style.height=f+"px");return C}var f=this.orion?this.orion.editor:void 0;if(f){for(var v=0;v<arguments.length;v++)c(f,arguments[v]);f.edit=m}return m});return G("orion/editor/edit")});
//# sourceMappingURL=built-editor.min.js.map